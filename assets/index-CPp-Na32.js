import{ap as i,r as S,as as T}from"./index-BOet_9WV.js";import{A as L,C as Q,Y as R,E as Y,u as K,c as V,i as W,t as P,L as le,H as X,d as G,b as q,h as ae,G as M,T as I,o as J,g as z}from"./MyApp-CjYFd9zw.js";import se from"./MyTable-DtCIMSE6.js";import{E as re}from"./ExportButton-BcT8qdkH.js";import{A as ce}from"./index-B6t6X2Jj.js";import{I as de}from"./index-CEXPLwB-.js";import{T as $}from"./index-O4Tr1Cwi.js";import{R as ue}from"./row-ep240xy5.js";import{T as fe}from"./index-DnwdLqdc.js";import"./Table-LjhwWZUp.js";import"./TextArea-CM241X7f.js";import"./addEventListener-BoFyme10.js";import"./index-B3I_vVip.js";import"./PurePanel-CuTvi9m1.js";import"./index-BzVYrbuN.js";import"./index-DVzyffHd.js";import"./index-1i3_uXMj.js";import"./Dropdown-y4Y8A-i9.js";import"./index-DiTf7hIK.js";import"./useBreakpoint-vSNHfBfG.js";import"./responsiveObserver-CyO3TaPU.js";import"./Pagination-BmcLOJBH.js";import"./index-CeQZxhjd.js";import"./file-download-DVNTG-gp.js";import"./index-CC9bN2Gw.js";var Z=(n=>(n.USER="User",n.PAGE="Page",n.GROUP="Group",n))(Z||{}),F=(n=>(n.FOLLOWING="Following",n.UNFOLLOWED="UnFollowed",n))(F||{});const H={Following:{en:"Following",vi:"Đang theo dõi"},UnFollowed:{en:"Unfollowed",vi:"Đã bỏ theo dõi"}};async function ge(n=""){const a=await L({fb_api_req_friendly_name:"CometFeedPreferencesUnfollowProfileGridRefetchQuery",variables:{after_cursor:n,included_types:["USER","PAGE","GROUP"],no_memorialized_profiles:null,num_profiles:30,profile_picture_scale:2,query_substring:""},doc_id:"5699463850111622"}),u=JSON.parse(a),{edges:j=[],page_info:r={}}=Q(u);return j.map(o=>{var c,f,h,m,p,x;return{type:(c=o.node)==null?void 0:c.__typename,status:"Following",id:(f=o.node)==null?void 0:f.id,name:(h=o.node)==null?void 0:h.name,avatar:(p=(m=o.node)==null?void 0:m.profile_picture)==null?void 0:p.uri,url:(x=o.node)==null?void 0:x.url,cursor:o.cursor}})}async function pe(){const n=await L({fb_api_req_friendly_name:"CometFeedPreferencesFollowPageQuery",variables:{included_types:["USER","PAGE","GROUP"],num_profiles:18,profile_picture_scale:2,query_substring:""},doc_id:"4868917013156094"}),a=JSON.parse(n),{edges:u=[],page_info:j={}}=Q(a);return u.map(r=>{var o,c,f,h,m,p;return{type:(o=r.node)==null?void 0:o.__typename,status:"UnFollowed",id:(c=r.node)==null?void 0:c.id,name:(f=r.node)==null?void 0:f.name,avatar:(m=(h=r.node)==null?void 0:h.profile_picture)==null?void 0:m.uri,url:(p=r.node)==null?void 0:p.url,cursor:r.cursor}})}async function me(n){const a=n.type==="Group"?await L({fb_api_req_friendly_name:"CommitGroupSubscribeStatusSubscribeMutation",variables:{input:{subscribe_location:"FEED_SETTINGS",group_id:n.id,actor_id:await R()}},doc_id:"4771392912988139"}):await L({fb_api_req_friendly_name:"CommitActorSubscribeStatusSubscribeMutation",variables:{input:{subscribe_location:"FEED_SETTINGS",subscribee_id:n.id,actor_id:await R()}},doc_id:"7750648234952596"}),u=JSON.parse(a);return console.log(u),Y(u,"id",!0)===n.id}async function he(n){const a=n.type==="Group"?await L({fb_api_req_friendly_name:"CommitGroupSubscribeStatusUnsubscribeMutation",variables:{input:{subscribe_location:"FEED_SETTINGS",group_id:n.id,actor_id:await R()}},doc_id:"4841019119329325"}):await L({fb_api_req_friendly_name:"CommitActorSubscribeStatusUnsubscribeMutation",variables:{input:{subscribe_location:"FEED_SETTINGS",unsubscribee_id:n.id,actor_id:await R()}},doc_id:"7531739850199826"}),u=JSON.parse(a);return console.log(u),Y(u,"id",!0)===n.id}function we(){const{ti:n}=K(),{message:a,notification:u}=V();return{onClickBulkActions:async({data:o,key:c,actionFn:f,loadingText:h,successText:m,successDesc:p,successDescItem:x,waitTime:d=[2e3,5e3],requireVIP:_=!0})=>{if(_&&!await W()||!(o!=null&&o.length))return;const b=c+":waiting";P(c);let C=!1,y=[];for(let g=0;g<o.length&&(a.destroy(b),a.loading({key:c,content:i.jsxs(i.Fragment,{children:[h(o[g],g,o)+" ("+(g+1)+"/"+o.length+")",i.jsx("br",{}),i.jsx("i",{children:n({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{a.loading({key:c,content:n({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),C=!0}}),await f(o[g])&&y.push(o[g]),!C);g++)if(d&&g<o.length-1){const U=le(d[0]||d,d[1]||d);a.loading({key:b,content:n({en:"Sleeping "+Math.round(U/1e3)+"s",vi:"Đang đợi "+Math.round(U/1e3)+"s"}),duration:0}),await X(U)}a.destroy(c),a.destroy(b),u.open({type:"success",duration:0,message:m(y,o),description:x?i.jsx("ol",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:y.map((g,E)=>i.jsx("li",{children:x(g)},E))}):p==null?void 0:p(y,o)})},onClickAction:async({key:o,id:c,record:f,loadingText:h,successText:m,failedText:p,actionFn:x,onSuccess:d,requireVIP:_=!1})=>{if(_&&!await W())return!1;P(o),o+=":"+c;try{if(a.loading({key:o,content:h(f),duration:0}),await x())return d==null||d(),a.success({key:o,content:m(f)}),!0;throw new Error("Facebook response error")}catch(b){return a.destroy(o),u.open({type:"error",message:p(f),description:b.message}),!1}finally{}}}}function Me(){const{ti:n}=K(),{message:a}=V(),{onClickAction:u,onClickBulkActions:j}=we(),[r,o]=G("Follows.data",[]),[c,f]=S.useState(!1),[h,m]=G("Follows.loadingFollowBulk",!1),[p,x]=G("Follows.loadingUnFollowBulk",!1),[d,_]=G("Follows.loadingRecord",{}),[b,C]=S.useMemo(()=>[r.filter(e=>e.status===F.FOLLOWING),r.filter(e=>e.status===F.UNFOLLOWED)],[r]),y=S.useRef(null);S.useEffect(()=>{E()},[]);const g=S.useRef(!1),E=async(e=!1)=>{if(g.current||c)return;g.current=!0;const t="Follows:onReload";a.loading({key:t,content:n({en:"Loading following...",vi:"Đang tải người bạn theo dõi..."}),duration:0}),f(!0);const l=e?[]:r,s=new Set(l.map(w=>w.id));for(const[w,k]of[[ge,n({en:"Loading following... ",vi:"Đang tải người theo dõi... "})],[pe,n({en:"Loading unfollowed... ",vi:"Đang tải người từng theo dõi... "})]]){let N="";for(;;){const v=await w(N);if(!(v!=null&&v.length))break;let D=!1;for(let O of v)s.has(O.id)||(l.push(O),s.add(O.id),D=!0);if(!D)break;o([...l.map((O,oe)=>({...O,i:oe+1}))]),N=v[v.length-1].cursor,a.loading({key:t,content:k+l.length,duration:0}),await X(1e3)}}a.success({key:t,content:n({en:"Finish loading follows: ",vi:"Tải xong danh sách theo dõi: "})+l.length}),f(!1),g.current=!1},U=(e,t)=>{var s,w;o(k=>{const N=k.find(v=>v.id===e.id);return N?(N.status=t,[...k]):k});const l=(s=y.current)==null?void 0:s.getDataSelected();l&&((w=y.current)==null||w.setDataSelected(l.filter(k=>k.id!==e.id)))},B=e=>(_({...d,[e.id]:!0}),u({record:e,id:e.id,key:"Follows:onClickFollow",actionFn:()=>me(e),loadingText:()=>n({en:"Following...",vi:"Đang theo dõi..."})+" "+e.name,successText:()=>n({en:"Followed",vi:"Đã theo dõi"})+" "+e.name,failedText:()=>n({en:"Failed to follow",vi:"Lỗi theo dõi"})+" "+e.name,onSuccess:()=>{_({...d,[e.id]:!1}),U(e,F.FOLLOWING)}})),A=e=>(_({...d,[e.id]:!0}),u({record:e,id:e.id,key:"Follows:onClickUnFollow",actionFn:()=>he(e),loadingText:()=>n({en:"Unfollowing...",vi:"Đang bỏ theo dõi..."})+" "+e.name,successText:()=>n({en:"Unfollowed",vi:"Đã bỏ theo dõi"})+" "+e.name,failedText:()=>n({en:"Failed to unfollow",vi:"Lỗi bỏ theo dõi"})+" "+e.name,onSuccess:()=>{_({...d,[e.id]:!1}),U(e,F.UNFOLLOWED)}})),ee=e=>{x(!0),j({data:e,key:"Follows:onClickUnFollowBulk",actionFn:t=>A(t),loadingText:t=>n({en:"Unfollowing...",vi:"Đang bỏ theo dõi..."})+t.name,successText:(t,l)=>n({en:"Unfollow finished: ",vi:"Đã bỏ theo dõi xong: "})+`${t.length} / ${l.length}`,successDescItem:t=>i.jsx("a",{target:"_blank",href:z(t.id),children:t.name}),waitTime:300}).finally(()=>{x(!1)})},te=e=>{m(!0),j({data:e,key:"Follows:onClickFollowBulk",actionFn:t=>B(t),loadingText:t=>n({en:"Following...",vi:"Đang theo dõi..."})+t.name,successText:(t,l)=>n({en:"Follow finished: ",vi:"Đã theo dõi xong: "})+` ${t.length} / ${l.length}`,successDescItem:t=>i.jsx("a",{target:"_blank",href:z(t.id),children:t.name}),waitTime:300}).finally(()=>{m(!1)})},ne=e=>{const t=e.length?e.filter(s=>s.status===F.FOLLOWING):b,l=e.length?e.filter(s=>s.status===F.UNFOLLOWED):C;return i.jsxs(i.Fragment,{children:[i.jsx(T,{type:"primary",icon:c?i.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):i.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>E(!0),children:n({en:"Reload",vi:"Tải lại"})}),i.jsx(re,{data:e.length?e:b,options:[{key:"uid",label:".txt (uid)",prepareData:s=>({fileName:"followings_uid.txt",data:s.map(w=>w.id).join(`
`)})},{key:"uid_name",label:".csv (uid+name)",prepareData:s=>({fileName:"followings_uid_name.csv",data:J(s.map(w=>({uid:w.id,name:w.name})))})},{key:"json",label:".json",prepareData:s=>({fileName:"followings.json",data:JSON.stringify(s,null,2)})},{key:"csv",label:".csv",prepareData:s=>({fileName:"followings.csv",data:J(s)})}]}),i.jsx(I,{title:n({en:"Unfollow "+t.length+" selected",vi:"Bỏ theo dõi "+t.length+" người đang chọn"}),children:i.jsx(T,{type:"default",danger:!0,icon:i.jsx("i",{className:"fa-solid fa-trash"}),disabled:t.length===0,loading:p,onClick:()=>ee(t),children:n({en:"Unfollow",vi:"Bỏ theo dõi"})+" "+t.length})}),i.jsx(I,{title:n({en:"Follow "+l.length+" selected",vi:"Theo dõi "+l.length+" người đang chọn"}),children:i.jsx(T,{type:"default",icon:i.jsx("i",{className:"fa-solid fa-plus"}),disabled:l.length===0,loading:h,onClick:()=>te(l),children:n({en:"Follow",vi:"Theo dõi"})+" "+l.length})})]})},ie=[{title:"#",dataIndex:"i",width:50,sorter:(e,t)=>e.i-t.i},{title:n({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(e,t)=>(e.name||"").localeCompare(t.name||""),render:(e,t,l)=>i.jsxs(q,{align:"center",style:{maxWidth:400},children:[i.jsx(ce,{shape:"square",src:i.jsx(de,{src:ae(t.id),fallback:t.avatar}),size:50}),i.jsxs(q,{direction:"vertical",style:{marginLeft:"10px"},size:0,children:[i.jsx("a",{href:t.url,target:"_blank",children:i.jsx("b",{children:t.name})}),i.jsx("span",{style:{opacity:.5},children:t.id})]})]}),onSearch:(e,t,l)=>M(e,l.name)||M(e,l.id),width:"auto"},{title:n({en:"Type",vi:"Loại"}),key:"type",dataIndex:"type",filters:Object.entries(Z).map(([e,t])=>({text:t+" ("+r.filter(l=>l.type===t).length+")",value:t})),onFilter:(e,t)=>t.type===e,width:120},{title:n({en:"Status",vi:"Trạng thái"}),key:"status",dataIndex:"status",render:(e,t,l)=>{const s=n(H[t.status]);return t.status===F.UNFOLLOWED?i.jsx($,{color:"error",children:s}):s},filters:Object.entries(H).map(([e,t])=>({text:n(t)+" ("+r.filter(l=>l.status===e).length+")",value:e})),onFilter:(e,t)=>t.status===e,width:150},{title:n({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(e,t,l)=>t.status===F.FOLLOWING?i.jsx(I,{title:n({en:"UnFollow",vi:"Bỏ theo dõi"}),mouseEnterDelay:.5,children:i.jsx(T,{danger:!0,type:"default",icon:i.jsx("i",{className:"fa-solid fa-trash"}),onClick:()=>A(t),loading:d[t.id]})}):i.jsx(I,{title:n({en:"Follow",vi:"Theo dõi"}),mouseEnterDelay:.5,children:i.jsx(T,{type:"text",onClick:()=>B(t),icon:i.jsx("i",{className:"fa-regular fa-square-plus fa-xl"}),loading:d[t.id]})}),align:"right",width:100}];return i.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[i.jsxs(ue,{align:"middle",style:{margin:"16px"},children:[i.jsx(fe.Title,{level:3,style:{margin:0},children:n({en:"Following",vi:"Đang theo dõi"})}),i.jsx($,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:r.filter(e=>e.status===F.FOLLOWING).length})]}),i.jsx(se,{ref:y,data:r,columns:ie,renderTitle:ne,size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e==null?void 0:e.id})]})}export{Me as default};
