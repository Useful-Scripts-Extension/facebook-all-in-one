import{x as J,Y as rt,y as it,ad as yt}from"./MyApp-CPSi1kec.js";async function wt(i=""){const e=await J({fb_api_req_friendly_name:"StoriesTrayRectangularQuery",variables:{blur:10,bucketsToFetch:5,cursor:i,scale:1,id:await rt()},doc_id:"24539171939059864"}),_=JSON.parse(e);console.log(_);const{edges:c=[],page_info:l={}}=it(_);return c.map(r=>{var f,y,o,n,t,a,m,E,S,L,V,A,M;const s=((f=r==null?void 0:r.node)==null?void 0:f.story_bucket_owner)||{};return{bucket_id:(y=r==null?void 0:r.node)==null?void 0:y.id,thumbnail:(a=(t=(n=(o=r==null?void 0:r.node)==null?void 0:o.thumbnail_story_to_show)==null?void 0:n.story_card_info)==null?void 0:t.story_thumbnail)==null?void 0:a.uri,owner:{id:s.id,name:s.name,avatar:((m=s.coverImage)==null?void 0:m.uri)||((E=s.profilePic)==null?void 0:E.uri)||((S=s.profile_picture)==null?void 0:S.uri)},stories:(A=(V=(L=r==null?void 0:r.node)==null?void 0:L.unified_stories)==null?void 0:V.edges)==null?void 0:A.map(I=>{var O,R;return{id:(O=I==null?void 0:I.node)==null?void 0:O.id,expiration_time:(R=I==null?void 0:I.node)==null?void 0:R.expiration_time}}),seen:(M=r==null?void 0:r.node)==null?void 0:M.is_bucket_seen_by_viewer,cursor:(r==null?void 0:r.cursor)||l.end_cursor}}).filter(r=>r.stories.length>0)}async function ht(i=""){var l,r,s,f,y;const e=await J({fb_api_req_friendly_name:"StoriesSuspenseContentPaneRootWithEntryPointQuery",variables:{blur:10,bucketID:i,feedbackSource:65,feedLocation:"COMET_MEDIA_VIEWER",focusCommentID:null,initialBucketID:i,initialLoad:!1,scale:1,shouldDeferLoad:!1,shouldEnableArmadilloStoryReply:!0,shouldEnableLiveInStories:!0,__relay_internal__pv__StoriesIsShareToStoryEnabledrelayprovider:!1,__relay_internal__pv__StoriesLWRVariantrelayprovider:"www_new_reactions"},doc_id:"8237681579610775"}),_=JSON.parse((e==null?void 0:e.split(`
`)[0])||"{}");console.log(_);const c=((r=(l=_==null?void 0:_.data)==null?void 0:l.nodes)==null?void 0:r[0])||((s=_==null?void 0:_.data)==null?void 0:s.bucket);return(y=(f=c==null?void 0:c.unified_stories)==null?void 0:f.edges)==null?void 0:y.map(o=>{var m,E,S,L,V,A,M,I,O,R,q,P,W,Q,Y,G,B,F,H,U,z,K,X,Z,$,j,d,u,h,b,p,w,x,k,C,ot,N,g,st,at,_t;const n=((L=(S=(E=(m=o==null?void 0:o.node)==null?void 0:m.attachments)==null?void 0:E.sort((D,v)=>{var nt,tt,T,ct,lt,ut,et,ft;return(((tt=(nt=v==null?void 0:v.media)==null?void 0:nt.image)==null?void 0:tt.width)||0)*(((ct=(T=v==null?void 0:v.media)==null?void 0:T.image)==null?void 0:ct.height)||0)-(((ut=(lt=D==null?void 0:D.media)==null?void 0:lt.image)==null?void 0:ut.width)||0)*(((ft=(et=D==null?void 0:D.media)==null?void 0:et.image)==null?void 0:ft.height)||0)}))==null?void 0:S[0])==null?void 0:L.media)||{},t=((A=(V=o==null?void 0:o.node)==null?void 0:V.story_card_info)==null?void 0:A.feedback_summary)||{},a=[];for(let D of((O=(I=(M=o==null?void 0:o.node)==null?void 0:M.story_card_info)==null?void 0:I.viewerList_viewers)==null?void 0:O.edges)||[])for(let v of((R=D==null?void 0:D.feedback)==null?void 0:R.lightweight_reactions)||[]){let nt=(P=(q=v==null?void 0:v.id)==null?void 0:q.split(":"))==null?void 0:P[0],tt="";for(let T of((W=v==null?void 0:v.last5)==null?void 0:W.edges)||[])tt+=(Q=T==null?void 0:T.node)==null?void 0:Q.reaction;a.push({uid:nt,reaction:tt})}return{bucket_id:i,id:(Y=o==null?void 0:o.node)==null?void 0:Y.id,caption:((B=(G=o==null?void 0:o.node)==null?void 0:G.message)==null?void 0:B.text)||((F=n==null?void 0:n.message)==null?void 0:F.text)||((H=n==null?void 0:n.title)==null?void 0:H.text),thumbnail:((K=(z=(U=o==null?void 0:o.node)==null?void 0:U.story_card_info)==null?void 0:z.story_video_thumbnail)==null?void 0:K.uri)||(($=(Z=(X=o==null?void 0:o.node)==null?void 0:X.story_card_info)==null?void 0:Z.story_thumbnail)==null?void 0:$.uri)||((j=n==null?void 0:n.previewImage)==null?void 0:j.uri),url:(u=(d=o==null?void 0:o.node)==null?void 0:d.shareable)==null?void 0:u.url,video:(n==null?void 0:n.playable_url_quality_hd)||(n==null?void 0:n.browser_native_hd_url)||(n==null?void 0:n.playable_url)||(n==null?void 0:n.browser_native_sd_url),image:((h=n==null?void 0:n.image)==null?void 0:h.uri)||((b=n==null?void 0:n.previewImage)==null?void 0:b.uri),reaction:(w=(p=t==null?void 0:t.reaction_summary)==null?void 0:p.map(D=>D.reaction_unicode))==null?void 0:w.join(""),react_count:t==null?void 0:t.total_reaction_count,view_count:((C=(k=(x=o==null?void 0:o.node)==null?void 0:x.story_card_info)==null?void 0:k.story_viewers)==null?void 0:C.count)||((g=(N=(ot=o==null?void 0:o.node)==null?void 0:ot.story_card_info)==null?void 0:N.viewers)==null?void 0:g.count),creation_time:(st=o==null?void 0:o.node)==null?void 0:st.creation_time,seen:(_t=(at=o==null?void 0:o.node)==null?void 0:at.story_card_seen_state)==null?void 0:_t.is_seen_by_viewer,reactions:a}})}async function bt(i=""){const e=await J({doc_id:"2474284976008135",variables:{count:8,cursor:i,scale:1.5,id:btoa("app_collection:"+await rt()+":235134840312703:175")}}),_=JSON.parse(e);console.log(_);const{edges:c=[],page_info:l={}}=it(_)||{};return c.map(r=>{var f,y,o,n,t,a;const s=((f=r==null?void 0:r.node)==null?void 0:f.node)||(r==null?void 0:r.node);return{id:s==null?void 0:s.id,creation_time:(y=s==null?void 0:s.story_card_info)==null?void 0:y.local_creation_time,thumbnail:(n=(o=s==null?void 0:s.story_card_info)==null?void 0:o.story_thumbnail)==null?void 0:n.uri,seen_count:(a=(t=s==null?void 0:s.story_card_seen_state)==null?void 0:t.seen_count)==null?void 0:a.count,cursor:(r==null?void 0:r.cursor)||l.end_cursor}})}async function vt({afterTime:i="",beforeTime:e="",creationTime:_=""}={}){var f,y,o,n;if(_){const t=new Date(_),a=new Date(t.getTime()+24*60*60*1e3);i=yt(t),e=yt(a)}console.log(i,e);const c=await J({fb_api_req_friendly_name:"StoriesArchiveContentPaneRootQuery",variables:{lower_bound_time:i,upper_bound_time:e,scale:1,blur:null,shouldEnableLiveInStories:!0,feedbackSource:65,useDefaultActor:!1,feedLocation:"COMET_MEDIA_VIEWER",focusCommentID:null,isStoriesArchive:!0,__relay_internal__pv__StoriesIsShareToStoryEnabledrelayprovider:!1},doc_id:"8266171723403755"}),l=JSON.parse(c.split(`
`)[0]||"{}");console.log(l);const{edges:r=[],page_info:s={}}=((n=(o=(y=(f=l==null?void 0:l.data)==null?void 0:f.viewer)==null?void 0:y.stories_data)==null?void 0:o.story_archive)==null?void 0:n.cards)||{};return r.map(t=>{var A,M,I,O,R,q,P,W,Q,Y,G,B,F,H,U,z,K,X,Z,$,j,d;const a=((A=t==null?void 0:t.node)==null?void 0:A.viewerCount)||{},m=(I=(M=t==null?void 0:t.node)==null?void 0:M.media_attribution_elements)==null?void 0:I.find(u=>u.attribution_type==="MUSIC");function E(u){var h,b;return(b=(h=t==null?void 0:t.node)==null?void 0:h.attachments)==null?void 0:b.find(p=>{var w;return((w=p==null?void 0:p.media)==null?void 0:w.__typename)===u})}function S(u){return["image","previewImage","blurred_image"].reduce((h,b)=>{var p,w;return h||((w=(p=u==null?void 0:u.media)==null?void 0:p[b])==null?void 0:w.uri)},"")}let L="",V=E("GenericAttachmentMedia");return V?L=E("Photo"):V=E("Photo"),{id:(O=t==null?void 0:t.node)==null?void 0:O.id,created_at:(((R=t==null?void 0:t.node)==null?void 0:R.creation_time)||0)*1e3,last_seen_at:(((P=(q=t==null?void 0:t.node)==null?void 0:q.story_card_seen_state)==null?void 0:P.seen_receipts_last_seen_time)||0)*1e3,comment_count:(Q=(W=t==null?void 0:t.node)==null?void 0:W.feedback)==null?void 0:Q.story_comment_count,viewer_count:{friend:(Y=a==null?void 0:a.friendViewerCount)==null?void 0:Y.count,connection:(G=a==null?void 0:a.connectionViewerCount)==null?void 0:G.count,follower:(B=a==null?void 0:a.followerViewerCount)==null?void 0:B.count,new_friend:(F=a==null?void 0:a.newFriendViewerCount)==null?void 0:F.count,new_connection:(H=a==null?void 0:a.newConnectionViewerCount)==null?void 0:H.count},image:S(V),image_background:S(L),video:["browser_native_hd_url","browser_native_sd_url"].reduce((u,h)=>{var b,p,w,x;return u||((x=(w=(p=(b=t==null?void 0:t.node)==null?void 0:b.attachments)==null?void 0:p.find(k=>{var C;return(C=k==null?void 0:k.media)==null?void 0:C[h]}))==null?void 0:w.media)==null?void 0:x[h])},""),music:m?(m==null?void 0:m.song_title)+" - "+(m==null?void 0:m.artist_name):"",reactions:(X=(K=(z=(U=t==null?void 0:t.node)==null?void 0:U.story_card_info)==null?void 0:z.story_card_reactions)==null?void 0:K.edges)==null?void 0:X.map(u=>{var h,b,p,w,x,k,C;return{uid:(b=(h=u==null?void 0:u.node)==null?void 0:h.messaging_actor)==null?void 0:b.id,reactions:(x=(w=(p=u==null?void 0:u.node)==null?void 0:p.messaging_actions)==null?void 0:w.edges)==null?void 0:x.reduce((ot,N)=>{var g;return ot+((g=N==null?void 0:N.node)==null?void 0:g.reaction)},""),count:(C=(k=u==null?void 0:u.node)==null?void 0:k.messaging_actions)==null?void 0:C.count}}),viewers:(d=(j=($=(Z=t==null?void 0:t.node)==null?void 0:Z.story_card_info)==null?void 0:$.viewerList_viewers)==null?void 0:j.edges)==null?void 0:d.map(mt)}})}function mt(i){var e,_,c,l,r,s,f,y;return{uid:(e=i==null?void 0:i.node)==null?void 0:e.id,avatar:(c=(_=i==null?void 0:i.node)==null?void 0:_.profile_picture)==null?void 0:c.uri,name:(l=i==null?void 0:i.node)==null?void 0:l.name,reactions:(s=(r=i==null?void 0:i.feedback)==null?void 0:r.lightweight_reactions)==null?void 0:s.reduce((o,n)=>{var a,m;const t=((a=n==null?void 0:n.last5)==null?void 0:a.edges)||((m=n==null?void 0:n.messaging_actions)==null?void 0:m.edges);return o+(t==null?void 0:t.reduce((E,S)=>{var L;return E+((L=S==null?void 0:S.node)==null?void 0:L.reaction)},""))},""),count:(y=(f=i==null?void 0:i.feedback)==null?void 0:f.lightweight_reactions)==null?void 0:y.reduce((o,n)=>{var t;return o+((t=n==null?void 0:n.messaging_actions)==null?void 0:t.count)},0),seen_time:((i==null?void 0:i.seen_time)||0)*1e3,cursor:i==null?void 0:i.cursor}}async function St({storyId:i="",cursor:e=""}={}){const _=await J({fb_api_req_friendly_name:"StoriesViewerSheetViewerListContentQuery",variables:{cursor:e,id:i,viewerCount:8},doc_id:"3934951263269875"}),c=JSON.parse(_.split(`
`)[0]||"{}");console.log(c);const{edges:l=[],page_info:r={}}=it(c)||{};return l.map(mt)}async function It(i=""){var l,r,s,f,y;const e=await J({variables:{scale:1,userID:i,useIncrementalDelivery:!0},doc_id:"4192155837522535"}),_=JSON.parse(e.split(`
`)[0]||"{}"),c=(f=(s=(r=(l=_==null?void 0:_.data)==null?void 0:l.user)==null?void 0:r.story_bucket)==null?void 0:s.nodes)==null?void 0:f[0];return console.log(_),{bucketId:c==null?void 0:c.id,firstStoryId:(y=c==null?void 0:c.first_story_to_show)==null?void 0:y.id}}async function Dt(i="",e=""){var l,r,s,f,y,o;const _=await J({fb_api_req_friendly_name:"useStoriesSendReplyMutation",variables:{input:{lightweight_reaction_actions:{offsets:[0],reaction:e},story_id:i,story_reply_type:"LIGHT_WEIGHT",actor_id:await rt(),client_mutation_id:7}},doc_id:"3769885849805751"}),c=JSON.parse(_);return console.log(c),(o=(y=(f=(s=(r=(l=c==null?void 0:c.data)==null?void 0:l.direct_message_reply)==null?void 0:r.story)==null?void 0:s.story_card_info)==null?void 0:f.story_card_reactions)==null?void 0:y.edges)==null?void 0:o.length}export{ht as a,wt as b,St as c,bt as d,vt as e,It as g,Dt as r};
