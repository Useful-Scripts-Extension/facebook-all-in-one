const __vite__fileDeps=["./MyTable-DRI3-laQ.js","./index-DIq5bgLX.js","./index-BM_p-30O.css","./MyApp-MiOxcIdU.js","./styleChecker-DjVX5rm6.js","./addEventListener-3oSyDV2P.js","./index-DAXXZz2T.js","./PurePanel-CmkTJSAT.js","./TextArea-CAjRjfaX.js","./index-DCLDF7j6.js","./index-C_eP70Gq.js","./Dropdown-mqs4Afzo.js","./useBreakpoint-DVjXUw1O.js","./responsiveObserver-DiKIXTRH.js","./Pagination-CCda05l4.js","./row-DBSFeXDE.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{al as G,am as Q,r as w,aq as n,ar as g,au as Z,aJ as R,aw as N}from"./index-DIq5bgLX.js";import{a as ee,t as v,S as f,g as y,y as te,T as x,o as ne,r as A,D as H}from"./MyApp-MiOxcIdU.js";import{u as ie}from"./useForceStop-CXNAI4wo.js";import{u as U}from"./useCacheState-BGfzTj7R.js";import{P as se}from"./index-vuHwb1ab.js";import{E as ae}from"./ExportButton-CrRZQ7Vo.js";import{g as re,a as le,U as h,u as oe,d as ce}from"./pages-D1DeBmWZ.js";import{I as _}from"./index-DAVJbk9H.js";import{T as L}from"./index-BbvbHeDH.js";import{T as E}from"./index-DOpCD4lY.js";import{P as b}from"./index-D9Qk86Dy.js";import{R as de}from"./row-DBSFeXDE.js";import"./file-download-BAVwK8SC.js";import"./index-C_eP70Gq.js";import"./Dropdown-mqs4Afzo.js";import"./PurePanel-CmkTJSAT.js";import"./addEventListener-3oSyDV2P.js";import"./styleChecker-DjVX5rm6.js";import"./TextArea-CAjRjfaX.js";import"./index-B6j4e2LE.js";import"./responsiveObserver-DiKIXTRH.js";const he=w.lazy(()=>Z(()=>import("./MyTable-DRI3-laQ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url));function $e(){const{message:c,notification:u}=G.useApp(),V=Q(),{ti:i}=ee(),W=ie(),[m,k]=U("Pages.data",[]),[K,S]=U("Pages.finished",!1),[$,F]=w.useState(!1);w.useEffect(()=>{K||B(!1)},[]);const B=async(e=!1)=>{var a;if($&&!e)return;const t=W.start(),s=e?[]:[...m],l=new Set(s.map(r=>r.id)),o="Pages:onReload";v(o),F(!0),S(!1);try{const d=(await re()).filter(p=>!l.has(p.id));d!=null&&d.length&&(s.push(...d),k([...s]));const D=s[s.length-1];let M=e?"":D==null?void 0:D.cursor;for(;!t.value();){c.loading({key:o,content:i({en:"Loading pages...",vi:"Đang tải trang..."})+s.length,duration:0});const p=await le(M),j=p==null?void 0:p.filter(T=>!l.has(T.id));if(p.forEach(T=>l.add(T.id)),!(j!=null&&j.length))break;s.push(...j),M=(a=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:a.cursor,k([...s])}c.success({key:o,content:(t.value()?i({en:"Load pages stopped ",vi:"Dừng tải trang "}):i({en:"Load pages completed ",vi:"Tải xong trang "}))+s.length}),S(!t.value())}catch(r){c.error({content:i({en:"Failed to load pages: ",vi:"Lỗi tải trang: "})+r.message})}finally{F(!1)}},z=async e=>{if(!(e!=null&&e.length))return;const t="Pages:onClickUnlikeSelectedPages",s="Pages:onClickUnlikeSelectedPages:waiting";v(t);let l=!1,o=[];for(let a=0;a<e.length&&(c.destroy(s),c.loading({key:t,content:n.jsxs(n.Fragment,{children:[i({en:"Unliking pages... ",vi:"Đang bỏ thích trang... "})+(a+1)+"/"+e.length,n.jsx("br",{}),n.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{c.loading({key:t,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),l=!0}}),await I(e[a])&&o.push(e[a]),!l);a++)if(a<e.length-1){const d=H(2e3,5e3);c.loading({key:s,content:i({en:"Sleeping "+Math.round(d/1e3)+"s",vi:"Đang đợi "+Math.round(d/1e3)+"s"}),duration:0}),await A(d)}c.destroy(t),c.destroy(s),u.success({duration:0,message:i({en:`Unliked ${o.length}/${e.length} pages`,vi:`Đã bỏ thích ${o.length}/${e.length} trang`}),description:n.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:n.jsx("ol",{children:o.map(a=>n.jsx("li",{children:n.jsx("a",{target:"_blank",href:y(a.id),children:a.name})},a.id))})})})},I=async e=>{const t="Pages:onClickUnlikePage";v(t),c.loading({key:t,content:i({en:"Unliking page... "+e.name,vi:"Đang bỏ thích trang..."+e.name}),duration:0});const s=await oe(e.id);return s?(u.destroy(t),c.success({key:t,content:i({en:"Unliked page "+e.name,vi:"Đã bỏ thích trang "+e.name})}),k(l=>R(l,o=>{const a=o.findIndex(r=>r.id==e.id);return o[a].userType=h.UNLIKED,o}))):(c.destroy(t),u.error({key:t,message:i({en:"Failed to unlike page",vi:"Lỗi bỏ thích trang"}),description:e.name,duration:0,btn:n.jsxs(f,{children:[n.jsx(g,{type:"default",onClick:()=>I(e),children:i({en:"Retry",vi:"Thử lại"})}),n.jsx(g,{type:"primary",onClick:()=>window.open(y(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),s},O=async e=>{if(!(e!=null&&e.length))return;const t="Pages:onClickDeclineSelectedInvites",s="Pages:onClickDeclineSelectedInvites:waiting";v(t);let l=!1,o=[];for(let a=0;a<e.length&&(c.destroy(s),c.loading({key:t,content:n.jsxs(n.Fragment,{children:[i({en:"Removing invite... ",vi:"Đang từ chối... "})+(a+1)+"/"+e.length,n.jsx("br",{}),n.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{c.loading({key:t,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),l=!0}}),await C(e[a])&&o.push(e[a]),!l);a++)if(a<e.length-1){const d=H(2e3,5e3);c.loading({key:s,content:i({en:"Sleeping "+Math.round(d/1e3)+"s",vi:"Đang đợi "+Math.round(d/1e3)+"s"}),duration:0}),await A(d)}c.destroy(t),c.destroy(s),u.success({duration:0,message:i({en:`Declined ${o.length}/${e.length} invites`,vi:`Đã từ chối ${o.length}/${e.length} lời mời`}),description:n.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:n.jsx("ol",{children:o.map(a=>n.jsx("li",{children:n.jsx("a",{target:"_blank",href:y(a.id),children:a.name})},a.id))})})})},C=async e=>{const t="Pages:onClickDeclineInvite";v(t),c.loading({key:t,content:i({en:"Declining invite... "+e.name,vi:"Đang từ chối lời mời..."+e.name}),duration:0});const s=await ce(e.inviteId);return s?(u.destroy(t),c.success({key:t,content:i({en:"Removed invite "+e.name,vi:"Đã từ chối lời mời "+e.name})}),k(l=>R(l,o=>{const a=o.findIndex(r=>r.id==e.id);return o[a].userType=h.DECLINED,o}))):(c.destroy(t),u.error({key:t,message:i({en:"Failed to remove invite",vi:"Lỗi từ chối lời mời"}),description:e.name,duration:0,btn:n.jsxs(f,{children:[n.jsx(g,{type:"default",onClick:()=>C(e),children:i({en:"Retry",vi:"Thử lại"})}),n.jsx(g,{type:"primary",onClick:()=>window.open(y(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),s},X=e=>{V("/bulk-downloader",{state:{targetId:e.id,platform:se.Facebook}})},q=e=>{var o,a;const t=e!=null&&e.length?[...e]:[...m],s=((o=t==null?void 0:t.map(r=>m.find(d=>d.id===r.id)))==null?void 0:o.filter(r=>r&&r.userType===h.LIKED))||[],l=((a=t==null?void 0:t.map(r=>m.find(d=>d.id===r.id)))==null?void 0:a.filter(r=>r&&r.userType===h.INVITED))||[];return n.jsxs(n.Fragment,{children:[n.jsx(x,{color:"red",title:i({en:"WARNING: Reload many times may be temporarily blocked by facebook",vi:"LƯU Ý: Tải lại nhiều lần có thể bị facebook chặn tạm thời"}),children:n.jsx(g,{type:"primary",icon:$?n.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):n.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>B(!0),children:i({en:"Reload",vi:"Tải lại"})})}),n.jsx(ae,{data:t,options:[{key:"id",label:".txt (page id)",prepareData:r=>({fileName:"your_pages_id"+N().format("YYYY-MM-DD-HHmmss")+".txt",data:r==null?void 0:r.map(d=>d.id).join(`
`)})},{key:"json",label:".json",prepareData:r=>({fileName:"your_pages"+N().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(r,null,4)})},{key:"csv",label:".csv",prepareData:r=>({fileName:"your_pages"+N().format("YYYY-MM-DD-HHmmss")+".csv",data:ne(r)})}]}),n.jsx(x,{title:i({en:`Unlike ${s.length} selected pages`,vi:`Bỏ thích ${s.length} trang được chọn`}),children:n.jsx(b,{title:i({en:`Unlike ${s.length} pages`,vi:`Bỏ thích ${s.length} trang`}),description:i({en:`Are your sure want to unlike ${s.length} pages?`,vi:`Bản có chãc muốn bỏ thích ${s.length} trang?`}),onConfirm:()=>z(s),okText:i({en:"Unlike pages",vi:"Bỏ thích trang"}),cancelText:i({en:"No",vi:"Huỷ"}),children:n.jsx(g,{danger:!0,type:"primary",disabled:s.length<=0,icon:n.jsx("i",{className:"fa-regular fa-trash-can"}),children:s.length})})}),l.length>0&&n.jsx(x,{title:i({en:`Decline ${l.length} selected invites`,vi:`Từ chối ${l.length} lời mời được chọn`}),children:n.jsx(b,{title:i({en:`Decline ${l.length} invites`,vi:`Từ chối ${l.length} lời mời`}),description:i({en:`Are your sure want to decline ${l.length} invites?`,vi:`Bản có chãc muốn từ chối ${l.length} lời mời?`}),onConfirm:()=>O(l),okText:i({en:"Yes",vi:"Có"}),cancelText:i({en:"No",vi:"Huỷ"}),children:n.jsx(g,{danger:!0,type:"primary",disabled:l.length<=0,icon:n.jsx("i",{className:"fa-solid fa-xmark"}),children:l.length})})}),n.jsx(g,{icon:n.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/pages/?category=liked","_blank"),children:i({en:"View on Facebook",vi:"Xem trên Facebook"})})]})},P=e=>{switch(e){case h.ADMIN:return{color:"success",text:i({en:"Admin",vi:"Admin"})};case h.LIKED:return{color:"default",text:i({en:"Liked",vi:"Đã thích"})};case h.INVITED:return{color:"warning",text:i({en:"Invited",vi:"Lời mời"})};case h.DECLINED:return{color:"error",text:i({en:"Declined",vi:"Từ chối"})};case h.UNLIKED:return{color:"error",text:i({en:"Unliked",vi:"Bỏ thích"})};default:return{color:"default",text:"?"}}},Y=w.useMemo(()=>Array.from(m.map(e=>e.category).reduce((e,t)=>{let s=e.get(t)||0;return e.set(t,++s)},new Map).entries()).sort((e,t)=>t[1]-e[1]).map(([e,t])=>({text:e+" ("+t+")",value:e})),[m]),J=[{title:i({en:"Image",vi:"Ảnh"}),key:"image",dataIndex:"image",render:(e,t,s)=>n.jsx(_,{src:t.image,width:50,height:50,style:{objectFit:"contain",borderRadius:5}})},{title:i({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",render:(e,t,s)=>n.jsxs(f,{direction:"vertical",size:0,style:{maxWidth:300},children:[n.jsx(L.Link,{href:t.url,target:"_blank",children:n.jsx("b",{children:t.name||"???"})}),n.jsx("span",{style:{opacity:.7},children:t.id})]})},{title:i({en:"Category",vi:"Danh mục"})+" ("+Y.length+")",key:"category",dataIndex:"category",filters:Y,onFilter:(e,t)=>t.category==e,filterSearch:!0},{title:i({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,t,s)=>{const{color:l,text:o}=P(t.userType);return t.inviterId?n.jsxs(f,{children:[n.jsx(E,{color:l,children:o}),n.jsx(_,{src:t.inviterAvatar,width:40,height:40,style:{borderRadius:5}}),n.jsx(L.Link,{href:y(t.inviterId),target:"_blank",children:t.inviterName})]}):n.jsx(E,{color:l,children:o})},filters:Object.values(h).map(e=>{const{text:t}=P(e);return{text:t+" ("+m.filter(s=>s.userType==e).length+")",value:e}}),onFilter:(e,t)=>t.userType==e,onSearch:(e,t,s)=>te(e,P(t).text+s.inviterName),align:"left"},{title:i({en:"Action",vi:"Hành động"}),key:"action",render:(e,t,s)=>n.jsxs(f.Compact,{style:{minWidth:30},children:[n.jsx(x,{title:i({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:n.jsx(g,{type:"default",onClick:()=>X(t),icon:n.jsx("i",{className:"fa-solid fa-download"})})}),t.userType===h.LIKED?n.jsx(x,{title:i({en:"Unlike page",vi:"Bỏ thích trang"}),children:n.jsx(b,{title:i({en:"Unlike page",vi:"Bỏ thích trang"}),description:i({en:"Are you sure want to unlike this page?",vi:"Bạn có chắc muốn bỏ thích trang này?"}),onConfirm:()=>I(t),okText:i({en:"Unlike",vi:"Bỏ thích"}),cancelText:i({en:"No",vi:"Huỷ"}),children:n.jsx(g,{danger:!0,type:"primary",icon:n.jsx("i",{className:"fa-regular fa-trash-can"})})})}):null,t.userType===h.INVITED?n.jsx(x,{title:i({en:"Decline invite",vi:"Từ chối"}),children:n.jsx(b,{title:i({en:"Decline invite",vi:"Từ chối"}),description:i({en:"Decline this invite?",vi:"Từ chối lời mời này?"}),onConfirm:()=>C(t),okText:i({en:"Yes",vi:"Từ chối"}),cancelText:i({en:"No",vi:"Huỷ"}),children:n.jsx(g,{danger:!0,type:"primary",icon:n.jsx("i",{className:"fa-solid fa-xmark"})})})}):null]}),width:100,align:"right"}];return n.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[n.jsxs(de,{align:"middle",style:{margin:"16px"},children:[n.jsx(L.Title,{level:3,style:{margin:0},children:i({en:"Pages manager",vi:"Quản lý trang"})}),n.jsx(E,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:m.length})]}),n.jsx(he,{data:m,columns:J,renderTitle:q,size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e.id})]})}export{$e as default};
