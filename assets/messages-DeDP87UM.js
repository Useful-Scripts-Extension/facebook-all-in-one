import{d as w}from"./dayjs.min-CYfkjC6v.js";import{A as u,h as y,K as b}from"./MyApp-VKLikG1Z.js";const M="YYYY-MM-DD",v=w("2004-01-01",M);async function q(){return(await Promise.all([u("viewer(){message_threads{count,nodes{customization_info{emoji,outgoing_bubble_color,participant_customizations{participant_id,nickname}},all_participants{nodes{messaging_actor{name,id,profile_picture}}},thread_type,name,messages_count,image,id}}}").then(a=>JSON.parse(a||"{}")),u({queries:{o0:{doc_id:"1475048592613093",query_params:{limit:500,before:Date.now(),tags:["ARCHIVED"],includeDeliveryReceipts:!0,includeSeqID:!1}}}},"https://www.facebook.com/api/graphqlbatch/").then(a=>{var t,e,r;return(r=(e=JSON.parse(((t=a==null?void 0:a.split(`
`))==null?void 0:t[0])||"{}"))==null?void 0:e.o0)==null?void 0:r.data})])).map(a=>{var t,e;return(e=(t=a==null?void 0:a.viewer)==null?void 0:t.message_threads)==null?void 0:e.nodes}).filter(Boolean).flat().map((a,t)=>({...a,recent:t})).map(a=>{var r,o,c,d,l,p;let t=a.all_participants.nodes.map(m=>{var _,g,h;return{id:m.messaging_actor.id,name:m.messaging_actor.name,avatar:((_=m.messaging_actor.profile_picture)==null?void 0:_.uri)||((h=(g=m.messaging_actor.avatar)==null?void 0:g.big_image_src)==null?void 0:h.uri)||y(m.messaging_actor.id)}}),e={recent:a.recent,type:a.thread_type,id:((r=a.thread_key)==null?void 0:r.other_user_id)||((o=a.thread_key)==null?void 0:o.thread_fbid)||(a.id?(d=(c=atob(a.id))==null?void 0:c.split(":"))==null?void 0:d[1]:""),count:a.messages_count,name:a.name||((l=t[0])==null?void 0:l.name)||"-no data-",participants:t,image:(p=a.image)==null?void 0:p.uri};return{...e,url:`https://www.facebook.com/messages/t/${e.id}`,isGroup:e.type==="GROUP"||e.type==="COMMUNITY_GROUP"}})}async function f({friendUid:i,startTime:n=v.valueOf(),endTime:s=w().valueOf(),progress:a}){let t=1e3*Math.round((n+s)/2/1e3);a==null||a(t);let e=await A({friendUid:i,time:t,limit:1});return Math.abs(s-n)<=1e3?e:e!=null&&e.length?await f({friendUid:i,startTime:n,endTime:t-1,progress:a}):await f({friendUid:i,startTime:t+1,endTime:s,progress:a})}async function D({friendUid:i,msgId:n,direction:s="down",limit:a=50}){var o;const t=await u({other_user_fbid:i,message_id:n,direction:s,limit:a,__a:1},"https://www.facebook.com/ajax/mercury/search_context.php"),e=JSON.parse(t.substr(9)),r=(o=e==null?void 0:e.payload)==null?void 0:o.graphql_payload;return r||new Error("There is no results.")}async function A({friendUid:i,time:n=null,limit:s=50}){var t;const a=await u({queries:{o0:{doc_id:"1526314457427586",query_params:{id:i,message_limit:s,load_messages:1,load_read_receipts:!0,before:n}}}},"https://www.facebook.com/api/graphqlbatch/");try{const e=JSON.parse(a.split(`
`)[0]);if(e.o0.data.message_thread)return((t=e.o0.data.message_thread.messages)==null?void 0:t.nodes)||[]}catch(e){console.error(e.message)}return[]}async function S(i){var s,a,t,e,r,o;return(o=(r=(e=(t=(a=(s=(await b(i)).raw)==null?void 0:s.data)==null?void 0:a.node)==null?void 0:t.comet_hovercard_renderer)==null?void 0:e.user)==null?void 0:r.primaryActions)==null?void 0:o.find(c=>(c==null?void 0:c.profile_action_type)=="MESSAGE")}export{A as a,D as b,S as c,f,q as g,v as m};
