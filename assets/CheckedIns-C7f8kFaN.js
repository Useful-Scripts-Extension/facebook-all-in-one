import{at as A,aD as E,r as S,av as l,aw as b,aO as F}from"./index-BK9qCNpo.js";import{A as B,C as L,u as R,d as M,w as g,t as O,b as P,T as D,o as T}from"./MyApp-KprBrH59.js";import{u as q}from"./useForceStop-B_z_jqaz.js";import J from"./MyTable-BJ3aoanP.js";import{E as Q}from"./ExportButton-BwTehzLN.js";import{I as X}from"./index-Dl6g14zv.js";import{T as $}from"./index-BLfDZMhm.js";import{A as z}from"./index-DL9hAwRK.js";import"./index-DYv1WOvT.js";import"./Table-3vFK2DZI.js";import"./addEventListener-DkVO5My1.js";import"./index-DHeOvKpk.js";import"./PurePanel-D-acr7dq.js";import"./SearchOutlined-D9fOO97r.js";import"./index-CzVMtVNG.js";import"./index-DkFoMYKp.js";import"./index-B0ThorHi.js";import"./Dropdown-kJvbiFmn.js";import"./index-fvVy-agd.js";import"./useBreakpoint-BPhYmOEZ.js";import"./responsiveObserver-iFkZEcCe.js";import"./Pagination-BsADF-XU.js";import"./index-BS-lKpfp.js";import"./EyeOutlined-Bg3r5MgD.js";import"./row-Ddbct3SU.js";import"./file-download-Bl6_Kgkl.js";async function G({uid:n="",cursor:s=""}){const I=await B({fb_api_req_friendly_name:"ProfileCometAppCollectionListRendererPaginationQuery",variables:{cursor:s,count:8,scale:2,search:null,id:btoa("app_collection:"+n+":302324425790:103")},doc_id:"25969811035995761"}),C=JSON.parse(I),{edges:_=[],page_info:p={}}=L(C);return _.map(i=>{var t,m,d,u,k,y,v,a,e,o,r,h,N,x,f,c,j,w;return{id:(t=i==null?void 0:i.node)==null?void 0:t.id,pageId:(d=(m=i==null?void 0:i.node)==null?void 0:m.node)==null?void 0:d.id,pageName:(k=(u=i==null?void 0:i.node)==null?void 0:u.title)==null?void 0:k.text,place:(e=(a=(v=(y=i==null?void 0:i.node)==null?void 0:y.subtitle_text)==null?void 0:v.text)==null?void 0:a.split(`
`))==null?void 0:e[0],image:(r=(o=i==null?void 0:i.node)==null?void 0:o.image)==null?void 0:r.uri,url:((h=i==null?void 0:i.node)==null?void 0:h.url)||((x=(N=i==null?void 0:i.node)==null?void 0:N.node)==null?void 0:x.url),timeString:(w=(j=(c=(f=i==null?void 0:i.node)==null?void 0:f.subtitle_text)==null?void 0:c.text)==null?void 0:j.split(`
`))==null?void 0:w[1],cursor:(i==null?void 0:i.cursor)||(p==null?void 0:p.end_cursor)}})}function ve({target:n}){const{ti:s}=R(),{message:I}=A.useApp(),C=E(),_=q(),[p,i]=S.useState(!1),[t,m]=M("CheckedIns.data."+(n==null?void 0:n.id),[]),d=S.useMemo(()=>{const a=new Map,e=new Map;return t.forEach(o=>{a.has(o.place)||a.set(o.place,o),e.has(o.pageId)||e.set(o.pageId,o)}),{allPlaces:Array.from(a.values()),allPages:Array.from(e.values())}},[t]);S.useEffect(()=>{var a;n!=null&&n.id&&u(!((a=g("CheckedIns.data."+(n==null?void 0:n.id)))!=null&&a.length))},[n==null?void 0:n.id]);const u=async(a=!1)=>{var x,f;if(!(n!=null&&n.id))return;const e=_.start();let r=[...a?[]:g("CheckedIns.data."+(n==null?void 0:n.id))||[]],h=((x=r[r.length-1])==null?void 0:x.cursor)||"";O("CheckedIns:onReload"),i(!0);try{for(;!e.value();){const c=await G({uid:n.id,cursor:h});if(!(c!=null&&c.length))break;h=(f=c[c.length-1])==null?void 0:f.cursor,r=[...r,...c].map((j,w)=>({...j,recent:w})),m(r)}}catch(c){I.error({content:s({en:"Error: ",vi:"Lỗi: "})+c.message})}finally{m(r),i(!1)}},k=a=>{C("/bulk-downloader",{state:{targetId:a,platform:F.Facebook}})},y=a=>l.jsxs(P,{children:[l.jsx(b,{disabled:p,type:"primary",icon:p?l.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):l.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>u(!0),children:s({en:"Reload",vi:"Tải lại"})}),l.jsx(Q,{data:a.length?a:t,options:[{key:"id",label:".txt (page id)",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in_id.txt",data:e.map(o=>o.pageId).join(`
`)})},{key:"id_name",label:".csv (page id+name)",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in_id_name.csv",data:T(e.map(o=>({page:o.pageId,name:o.pageName,place:o.place})))})},{key:"json",label:".json",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in.json",data:JSON.stringify(e,null,4)})},{key:"csv",label:".csv",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in.csv",data:T(e)})}]}),l.jsx(b,{onClick:()=>{var e;(e=n==null?void 0:n.url)!=null&&e.includes("?id=")?window.open((n==null?void 0:n.url)+"&sk=map","_blank"):window.open((n==null?void 0:n.url)+"/map","_blank")},icon:l.jsx("i",{className:"fa fa-external-link-alt"}),children:s({vi:"Xem trên Facebook",en:"View on Facebook"})},"view-fb")]}),v=[{title:"#",dataIndex:"recent",key:"recent",render:(a,e,o)=>(e.recent||0)+1,sorter:(a,e)=>a.recent-e.recent,width:60},{title:s({en:"Cover",vi:"Ảnh"}),key:"cover",dataIndex:"image",render:(a,e,o)=>l.jsx(X,{src:e.image,style:{width:120,height:120,objectFit:"contain"}}),width:120},{title:d.allPages.length+" "+s({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",sorter:(a,e)=>a.pageName.localeCompare(e.pageName),render:(a,e,o)=>l.jsxs(P,{direction:"vertical",style:{maxWidth:250},children:[l.jsx($.Link,{href:e.url,target:"_blank",children:l.jsx("b",{children:e.pageName})}),l.jsx("span",{style:{opacity:.6},children:e.pageId})]}),filters:d.allPages.map(a=>{let e=t.filter(o=>o.pageId===a.pageId).length;return{count:e,value:a.pageId,text:a.pageName+" ("+e+")"}}).sort((a,e)=>e.count-a.count),onFilter:(a,e)=>e.pageId==a,filterSearch:!0},{title:d.allPlaces.length+" "+s({en:"Place",vi:"Địa điểm"}),key:"place",dataIndex:"place",sorter:(a,e)=>a.place.localeCompare(e.place),filters:d.allPlaces.map(a=>{let e=t.filter(o=>o.place===a.place).length;return{count:e,value:a.place,text:a.place+" ("+e+")"}}).sort((a,e)=>e.count-a.count),onFilter:(a,e)=>e.place==a,filterSearch:!0,width:200},{title:s({en:"Time",vi:"Thời gian"}),key:"timeString",dataIndex:"timeString",sorter:(a,e)=>a.timeString.localeCompare(e.timeString),width:250},{title:s({en:"Actions",vi:"Hành động"}),key:"actions",render:(a,e,o)=>l.jsxs(P.Compact,{children:[l.jsx(D,{title:s({en:"Show map",vi:"Xem bản đồ"}),children:l.jsx(b,{type:"default",onClick:()=>{window.open("https://www.google.com/maps/search/"+e.pageName,"_blank")},icon:l.jsx("i",{className:"fa-solid fa-location-dot"})})}),l.jsx(D,{title:s({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:l.jsx(b,{type:"default",onClick:()=>k(e.pageId),icon:l.jsx("i",{className:"fa-solid fa-download"})})})]}),width:100,align:"end"}];return l.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[l.jsx(z,{type:"success",showIcon:!0,message:s({en:`Checked in ${t.length} times`,vi:`Đã check in ${t.length} lần`}),style:{alignSelf:"center",marginBottom:10}}),l.jsx(J,{columns:v,data:t,keyExtractor:a=>a==null?void 0:a.id,searchable:!0,pageSize:3,renderTitle:y})]})}export{ve as default};
