const __vite__fileDeps=["./MyTable-XIw2FkM-.js","./index-DPONv-AB.js","./index-BM_p-30O.css","./MyApp-DEIUhxeN.js","./styleChecker-CyKTA426.js","./addEventListener-DR_NM1NW.js","./index-HNqxY7iK.js","./PurePanel-DNavI3ZW.js","./TextArea-1Q1I5EX3.js","./index-C-h6N-6y.js","./index-nAq8iqIJ.js","./Dropdown-BxPBQoTL.js","./Pagination-2Ahrgyjg.js","./row-CuIGguQJ.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{al as O,az as U,r as b,ap as e,aq as h,at as z,av as T}from"./index-DPONv-AB.js";import{a as W,t as G,Q as J,U as c,V as K,S as y,W as D,T as g,X as Q,P as X,o as q,A as Z,b as ee,Y as te}from"./MyApp-DEIUhxeN.js";import{u as ne}from"./useForceStop-BfgY8bIa.js";import{E as ie}from"./ExportButton-CiFHU8Ur.js";import{u as E,g as se,s as re}from"./useCacheState-CJv9KMn_.js";import{A as oe}from"./index-BR4Pt_VD.js";import{T as L}from"./index-DRtX_-IA.js";import{T as R}from"./index-DFUzF-Fj.js";import{P as Y}from"./index-Bo5Y1njE.js";import{R as ae}from"./row-CuIGguQJ.js";import"./file-download-Db6M2NsT.js";import"./index-nAq8iqIJ.js";import"./Dropdown-BxPBQoTL.js";import"./PurePanel-DNavI3ZW.js";import"./TextArea-1Q1I5EX3.js";import"./styleChecker-CyKTA426.js";const le=b.lazy(()=>z(()=>import("./MyTable-XIw2FkM-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url));function we({}){const{message:a,notification:A}=O.useApp(),B=U(),{ti:n}=W(),_=ne(),[d,F]=E("Groups.data",[]),[I,V]=E("Groups.finished",!1),[v,N]=b.useState(!1);b.useEffect(()=>{se("Groups.finished")||j(!1)},[]);const j=async(t=!1)=>{var o;if(v&&!t)return;const i=_.start(),s=t?[]:[...d],l=new Set(s.map(u=>u.id)),r="Groups:onReload";G(r),N(!0),a.loading({key:r,content:n({en:"Loading groups...",vi:"Đang tải nhóm..."}),duration:0});try{for(const[u,m]of[[J,c.ADMIN],[K,c.MEMBER]]){const p=s[s.length-1];let M=t?"":(p==null?void 0:p.userType)===m?p==null?void 0:p.cursor:"";for(;!i.value();){const f=await u({cursor:M}),x=f==null?void 0:f.filter(k=>!l.has(k.id));if(f.forEach(k=>l.add(k.id)),!(x!=null&&x.length))break;s.push(...x),M=(o=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:o.cursor,F([...s]),a.loading({key:r,content:n({en:"Loading groups...",vi:"Đang tải nhóm..."})+s.length,duration:0})}}a.success({key:r,content:(i.value()?n({en:"Load groups stopped ",vi:"Dừng tải nhóm "}):n({en:"Load groups completed ",vi:"Tải xong nhóm "}))+s.length}),re("Groups.finished",!i.value()),V(!i.value())}catch(u){a.error({content:n({en:"Failed to load groups: ",vi:"Lỗi tải nhóm: "})+u.message})}finally{a.destroy(r),N(!1)}},H=async t=>{if(!(t!=null&&t.length))return;const i="Groups:onClickLeaveSelectedGroups",s="Groups:onClickLeaveSelectedGroups:waiting";G(i);let l=!1,r=[];for(let o=0;o<t.length&&(a.destroy(s),a.loading({key:i,content:e.jsxs(e.Fragment,{children:[n({en:"Leaving groups... ",vi:"Đang rời nhóm... "})+(o+1)+"/"+t.length,e.jsx("br",{}),e.jsx("i",{children:n({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{a.loading({key:i,content:n({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),l=!0}}),await w(t[o])&&r.push(t[o]),!l);o++)if(o<t.length-1){const m=te(2e3,5e3);a.loading({key:s,content:n({en:"Sleeping "+Math.round(m/1e3)+"s",vi:"Đang đợi "+Math.round(m/1e3)+"s"}),duration:0}),await Z(m)}a.destroy(i),a.destroy(s),A.success({duration:0,message:n({en:`Left ${r.length}/${t.length} groups`,vi:`Đã rời ${r.length}/${t.length} nhóm`}),description:e.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:e.jsx("ol",{children:r.map(o=>e.jsx("li",{children:e.jsx("a",{target:"_blank",href:ee(o.id),children:o.name})},o.id))})})})},w=async t=>{Q("424654768420327")},$=t=>{B("/bulk-downloader",{state:{targetId:t.id,platform:X.Facebook}})},S=t=>{var l;const i=t!=null&&t.length?[...t]:[...d],s=((l=i==null?void 0:i.map(r=>d.find(o=>o.id===r.id)))==null?void 0:l.filter(r=>r&&(r.userType===c.MEMBER||r.userType===c.ADMIN)))||[];return e.jsxs(e.Fragment,{children:[e.jsxs(y.Compact,{children:[e.jsx(g,{title:n({en:"Reload all groups",vi:"Tải lại toàn bộ groups"}),children:e.jsx(h,{type:"primary",icon:v?e.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):e.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>j(!0),children:n({en:"Reload",vi:"Tải lại"})})}),d.length&&!I&&!v?e.jsx(g,{title:n({en:"Continue load groups from index ",vi:"Tiếp tục tải nhóm từ vị trí "})+d.length,children:e.jsx(h,{icon:e.jsx("i",{className:"fa-solid fa-play"}),onClick:()=>j(!1),children:n({en:"Continue",vi:"Tải tiếp"})})}):null]}),e.jsx(ie,{data:t.length?t:d,options:[{key:"id",label:".txt (group id)",prepareData:r=>({fileName:"your_groups_id"+T().format("YYYY-MM-DD-HHmmss")+".txt",data:r==null?void 0:r.map(o=>o.id).join(`
`)})},{key:"json",label:".json",prepareData:r=>({fileName:"your_groups"+T().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(r==null?void 0:r.map(o=>({...o,last_visited:D(o.lastVisitedTime,n({en:"en-US",vi:"vi-VN"}))})),null,4)})},{key:"csv",label:".csv",prepareData:r=>({fileName:"your_groups"+T().format("YYYY-MM-DD-HHmmss")+".csv",data:q(r)})}]}),e.jsx(g,{title:n({en:`Leave ${s.length} selected groups`,vi:`Rời ${s.length} nhóm được chọn`}),children:e.jsx(Y,{title:n({en:`Leave ${s.length} groups`,vi:`Rời ${s.length} nhóm`}),description:n({en:`Are your sure want to Leave ${s.length} groups?`,vi:`Bản có chãc muốn rời ${s.length} nhóm?`}),onConfirm:()=>H(s),okText:n({en:"Leave groups",vi:"Rời nhóm"}),cancelText:n({en:"No",vi:"Huỷ"}),children:e.jsx(h,{danger:!0,type:"primary",disabled:s.length<=0,icon:e.jsx("i",{className:"fa-regular fa-trash-can"}),children:s.length})})}),e.jsx(h,{icon:e.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/groups/joins","_blank"),children:n({en:"View on Facebook",vi:"Xem trên Facebook"})})]})},C=t=>{switch(t){case c.MEMBER:return{color:"default",text:n({en:"Member",vi:"Thành viên"})};case c.ADMIN:return{color:"success",text:"Admin"};case c.NOT_JOINED:return{color:"error",text:n({en:"Left group",vi:"Đã rời nhóm"})};case c.PENDING:return{color:"warning",text:n({en:"Pending",vi:"Đang chờ"})};default:return{color:"default",text:"?"}}},P=[{title:n({en:"Group",vi:"Nhóm"}),key:"group",dataIndex:"group",sorter:(t,i)=>t.name.localeCompare(i.name),render:(t,i,s)=>e.jsxs(y,{style:{maxWidth:400},align:"start",children:[e.jsx(oe,{src:i.avatar,size:45}),e.jsxs(y,{direction:"vertical",size:0,children:[e.jsx(L.Link,{href:i.url,target:"_blank",children:e.jsx("b",{children:i.name})}),e.jsx("span",{style:{opacity:.7},children:i.id})]})]})},{title:n({en:"Last visit",vi:"Lần xem gần nhất"}),key:"lastVisitedTime",dataIndex:"lastVisitedTime",sorter:(t,i)=>t.lastVisitedTime-i.lastVisitedTime,render:(t,i,s)=>D(i.lastVisitedTime,n({en:"en-US",vi:"vi-VN"})),align:"right"},{title:n({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(t,i,s)=>{const{color:l,text:r}=C(i.userType);return e.jsx(R,{color:l,children:r})},filters:Object.values(c).map(t=>{const{text:i}=C(t);return{text:i+" ("+d.filter(s=>s.userType==t).length+")",value:t}}),onFilter:(t,i)=>i.userType==t,align:"right"},{title:n({en:"Action",vi:"Hành động"}),key:"action",render:(t,i,s)=>e.jsxs(y.Compact,{style:{minWidth:30},children:[e.jsx(g,{title:n({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:e.jsx(h,{type:"default",onClick:()=>$(i),icon:e.jsx("i",{className:"fa-solid fa-download"})})}),i.userType!==c.NOT_JOINED?e.jsx(g,{title:n({en:"Leave group",vi:"Rời nhóm"}),children:e.jsx(Y,{title:n({en:"Leave group",vi:"Rời nhóm"}),description:n({en:"Are you sure want to leave this group?",vi:"Bạn có chắc muốn rời nhóm này?"}),onConfirm:()=>w(),okText:n({en:"Yes",vi:"Có"}),cancelText:n({en:"No",vi:"Huỷ"}),children:e.jsx(h,{danger:!0,type:"primary",icon:e.jsx("i",{className:"fa-regular fa-trash-can"})})})}):null]}),align:"right"}];return e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[e.jsxs(ae,{align:"middle",style:{margin:"16px"},children:[e.jsx(L.Title,{level:3,style:{margin:0},children:n({en:"Groups manager",vi:"Quản lý nhóm"})}),e.jsx(R,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:d.length})]}),e.jsx(le,{data:d,columns:P,renderTitle:S,size:"small",searchable:!0,selectable:!0,keyExtractor:t=>t.id})]})}export{we as default};
