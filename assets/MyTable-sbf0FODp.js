import{r as l,av as x}from"./index-DDSbejf8.js";import{u as Q,I as V,b as X}from"./MyApp-CFKyVQCO.js";import{b as Y}from"./index-DeeGC6I_.js";import{F as Z}from"./Table-znSNzvWE.js";import{R as D}from"./row-CAo0pDIY.js";import{I as ee}from"./index-BxTaRUiD.js";import"./index-BuTvM7V7.js";import"./addEventListener-DOCebu2t.js";import"./index-DTT2Zs3S.js";import"./PurePanel-IgpYXHId.js";import"./SearchOutlined-BYVo25GO.js";import"./index-CGcf7Yb6.js";import"./index-dV4xAa-9.js";import"./index-BeBRyhpe.js";import"./Dropdown-C1V4yczL.js";import"./index-CegnWKpY.js";import"./useBreakpoint-COcEudlB.js";import"./responsiveObserver-Bq5PVNc4.js";import"./Pagination-SQ36jmSm.js";import"./EyeOutlined-CaKWzCru.js";const te=l.forwardRef((I,z)=>{const{data:u=[],columns:g=[],size:B="middle",selectable:C=!1,searchable:H=!1,loading:M=!1,pageSize:T=0,keyExtractor:r=(s,n)=>n+"",onSearchRow:K,renderTitle:_,style:q}=I,{ti:a,language:O}=Q(),[m,U]=l.useState(""),[F,L]=l.useState(""),[e,c]=l.useState([]),[h,p]=l.useState(!1),$=Y(U,500),P=l.useRef(!1),k=s=>{L(s),$(s),P.current=!0};l.useImperativeHandle(z,()=>({getDataSelected:()=>e,setDataSelected:s=>{c(s)},hasDataSelected:()=>!!(e!=null&&e.length),setShowSelectedOnly:p,setSearch:k,clearFilter:({search:s=!0,dataSelected:n=!0,showSelectedOnly:t=!0}={})=>{s&&k(""),n&&c([]),t&&p(!1)}}));const d=l.useMemo(()=>{const s=new Map(g.map((t,o)=>[t.key,o])),n=u.filter(t=>K?K(m,t):Object.entries(t).some(([o,f],j)=>{var v,R;let S=s.get(o)||-1;return S<0||(v=g[S])!=null&&v.disableSearch?!1:(R=g[S])!=null&&R.onSearch?g[S].onSearch(m,f,t):typeof f=="string"&&V(m,f)})).map((t,o)=>({...t,key:r(t,o)}));if(h&&(e!=null&&e.length)){const t=new Set(e.map(r));return n.filter((o,f)=>t.has(r(o,f)))}return n},[u,m,h,e]);l.useEffect(()=>{if(!(e!=null&&e.length))return;let s=new Set(u.map(r)),n=e.filter((t,o)=>s.has(r(t,o)));(n==null?void 0:n.length)!==(e==null?void 0:e.length)&&c(n)},[u,e]),l.useEffect(()=>{!(e!=null&&e.length)&&h&&p(!1)},[e.length,h]);const E=l.useRef([]),y=l.useRef([]),b=l.useRef(!1);l.useEffect(()=>{!b.current&&(e!=null&&e.length)&&y.current.push(e),b.current=!1,console.log(y.current),E.current=e},[e]);const w=l.useRef(d);l.useEffect(()=>{w.current=d},[d]);const W=(s,n)=>{const t=new Set(u.map(r)),o=new Set(d.map(r)),f=new Set(E.current.map(r)),j=new Set(s),S=new Set([...t].filter(i=>!o.has(i))),v=new Set([...s].filter(i=>!f.has(i))),R=new Set([...f].filter(i=>!j.has(i)&&!S.has(i))),J=[...f,...v].filter(i=>!R.has(i)).map(i=>u.find(N=>r(N)===i)).filter(Boolean);c(J)},A=l.useMemo(()=>{if(!C)return;const s=[{key:"undo",text:a({en:"Undo selected",vi:"Hoàn tác lựa chọn"}),onSelect:()=>{b.current=!0;const n=y.current.pop();console.log(n),c(y.current[y.current.length-1]||[])}},{key:"select_all",text:a({en:"Select all",vi:"Chọn tất cả"}),onSelect:()=>c([...u])},{key:"invert_selection",text:a({en:"Invert selection",vi:"Đảo ngược lựa chọn"}),onSelect:()=>c(u.filter(n=>!e.find(t=>r(t)===r(n))))},{key:"unselect_all",text:a({en:"Unselect all",vi:"Bỏ chọn tất cả"}),onSelect:()=>{p(!1);const n=new Set(u.map(r));c(e.filter(t=>!n.has(r(t))))}},{key:"show_selected_only",text:(h?"✅ ":"❌ ")+a({en:"Show selected only",vi:"Chỉ hiển thị đã chọn"})+" ("+e.length+")",onSelect:()=>{k(""),p(!h)}}].filter(Boolean);return m&&s.push({key:"select_all_insearch",text:a({en:"Select all - search results",vi:"Chọn tất cả - kết quả tìm kiếm"}),onSelect:()=>c([...w.current])},{key:"invert_selection_insearch",text:a({en:"Invert selection - search results",vi:"Đảo ngược lựa chọn - kết quả tìm kiếm"}),onSelect:()=>c(w.current.filter(n=>!e.find(t=>r(t)===r(n))))},{key:"unselect_all_insearch",text:a({en:"Unselect all - search results",vi:"Bỏ chọn tất cả - kết quả tìm kiếm"}),onSelect:()=>{p(!1);const n=new Set(w.current.map(r));c(e.filter(t=>!n.has(r(t))))}}),{selectedRowKeys:e.map(r),onChange:W,selections:s}},[e,h,C,O,m]),G=()=>x.jsxs(D,{justify:"space-between",style:{margin:"5px"},children:[x.jsx(D,{align:"middle",children:x.jsx(X,{wrap:!0,children:typeof _=="function"&&_(e)})}),H&&x.jsx(ee.Search,{placeholder:a({en:"Search",vi:"Tìm kiếm"}),value:F,onChange:s=>k(s.target.value),style:{marginRight:16,marginLeft:16,maxWidth:300}})]});return x.jsx(Z,{sticky:{offsetHeader:0},fixedHeader:!0,size:B,loading:M,scroll:{x:"max-content"},tableLayout:"auto",dataSource:d,columns:g,showSorterTooltip:!1,onChange:(s,n,t,o)=>{w.current=o.currentDataSource??[]},rowSelection:A,title:G,pagination:T==-1?!1:{position:["bottomCenter"],showSizeChanger:!0,showTotal:(s,n)=>a({en:`Total ${s} items`,vi:`Tổng ${s} dòng`}),size:"default",defaultPageSize:T||10,style:{alignItems:"center"}},style:q})}),ve=te;export{ve as default};
