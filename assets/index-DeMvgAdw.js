const __vite__fileDeps=["./MyTable-DjN6ZKsi.js","./index-CX461bZ7.js","./index-BM_p-30O.css","./MyApp-BdU98SHx.js","./styleChecker-z_j4FDWQ.js","./addEventListener-lcr56SeY.js","./index-x94hlA63.js","./PurePanel-Cljw82G2.js","./TextArea-D6nFyh_l.js","./index-BesEGoUg.js","./index-DBzt-ARy.js","./Dropdown-Bn0d3AP-.js","./useBreakpoint-DNjyW7sX.js","./responsiveObserver-DUYzmFPe.js","./Pagination-DaQVeyeA.js","./row-C39O-hvc.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{al as G,am as Q,r as w,aq as t,ar as g,au as Z,aJ as R,aw as N}from"./index-CX461bZ7.js";import{a as ee,b as A,t as v,S as f,g as y,C as ne,T as x,o as te,x as H,I as U}from"./MyApp-BdU98SHx.js";import{u as ie}from"./useForceStop-DeVCKPkA.js";import{P as se}from"./index-vuHwb1ab.js";import{E as ae}from"./ExportButton-DTPpu6nH.js";import{g as re,a as le,U as h,u as oe,d as ce}from"./pages-r9N1aega.js";import{I as _}from"./index-QtiY48Vm.js";import{T as L}from"./index-CapnTH4c.js";import{T as E}from"./index-CANpKXD2.js";import{P as b}from"./index-DfylM7c4.js";import{R as de}from"./row-C39O-hvc.js";import"./file-download-Do8f2PPK.js";import"./index-DBzt-ARy.js";import"./Dropdown-Bn0d3AP-.js";import"./PurePanel-Cljw82G2.js";import"./addEventListener-lcr56SeY.js";import"./styleChecker-z_j4FDWQ.js";import"./TextArea-D6nFyh_l.js";import"./index-BGu2aXWA.js";import"./responsiveObserver-DUYzmFPe.js";const he=w.lazy(()=>Z(()=>import("./MyTable-DjN6ZKsi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url));function Se(){const{message:c,notification:u}=G.useApp(),V=Q(),{ti:i}=ee(),W=ie(),[m,k]=A("Pages.data",[]),[K,S]=A("Pages.finished",!1),[$,F]=w.useState(!1);w.useEffect(()=>{K||B(!1)},[]);const B=async(e=!1)=>{var a;if($&&!e)return;const n=W.start(),s=e?[]:[...m],o=new Set(s.map(l=>l.id)),r="Pages:onReload";v(r),F(!0),S(!1);try{c.loading({key:r,content:i({en:"Loading invited pages...",vi:"Đang tải trang được mời..."}),duration:0});const d=(await re()).filter(p=>!o.has(p.id));d!=null&&d.length&&(s.push(...d),k([...s]));const D=s[s.length-1];let M=e?"":D==null?void 0:D.cursor;for(;!n.value();){c.loading({key:r,content:i({en:"Loading pages...",vi:"Đang tải trang..."})+s.length,duration:0});const p=await le(M),j=p==null?void 0:p.filter(T=>!o.has(T.id));if(p.forEach(T=>o.add(T.id)),!(j!=null&&j.length))break;s.push(...j),M=(a=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:a.cursor,k([...s])}c.success({key:r,content:(n.value()?i({en:"Load pages stopped ",vi:"Dừng tải trang "}):i({en:"Load pages completed ",vi:"Tải xong trang "}))+s.length}),S(!n.value())}catch(l){c.error({content:i({en:"Failed to load pages: ",vi:"Lỗi tải trang: "})+l.message})}finally{F(!1)}},z=async e=>{if(!(e!=null&&e.length))return;const n="Pages:onClickUnlikeSelectedPages",s="Pages:onClickUnlikeSelectedPages:waiting";v(n);let o=!1,r=[];for(let a=0;a<e.length&&(c.destroy(s),c.loading({key:n,content:t.jsxs(t.Fragment,{children:[i({en:"Unliking pages... ",vi:"Đang bỏ thích trang... "})+(a+1)+"/"+e.length,t.jsx("br",{}),t.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{c.loading({key:n,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),o=!0}}),await I(e[a])&&r.push(e[a]),!o);a++)if(a<e.length-1){const d=U(2e3,5e3);c.loading({key:s,content:i({en:"Sleeping "+Math.round(d/1e3)+"s",vi:"Đang đợi "+Math.round(d/1e3)+"s"}),duration:0}),await H(d)}c.destroy(n),c.destroy(s),u.success({duration:0,message:i({en:`Unliked ${r.length}/${e.length} pages`,vi:`Đã bỏ thích ${r.length}/${e.length} trang`}),description:t.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:t.jsx("ol",{children:r.map(a=>t.jsx("li",{children:t.jsx("a",{target:"_blank",href:y(a.id),children:a.name})},a.id))})})})},I=async e=>{const n="Pages:onClickUnlikePage";v(n),c.loading({key:n,content:i({en:"Unliking page... "+e.name,vi:"Đang bỏ thích trang..."+e.name}),duration:0});const s=await oe(e.id);return s?(u.destroy(n),c.success({key:n,content:i({en:"Unliked page "+e.name,vi:"Đã bỏ thích trang "+e.name})}),k(o=>R(o,r=>{const a=r.findIndex(l=>l.id==e.id);return r[a].userType=h.UNLIKED,r}))):(c.destroy(n),u.error({key:n,message:i({en:"Failed to unlike page",vi:"Lỗi bỏ thích trang"}),description:e.name,duration:0,btn:t.jsxs(f,{children:[t.jsx(g,{type:"default",onClick:()=>I(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(g,{type:"primary",onClick:()=>window.open(y(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),s},O=async e=>{if(!(e!=null&&e.length))return;const n="Pages:onClickDeclineSelectedInvites",s="Pages:onClickDeclineSelectedInvites:waiting";v(n);let o=!1,r=[];for(let a=0;a<e.length&&(c.destroy(s),c.loading({key:n,content:t.jsxs(t.Fragment,{children:[i({en:"Removing invite... ",vi:"Đang từ chối... "})+(a+1)+"/"+e.length,t.jsx("br",{}),t.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{c.loading({key:n,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),o=!0}}),await C(e[a])&&r.push(e[a]),!o);a++)if(a<e.length-1){const d=U(2e3,5e3);c.loading({key:s,content:i({en:"Sleeping "+Math.round(d/1e3)+"s",vi:"Đang đợi "+Math.round(d/1e3)+"s"}),duration:0}),await H(d)}c.destroy(n),c.destroy(s),u.success({duration:0,message:i({en:`Declined ${r.length}/${e.length} invites`,vi:`Đã từ chối ${r.length}/${e.length} lời mời`}),description:t.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:t.jsx("ol",{children:r.map(a=>t.jsx("li",{children:t.jsx("a",{target:"_blank",href:y(a.id),children:a.name})},a.id))})})})},C=async e=>{const n="Pages:onClickDeclineInvite";v(n),c.loading({key:n,content:i({en:"Declining invite... "+e.name,vi:"Đang từ chối lời mời..."+e.name}),duration:0});const s=await ce(e.inviteId);return s?(u.destroy(n),c.success({key:n,content:i({en:"Removed invite "+e.name,vi:"Đã từ chối lời mời "+e.name})}),k(o=>R(o,r=>{const a=r.findIndex(l=>l.id==e.id);return r[a].userType=h.DECLINED,r}))):(c.destroy(n),u.error({key:n,message:i({en:"Failed to remove invite",vi:"Lỗi từ chối lời mời"}),description:e.name,duration:0,btn:t.jsxs(f,{children:[t.jsx(g,{type:"default",onClick:()=>C(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(g,{type:"primary",onClick:()=>window.open(y(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),s},X=e=>{V("/bulk-downloader",{state:{targetId:e.id,platform:se.Facebook}})},q=e=>{var r,a;const n=e!=null&&e.length?[...e]:[...m],s=((r=n==null?void 0:n.map(l=>m.find(d=>d.id===l.id)))==null?void 0:r.filter(l=>l&&l.userType===h.LIKED))||[],o=((a=n==null?void 0:n.map(l=>m.find(d=>d.id===l.id)))==null?void 0:a.filter(l=>l&&l.userType===h.INVITED))||[];return t.jsxs(t.Fragment,{children:[t.jsx(x,{color:"red",title:i({en:"WARNING: Reload many times may cause temporarily blocked by facebook",vi:"LƯU Ý: Tải lại nhiều lần có thể bị facebook chặn tạm thời"}),children:t.jsx(g,{type:"primary",icon:$?t.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):t.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>B(!0),children:i({en:"Reload",vi:"Tải lại"})})}),t.jsx(ae,{data:n,options:[{key:"id",label:".txt (page id)",prepareData:l=>({fileName:"your_pages_id"+N().format("YYYY-MM-DD-HHmmss")+".txt",data:l==null?void 0:l.map(d=>d.id).join(`
`)})},{key:"json",label:".json",prepareData:l=>({fileName:"your_pages"+N().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(l,null,4)})},{key:"csv",label:".csv",prepareData:l=>({fileName:"your_pages"+N().format("YYYY-MM-DD-HHmmss")+".csv",data:te(l)})}]}),t.jsx(x,{title:i({en:`Unlike ${s.length} selected pages`,vi:`Bỏ thích ${s.length} trang được chọn`}),children:t.jsx(b,{title:i({en:`Unlike ${s.length} pages`,vi:`Bỏ thích ${s.length} trang`}),description:i({en:`Are your sure want to unlike ${s.length} pages?`,vi:`Bản có chãc muốn bỏ thích ${s.length} trang?`}),onConfirm:()=>z(s),okText:i({en:"Unlike pages",vi:"Bỏ thích trang"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(g,{danger:!0,type:"primary",disabled:s.length<=0,icon:t.jsx("i",{className:"fa-solid fa-thumbs-down"}),children:s.length})})}),o.length>0&&t.jsx(x,{title:i({en:`Decline ${o.length} selected invites`,vi:`Từ chối ${o.length} lời mời được chọn`}),children:t.jsx(b,{title:i({en:`Decline ${o.length} invites`,vi:`Từ chối ${o.length} lời mời`}),description:i({en:`Are your sure want to decline ${o.length} invites?`,vi:`Bản có chãc muốn từ chối ${o.length} lời mời?`}),onConfirm:()=>O(o),okText:i({en:"Yes",vi:"Có"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(g,{danger:!0,type:"primary",disabled:o.length<=0,icon:t.jsx("i",{className:"fa-solid fa-xmark"}),children:o.length})})}),t.jsx(g,{icon:t.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/pages/?category=liked","_blank"),children:i({en:"View on Facebook",vi:"Xem trên Facebook"})})]})},P=e=>{switch(e){case h.ADMIN:return{color:"success",text:i({en:"Admin",vi:"Admin"})};case h.LIKED:return{color:"default",text:i({en:"Liked",vi:"Đã thích"})};case h.INVITED:return{color:"warning",text:i({en:"Invited",vi:"Lời mời"})};case h.DECLINED:return{color:"error",text:i({en:"Declined",vi:"Từ chối"})};case h.UNLIKED:return{color:"error",text:i({en:"Unliked",vi:"Bỏ thích"})};default:return{color:"default",text:"?"}}},Y=w.useMemo(()=>Array.from(m.map(e=>e.category).reduce((e,n)=>{let s=e.get(n)||0;return e.set(n,++s)},new Map).entries()).sort((e,n)=>n[1]-e[1]).map(([e,n])=>({text:e+" ("+n+")",value:e})),[m]),J=[{title:i({en:"Image",vi:"Ảnh"}),key:"image",dataIndex:"image",render:(e,n,s)=>t.jsx(_,{src:n.image,width:50,height:50,style:{objectFit:"contain",borderRadius:5}})},{title:i({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",render:(e,n,s)=>t.jsxs(f,{direction:"vertical",size:0,style:{maxWidth:300},children:[t.jsx(L.Link,{href:n.url,target:"_blank",children:t.jsx("b",{children:n.name||"???"})}),t.jsx("span",{style:{opacity:.7},children:n.id})]})},{title:i({en:"Category",vi:"Danh mục"})+" ("+Y.length+")",key:"category",dataIndex:"category",filters:Y,onFilter:(e,n)=>n.category==e,filterSearch:!0},{title:i({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,n,s)=>{const{color:o,text:r}=P(n.userType);return n.inviterId?t.jsxs(f,{children:[t.jsx(E,{color:o,children:r}),t.jsx(_,{src:n.inviterAvatar,width:40,height:40,style:{borderRadius:5}}),t.jsx(L.Link,{href:y(n.inviterId),target:"_blank",children:n.inviterName})]}):t.jsx(E,{color:o,children:r})},filters:Object.values(h).map(e=>{const{text:n}=P(e);return{text:n+" ("+m.filter(s=>s.userType==e).length+")",value:e}}),onFilter:(e,n)=>n.userType==e,onSearch:(e,n,s)=>ne(e,P(n).text+s.inviterName),align:"left"},{title:i({en:"Action",vi:"Hành động"}),key:"action",render:(e,n,s)=>t.jsxs(f.Compact,{style:{minWidth:30},children:[t.jsx(x,{title:i({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:t.jsx(g,{type:"default",onClick:()=>X(n),icon:t.jsx("i",{className:"fa-solid fa-download"})})}),n.userType===h.LIKED?t.jsx(x,{title:i({en:"Unlike page",vi:"Bỏ thích trang"}),children:t.jsx(b,{title:i({en:"Unlike page",vi:"Bỏ thích trang"}),description:i({en:"Are you sure want to unlike this page?",vi:"Bạn có chắc muốn bỏ thích trang này?"}),onConfirm:()=>I(n),okText:i({en:"Unlike",vi:"Bỏ thích"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(g,{danger:!0,type:"primary",icon:t.jsx("i",{className:"fa-solid fa-thumbs-down"})})})}):null,n.userType===h.INVITED?t.jsx(x,{title:i({en:"Decline invite",vi:"Từ chối"}),children:t.jsx(b,{title:i({en:"Decline invite",vi:"Từ chối"}),description:i({en:"Decline this invite?",vi:"Từ chối lời mời này?"}),onConfirm:()=>C(n),okText:i({en:"Yes",vi:"Từ chối"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(g,{danger:!0,type:"primary",icon:t.jsx("i",{className:"fa-solid fa-xmark"})})})}):null]}),width:100,align:"right"}];return t.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[t.jsxs(de,{align:"middle",style:{margin:"16px"},children:[t.jsx(L.Title,{level:3,style:{margin:0},children:i({en:"Pages manager",vi:"Quản lý trang"})}),t.jsx(E,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:m.length})]}),t.jsx(he,{data:m,columns:J,renderTitle:q,size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e.id})]})}export{Se as default};
