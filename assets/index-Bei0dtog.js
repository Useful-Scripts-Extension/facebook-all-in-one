const __vite__fileDeps=["./MyTable-DD2uOVme.js","./index-C18KX0bs.js","./index-BM_p-30O.css","./MyApp-134z9Ewy.js","./styleChecker-D5cZZSfU.js","./addEventListener-Bvk7TFEG.js","./index-DBmoidCd.js","./PurePanel-B-Oik-oK.js","./TextArea-v2wMscgk.js","./index-BzvBDuID.js","./index-Bb3Gxkrc.js","./Dropdown--WaCZpHb.js","./Pagination-CDZtfPwT.js","./row-CrycN8YO.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{al as J,az as U,r as C,ap as n,aq as p,at as z,aJ as W,av as N}from"./index-C18KX0bs.js";import{a as X,t as b,Q as K,U as c,V as Q,S as g,W as L,T as x,X as q,b as R,P as Z,o as ee,A as ne,Y as te}from"./MyApp-134z9Ewy.js";import{u as ie}from"./useForceStop-YUfe4jew.js";import{E as se}from"./ExportButton-C5fqiwtj.js";import{u as Y,g as re,s as ae}from"./useCacheState-B5EIi5AM.js";import{A as oe}from"./index-CJjZPvZK.js";import{T as A}from"./index-C09uftll.js";import{T as I}from"./index-BkR7kwXz.js";import{P as _}from"./index-CfpUwFCq.js";import{R as le}from"./row-CrycN8YO.js";import"./file-download-BhOYhnZo.js";import"./index-Bb3Gxkrc.js";import"./Dropdown--WaCZpHb.js";import"./PurePanel-B-Oik-oK.js";import"./TextArea-v2wMscgk.js";import"./styleChecker-D5cZZSfU.js";const ce=C.lazy(()=>z(()=>import("./MyTable-DD2uOVme.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url));function Ce({}){const{message:o,notification:y}=J.useApp(),B=U(),{ti:t}=X(),F=ie(),[u,G]=Y("Groups.data",[]),[V,H]=Y("Groups.finished",!1),[j,M]=C.useState(!1);C.useEffect(()=>{re("Groups.finished")||k(!1)},[]);const k=async(e=!1)=>{var a;if(j&&!e)return;const i=F.start(),s=e?[]:[...u],l=new Set(s.map(d=>d.id)),r="Groups:onReload";b(r),M(!0),o.loading({key:r,content:t({en:"Loading groups...",vi:"Đang tải nhóm..."}),duration:0});try{for(const[d,h]of[[K,c.ADMIN],[Q,c.MEMBER]]){const m=s[s.length-1];let E=e?"":(m==null?void 0:m.userType)===h?m==null?void 0:m.cursor:"";for(;!i.value();){const f=await d({cursor:E}),v=f==null?void 0:f.filter(w=>!l.has(w.id));if(f.forEach(w=>l.add(w.id)),!(v!=null&&v.length))break;s.push(...v),E=(a=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:a.cursor,G([...s]),o.loading({key:r,content:t({en:"Loading groups...",vi:"Đang tải nhóm..."})+s.length,duration:0})}}o.success({key:r,content:(i.value()?t({en:"Load groups stopped ",vi:"Dừng tải nhóm "}):t({en:"Load groups completed ",vi:"Tải xong nhóm "}))+s.length}),ae("Groups.finished",!i.value()),H(!i.value())}catch(d){o.error({content:t({en:"Failed to load groups: ",vi:"Lỗi tải nhóm: "})+d.message})}finally{o.destroy(r),M(!1)}},S=async e=>{if(!(e!=null&&e.length))return;const i="Groups:onClickLeaveSelectedGroups",s="Groups:onClickLeaveSelectedGroups:waiting";b(i);let l=!1,r=[];for(let a=0;a<e.length&&(o.destroy(s),o.loading({key:i,content:n.jsxs(n.Fragment,{children:[t({en:"Leaving groups... ",vi:"Đang rời nhóm... "})+(a+1)+"/"+e.length,n.jsx("br",{}),n.jsx("i",{children:t({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{o.loading({key:i,content:t({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),l=!0}}),await T(e[a])&&r.push(e[a]),!l);a++)if(a<e.length-1){const h=te(2e3,5e3);o.loading({key:s,content:t({en:"Sleeping "+Math.round(h/1e3)+"s",vi:"Đang đợi "+Math.round(h/1e3)+"s"}),duration:0}),await ne(h)}o.destroy(i),o.destroy(s),y.success({duration:0,message:t({en:`Left ${r.length}/${e.length} groups`,vi:`Đã rời ${r.length}/${e.length} nhóm`}),description:n.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:n.jsx("ol",{children:r.map(a=>n.jsx("li",{children:n.jsx("a",{target:"_blank",href:R(a.id),children:a.name})},a.id))})})})},T=async e=>{const i="Groups:onClickLeaveGroup:"+e.id;b(i),o.loading({key:i,content:t({en:"Leaving group... "+e.name,vi:"Đang rời nhóm..."+e.name}),duration:0});const s=await q(e.id);return s?(y.destroy(i),o.success({key:i,content:t({en:"Left group "+e.name,vi:"Đã rời nhóm "+e.name})}),G(l=>W(l,r=>{const a=r.findIndex(d=>d.id==e.id);return r[a].userType=c.NOT_JOINED,r}))):(o.destroy(i),y.error({key:i,message:t({en:"Failed to leave group",vi:"Lỗi rời nhóm"}),description:e.name,duration:0,btn:n.jsxs(g,{children:[n.jsx(p,{type:"default",onClick:()=>T(e),children:t({en:"Retry",vi:"Thử lại"})}),n.jsx(p,{type:"primary",onClick:()=>window.open(R(e.id)),children:t({en:"View group",vi:"Xem nhóm"})})]})})),s},$=e=>{B("/bulk-downloader",{state:{targetId:e.id,platform:Z.Facebook}})},O=e=>{var l;const i=e!=null&&e.length?[...e]:[...u],s=((l=i==null?void 0:i.map(r=>u.find(a=>a.id===r.id)))==null?void 0:l.filter(r=>r&&(r.userType===c.MEMBER||r.userType===c.ADMIN)))||[];return n.jsxs(n.Fragment,{children:[n.jsxs(g.Compact,{children:[n.jsx(x,{title:t({en:"Reload all groups",vi:"Tải lại toàn bộ groups"}),children:n.jsx(p,{type:"primary",icon:j?n.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):n.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>k(!0),children:t({en:"Reload",vi:"Tải lại"})})}),u.length&&!V&&!j?n.jsx(x,{title:t({en:"Continue load groups from index ",vi:"Tiếp tục tải nhóm từ vị trí "})+u.length,children:n.jsx(p,{icon:n.jsx("i",{className:"fa-solid fa-play"}),onClick:()=>k(!1),children:t({en:"Continue",vi:"Tải tiếp"})})}):null]}),n.jsx(se,{data:e.length?e:u,options:[{key:"id",label:".txt (group id)",prepareData:r=>({fileName:"your_groups_id"+N().format("YYYY-MM-DD-HHmmss")+".txt",data:r==null?void 0:r.map(a=>a.id).join(`
`)})},{key:"json",label:".json",prepareData:r=>({fileName:"your_groups"+N().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(r==null?void 0:r.map(a=>({...a,last_visited:L(a.lastVisitedTime,t({en:"en-US",vi:"vi-VN"}))})),null,4)})},{key:"csv",label:".csv",prepareData:r=>({fileName:"your_groups"+N().format("YYYY-MM-DD-HHmmss")+".csv",data:ee(r)})}]}),n.jsx(x,{title:t({en:`Leave ${s.length} selected groups`,vi:`Rời ${s.length} nhóm được chọn`}),children:n.jsx(_,{title:t({en:`Leave ${s.length} groups`,vi:`Rời ${s.length} nhóm`}),description:t({en:`Are your sure want to Leave ${s.length} groups?`,vi:`Bản có chãc muốn rời ${s.length} nhóm?`}),onConfirm:()=>S(s),okText:t({en:"Leave groups",vi:"Rời nhóm"}),cancelText:t({en:"No",vi:"Huỷ"}),children:n.jsx(p,{danger:!0,type:"primary",disabled:s.length<=0,icon:n.jsx("i",{className:"fa-regular fa-trash-can"}),children:s.length})})}),n.jsx(p,{icon:n.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/groups/joins","_blank"),children:t({en:"View on Facebook",vi:"Xem trên Facebook"})})]})},D=e=>{switch(e){case c.MEMBER:return{color:"default",text:t({en:"Member",vi:"Thành viên"})};case c.ADMIN:return{color:"success",text:"Admin"};case c.NOT_JOINED:return{color:"error",text:t({en:"Left group",vi:"Đã rời nhóm"})};case c.PENDING:return{color:"warning",text:t({en:"Pending",vi:"Đang chờ"})};default:return{color:"default",text:"?"}}},P=[{title:t({en:"Group",vi:"Nhóm"}),key:"group",dataIndex:"group",sorter:(e,i)=>e.name.localeCompare(i.name),render:(e,i,s)=>n.jsxs(g,{style:{maxWidth:400},align:"start",children:[n.jsx(oe,{src:i.avatar,size:45}),n.jsxs(g,{direction:"vertical",size:0,children:[n.jsx(A.Link,{href:i.url,target:"_blank",children:n.jsx("b",{children:i.name})}),n.jsx("span",{style:{opacity:.7},children:i.id})]})]})},{title:t({en:"Last visit",vi:"Lần xem gần nhất"}),key:"lastVisitedTime",dataIndex:"lastVisitedTime",sorter:(e,i)=>e.lastVisitedTime-i.lastVisitedTime,render:(e,i,s)=>L(i.lastVisitedTime,t({en:"en-US",vi:"vi-VN"})),align:"right"},{title:t({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,i,s)=>{const{color:l,text:r}=D(i.userType);return n.jsx(I,{color:l,children:r})},filters:Object.values(c).map(e=>{const{text:i}=D(e);return{text:i+" ("+u.filter(s=>s.userType==e).length+")",value:e}}),onFilter:(e,i)=>i.userType==e,align:"right"},{title:t({en:"Action",vi:"Hành động"}),key:"action",render:(e,i,s)=>n.jsxs(g.Compact,{style:{minWidth:30},children:[n.jsx(x,{title:t({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:n.jsx(p,{type:"default",onClick:()=>$(i),icon:n.jsx("i",{className:"fa-solid fa-download"})})}),i.userType!==c.NOT_JOINED?n.jsx(x,{title:t({en:"Leave group",vi:"Rời nhóm"}),children:n.jsx(_,{title:t({en:"Leave group",vi:"Rời nhóm"}),description:t({en:"Are you sure want to leave this group?",vi:"Bạn có chắc muốn rời nhóm này?"}),onConfirm:()=>T(i),okText:t({en:"Yes",vi:"Có"}),cancelText:t({en:"No",vi:"Huỷ"}),children:n.jsx(p,{danger:!0,type:"primary",icon:n.jsx("i",{className:"fa-regular fa-trash-can"})})})}):null]}),align:"right"}];return n.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[n.jsxs(le,{align:"middle",style:{margin:"16px"},children:[n.jsx(A.Title,{level:3,style:{margin:0},children:t({en:"Groups manager",vi:"Quản lý nhóm"})}),n.jsx(I,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:u.length})]}),n.jsx(ce,{data:u,columns:P,renderTitle:O,size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e.id})]})}export{Ce as default};
