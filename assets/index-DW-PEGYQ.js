const __vite__fileDeps=["./MyTable-DNehxVlM.js","./index-BFPfPAaZ.js","./index-BM_p-30O.css","./MyApp-BdpL4ZtE.js","./styleChecker-CUboSsV6.js","./addEventListener-Bjda6oWl.js","./index-BkSv2wHt.js","./PurePanel-SxyVbxnL.js","./TextArea-CJ5eWy81.js","./index-B_qEaDdp.js","./index-Bi9aqrJh.js","./Dropdown-BkgZXLuV.js","./useBreakpoint-CBpI-EAH.js","./responsiveObserver-B_XlD0op.js","./Pagination-CiSJ2nYJ.js","./index-B-l378Vl.js","./row-lZScvilV.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{am as z,r as k,ao as t,ap as u,as as W,aJ as q,au as b}from"./index-BFPfPAaZ.js";import{b as X,a as Q,c as S,t as v,S as j,f as C,T as g,E as K,g as G,o as Z,z as ee,J as ne}from"./MyApp-BdpL4ZtE.js";import{u as te}from"./useForceStop-CXBaGXeu.js";import{P as ie}from"./index-vuHwb1ab.js";import{E as se}from"./ExportButton-D-95AYUd.js";import{g as ae,U as m,a as re,l as oe,b as le}from"./groups-DTXMuJaC.js";import{A as ce}from"./index-BSMMBZXq.js";import{T as Y}from"./index-DimRadIr.js";import{T as I}from"./index-BzZUG1r-.js";import{P as A}from"./index-Crtya_Jo.js";import{R as de}from"./row-lZScvilV.js";import"./file-download-CstS00Qr.js";import"./index-Bi9aqrJh.js";import"./Dropdown-BkgZXLuV.js";import"./PurePanel-SxyVbxnL.js";import"./responsiveObserver-B_XlD0op.js";import"./useBreakpoint-CBpI-EAH.js";import"./index-BKRoP6zU.js";import"./styleChecker-CUboSsV6.js";import"./TextArea-CJ5eWy81.js";const me=k.lazy(()=>W(()=>import("./MyTable-DNehxVlM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url));function Le({}){const{message:c,notification:f}=X(),V=z(),{ti:i}=Q(),H=te(),[p,D]=S("Groups.data",[]),[O,E]=S("Groups.finished",!1),[M,F]=k.useState(!1),w=k.useRef(null);k.useEffect(()=>{O||L(!1)},[]);const L=async(e=!1)=>{var r;if(M&&!e)return;const n=H.start(),s=e?[]:[...p],o=new Set(s.map(a=>a.id)),l="Groups:onReload";v(l),F(!0),E(!1);try{for(const[a,d]of[[ae,m.ADMIN],[re,m.MEMBER]]){const h=s[s.length-1];let $=e?"":(h==null?void 0:h.userType)===d?h==null?void 0:h.cursor:"";for(;!n.value();){c.loading({key:l,content:i({en:"Loading groups...",vi:"Đang tải nhóm..."})+s.length,duration:0});const x=await a({cursor:$}),y=x==null?void 0:x.filter(N=>!o.has(N.id));if(x.forEach(N=>o.add(N.id)),!(y!=null&&y.length))break;s.push(...y),$=(r=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:r.cursor,D([...s])}}c.success({key:l,content:(n.value()?i({en:"Load groups stopped ",vi:"Dừng tải nhóm "}):i({en:"Load groups completed ",vi:"Tải xong nhóm "}))+s.length}),E(!n.value())}catch(a){c.error({content:i({en:"Failed to load groups: ",vi:"Lỗi tải nhóm: "})+a.message})}finally{F(!1)}},_=async e=>{if(!(e!=null&&e.length))return;const n="Groups:onClickLeaveSelectedGroups",s="Groups:onClickLeaveSelectedGroups:waiting";v(n);let o=!1,l=[];for(let r=0;r<e.length&&(c.destroy(s),c.loading({key:n,content:t.jsxs(t.Fragment,{children:[i({en:"Leaving groups... ",vi:"Đang rời nhóm... "})+(r+1)+"/"+e.length,t.jsx("br",{}),t.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{c.loading({key:n,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),o=!0}}),await T(e[r])&&l.push(e[r]),!o);r++)if(r<e.length-1){const d=ne(2e3,5e3);c.loading({key:s,content:i({en:"Sleeping "+Math.round(d/1e3)+"s",vi:"Đang đợi "+Math.round(d/1e3)+"s"}),duration:0}),await ee(d)}c.destroy(n),c.destroy(s),f.open({type:"success",duration:0,message:i({en:`Left ${l.length}/${e.length} groups`,vi:`Đã rời ${l.length}/${e.length} nhóm`}),description:t.jsx("ol",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:l.map(r=>t.jsx("li",{children:t.jsx("a",{target:"_blank",href:G(r.id),children:r.name})},r.id))})})},T=async e=>{const n="Groups:onClickLeaveGroup";v(n),c.loading({key:n,content:i({en:"Leaving group... "+e.name,vi:"Đang rời nhóm..."+e.name}),duration:0});const s=await oe(e.id);return s?(f.destroy(n),c.success({key:n,content:i({en:"Left group "+e.name,vi:"Đã rời nhóm "+e.name})}),D(o=>q(o,l=>{const r=l.findIndex(a=>a.id==e.id);return l[r].userType=m.NOT_JOINED,l}))):(c.destroy(n),f.open({type:"error",key:n,message:i({en:"Failed to leave group",vi:"Lỗi rời nhóm"}),description:e.name,duration:0,btn:t.jsxs(j,{children:[t.jsx(u,{type:"default",onClick:()=>T(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(u,{type:"primary",onClick:()=>window.open(G(e.id)),children:i({en:"View group",vi:"Xem nhóm"})})]})})),s},B=async e=>{var o,l;const n="Groups:onClickFindNoAdminGroups";v(n),c.loading({key:n,duration:0,content:i({en:"Finding groups no admin... ",vi:"Đang tìm nhóm không có admin... "})});let s=[];for(let r=0;r<e.length;r++){const a=e[r];c.loading({key:n,duration:0,content:t.jsxs(t.Fragment,{children:[i({en:"Checking group... ",vi:"Đang kiểm tra... "})+`${r+1}/${e.length}`,t.jsx("br",{}),a.name,t.jsx("br",{}),i({en:"Found ",vi:"Tìm thấy "})+s.length]})}),(await le(a.id)).adminCount===0&&(s.push(a),(l=(o=w.current)==null?void 0:o.setDataSelected)==null||l.call(o,[...s]))}c.destroy(n),f.open({type:"success",duration:0,message:i({en:`Found ${s.length}/${e.length} groups no admin`,vi:`Tìm thấy ${s.length}/${e.length} nhóm không có admin`}),description:t.jsx("ol",{style:{maxHeight:300,overflowY:"auto",whiteSpace:"pre-wrap"},children:s.map(r=>t.jsx("li",{children:t.jsx("a",{target:"_blank",href:G(r.id),children:r.name})},r.id))})})},J=e=>{V("/bulk-downloader",{state:{targetId:e.id,platform:ie.Facebook}})},P=e=>{var l,r;const n=e!=null&&e.length?[...e]:[...p],s=((l=n==null?void 0:n.map(a=>p.find(d=>d.id===a.id)))==null?void 0:l.filter(a=>a&&a.userType!==m.NOT_JOINED))||[],o=((r=n==null?void 0:n.map(a=>p.find(d=>d.id===a.id)))==null?void 0:r.filter(a=>a&&a.userType!==m.ADMIN))||[];return t.jsxs(t.Fragment,{children:[t.jsx(u,{type:"primary",icon:M?t.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):t.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>L(!0),children:i({en:"Reload",vi:"Tải lại"})}),t.jsx(se,{data:n,options:[{key:"id",label:".txt (group id)",prepareData:a=>({fileName:"your_groups_id"+b().format("YYYY-MM-DD-HHmmss")+".txt",data:a==null?void 0:a.map(d=>d.id).join(`
`)})},{key:"json",label:".json",prepareData:a=>({fileName:"your_groups"+b().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(a==null?void 0:a.map(d=>({...d,last_visited:C(d.lastVisitedTime,i({en:"en-US",vi:"vi-VN"}))})),null,4)})},{key:"csv",label:".csv",prepareData:a=>({fileName:"your_groups"+b().format("YYYY-MM-DD-HHmmss")+".csv",data:Z(a)})}]}),t.jsx(g,{title:i({en:`Leave ${s.length} selected groups`,vi:`Rời ${s.length} nhóm được chọn`}),children:t.jsx(A,{title:i({en:`Leave ${s.length} groups`,vi:`Rời ${s.length} nhóm`}),description:i({en:`Are your sure want to Leave ${s.length} groups?`,vi:`Bản có chãc muốn rời ${s.length} nhóm?`}),onConfirm:()=>_(s),okText:i({en:"Leave groups",vi:"Rời nhóm"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{danger:!0,type:"primary",disabled:s.length<=0,icon:t.jsx("i",{className:"fa-regular fa-trash-can"}),children:s.length})})}),t.jsx(g,{title:i({en:`Find groups that have no admin in ${o.length} selected groups`,vi:`Tìm nhóm không có admin quản lý trong ${o.length} nhóm được chọn`}),children:t.jsx(u,{icon:t.jsx("i",{className:"fa-solid fa-user-large-slash"}),onClick:()=>B(o),disabled:o.length<=0,children:o.length})}),t.jsx(g,{title:i({en:"View on Facebook",vi:"Xem trên Facebook"}),children:t.jsx(u,{icon:t.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/groups/joins","_blank")})})]})},R=e=>{switch(e){case m.MEMBER:return{color:"default",text:i({en:"Member",vi:"Thành viên"})};case m.ADMIN:return{color:"success",text:"Admin"};case m.NOT_JOINED:return{color:"error",text:i({en:"Left group",vi:"Đã rời nhóm"})};case m.PENDING:return{color:"warning",text:i({en:"Pending",vi:"Đang chờ"})};default:return{color:"default",text:"?"}}},U=[{title:i({en:"Group",vi:"Nhóm"}),key:"group",dataIndex:"group",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n,s)=>t.jsxs(j,{style:{maxWidth:400},align:"start",children:[t.jsx(ce,{src:n.avatar,size:45}),t.jsxs(j,{direction:"vertical",size:0,children:[t.jsx(Y.Link,{href:n.url,target:"_blank",children:t.jsx("b",{children:n.name})}),t.jsx("span",{style:{opacity:.7},children:n.id})]})]})},{title:i({en:"Last visit",vi:"Lần xem gần nhất"}),key:"lastVisitedTime",dataIndex:"lastVisitedTime",sorter:(e,n)=>e.lastVisitedTime-n.lastVisitedTime,render:(e,n,s)=>C(n.lastVisitedTime,i({en:"en-US",vi:"vi-VN"})),align:"right"},{title:i({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,n,s)=>{const{color:o,text:l}=R(n.userType);return t.jsx(I,{color:o,children:l})},filters:Object.values(m).map(e=>{const{text:n}=R(e);return{text:n+" ("+p.filter(s=>s.userType==e).length+")",value:e}}),onFilter:(e,n)=>n.userType==e,align:"right"},{title:i({en:"Action",vi:"Hành động"}),key:"action",render:(e,n,s)=>t.jsxs(j.Compact,{style:{minWidth:30},children:[t.jsx(g,{title:i({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:t.jsx(u,{type:"default",onClick:()=>J(n),icon:t.jsx("i",{className:"fa-solid fa-download"})})}),n.userType!==m.NOT_JOINED?t.jsx(g,{title:i({en:"Leave group",vi:"Rời nhóm"}),children:t.jsx(A,{title:i({en:"Leave group",vi:"Rời nhóm"}),description:i({en:"Are you sure want to leave this group?",vi:"Bạn có chắc muốn rời nhóm này?"}),onConfirm:()=>T(n),okText:i({en:"Yes",vi:"Có"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{danger:!0,type:"primary",icon:t.jsx("i",{className:"fa-regular fa-trash-can"})})})}):null]}),align:"right"}];return t.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[t.jsxs(de,{align:"middle",style:{margin:"16px"},children:[t.jsx(Y.Title,{level:3,style:{margin:0},children:i({en:"Groups manager",vi:"Quản lý nhóm"})}),t.jsx(I,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:p.length})]}),t.jsx(me,{ref:w,data:p,columns:U,renderTitle:P,size:"small",searchable:!0,selectable:!0,onSearchRow:(e,n)=>K(e,(n==null?void 0:n.name)+(n==null?void 0:n.id)+C(n==null?void 0:n.lastVisitedTime,i({en:"en-US",vi:"vi-VN"}))),keyExtractor:e=>e==null?void 0:e.id})]})}export{Le as default};
