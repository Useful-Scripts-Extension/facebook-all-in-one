import{A as J,M as rt,C as it,L as yt}from"./MyApp-KprBrH59.js";async function ht(i=""){const u=await J({fb_api_req_friendly_name:"StoriesTrayRectangularQuery",variables:{blur:10,bucketsToFetch:5,cursor:i,scale:1,id:await rt()},doc_id:"24539171939059864"}),s=JSON.parse(u);console.log(s);const{edges:_=[],page_info:l={}}=it(s);return _.map(r=>{var f,y,o,n,t,c,p,E,S,A,L,O,V;const a=((f=r==null?void 0:r.node)==null?void 0:f.story_bucket_owner)||{};return{bucket_id:(y=r==null?void 0:r.node)==null?void 0:y.id,thumbnail:(c=(t=(n=(o=r==null?void 0:r.node)==null?void 0:o.thumbnail_story_to_show)==null?void 0:n.story_card_info)==null?void 0:t.story_thumbnail)==null?void 0:c.uri,owner:{id:a.id,name:a.name,avatar:((p=a.coverImage)==null?void 0:p.uri)||((E=a.profilePic)==null?void 0:E.uri)||((S=a.profile_picture)==null?void 0:S.uri)},stories:(O=(L=(A=r==null?void 0:r.node)==null?void 0:A.unified_stories)==null?void 0:L.edges)==null?void 0:O.map(I=>{var k,C;return{id:(k=I==null?void 0:I.node)==null?void 0:k.id,expiration_time:(C=I==null?void 0:I.node)==null?void 0:C.expiration_time}}),seen:(V=r==null?void 0:r.node)==null?void 0:V.is_bucket_seen_by_viewer,cursor:(r==null?void 0:r.cursor)||l.end_cursor}}).filter(r=>r.stories.length>0)}async function wt(i=""){var l,r,a,f,y;const u=await J({fb_api_req_friendly_name:"StoriesSuspenseContentPaneRootWithEntryPointQuery",variables:{blur:10,bucketID:i,feedbackSource:65,feedLocation:"COMET_MEDIA_VIEWER",focusCommentID:null,initialBucketID:i,initialLoad:!1,scale:1,shouldDeferLoad:!1,shouldEnableArmadilloStoryReply:!0,shouldEnableLiveInStories:!0,__relay_internal__pv__StoriesIsShareToStoryEnabledrelayprovider:!1,__relay_internal__pv__StoriesLWRVariantrelayprovider:"www_new_reactions"},doc_id:"8237681579610775"}),s=JSON.parse((u==null?void 0:u.split(`
`)[0])||"{}");console.log(s);const _=((r=(l=s==null?void 0:s.data)==null?void 0:l.nodes)==null?void 0:r[0])||((a=s==null?void 0:s.data)==null?void 0:a.bucket);return(y=(f=_==null?void 0:_.unified_stories)==null?void 0:f.edges)==null?void 0:y.map(o=>{var p,E,S,A,L,O,V,I,k,C,T,P,W,Q,d,G,Y,B,F,H,U,z,K,X,Z,$,j,e,w,v,m,h,R,M,x,ot,N,g,st,at,_t;const n=((A=(S=(E=(p=o==null?void 0:o.node)==null?void 0:p.attachments)==null?void 0:E.sort((D,b)=>{var nt,tt,q,ct,lt,ut,et,ft;return(((tt=(nt=b==null?void 0:b.media)==null?void 0:nt.image)==null?void 0:tt.width)||0)*(((ct=(q=b==null?void 0:b.media)==null?void 0:q.image)==null?void 0:ct.height)||0)-(((ut=(lt=D==null?void 0:D.media)==null?void 0:lt.image)==null?void 0:ut.width)||0)*(((ft=(et=D==null?void 0:D.media)==null?void 0:et.image)==null?void 0:ft.height)||0)}))==null?void 0:S[0])==null?void 0:A.media)||{},t=((O=(L=o==null?void 0:o.node)==null?void 0:L.story_card_info)==null?void 0:O.feedback_summary)||{},c=[];for(let D of((k=(I=(V=o==null?void 0:o.node)==null?void 0:V.story_card_info)==null?void 0:I.viewerList_viewers)==null?void 0:k.edges)||[])for(let b of((C=D==null?void 0:D.feedback)==null?void 0:C.lightweight_reactions)||[]){let nt=(P=(T=b==null?void 0:b.id)==null?void 0:T.split(":"))==null?void 0:P[0],tt="";for(let q of((W=b==null?void 0:b.last5)==null?void 0:W.edges)||[])tt+=(Q=q==null?void 0:q.node)==null?void 0:Q.reaction;c.push({uid:nt,reaction:tt})}return{bucket_id:i,id:(d=o==null?void 0:o.node)==null?void 0:d.id,caption:((Y=(G=o==null?void 0:o.node)==null?void 0:G.message)==null?void 0:Y.text)||((B=n==null?void 0:n.message)==null?void 0:B.text)||((F=n==null?void 0:n.title)==null?void 0:F.text),thumbnail:((z=(U=(H=o==null?void 0:o.node)==null?void 0:H.story_card_info)==null?void 0:U.story_video_thumbnail)==null?void 0:z.uri)||((Z=(X=(K=o==null?void 0:o.node)==null?void 0:K.story_card_info)==null?void 0:X.story_thumbnail)==null?void 0:Z.uri)||(($=n==null?void 0:n.previewImage)==null?void 0:$.uri),url:(e=(j=o==null?void 0:o.node)==null?void 0:j.shareable)==null?void 0:e.url,video:(n==null?void 0:n.playable_url_quality_hd)||(n==null?void 0:n.browser_native_hd_url)||(n==null?void 0:n.playable_url)||(n==null?void 0:n.browser_native_sd_url),image:((w=n==null?void 0:n.image)==null?void 0:w.uri)||((v=n==null?void 0:n.previewImage)==null?void 0:v.uri),reaction:(h=(m=t==null?void 0:t.reaction_summary)==null?void 0:m.map(D=>D.reaction_unicode))==null?void 0:h.join(""),react_count:t==null?void 0:t.total_reaction_count,view_count:((x=(M=(R=o==null?void 0:o.node)==null?void 0:R.story_card_info)==null?void 0:M.story_viewers)==null?void 0:x.count)||((g=(N=(ot=o==null?void 0:o.node)==null?void 0:ot.story_card_info)==null?void 0:N.viewers)==null?void 0:g.count),creation_time:(st=o==null?void 0:o.node)==null?void 0:st.creation_time,seen:(_t=(at=o==null?void 0:o.node)==null?void 0:at.story_card_seen_state)==null?void 0:_t.is_seen_by_viewer,reactions:c}})}async function vt(i=""){const u=await J({doc_id:"2474284976008135",variables:{count:8,cursor:i,scale:1.5,id:btoa("app_collection:"+await rt()+":235134840312703:175")}}),s=JSON.parse(u);console.log(s);const{edges:_=[],page_info:l={}}=it(s);return _.map(r=>{var f,y,o,n,t,c;const a=((f=r==null?void 0:r.node)==null?void 0:f.node)||(r==null?void 0:r.node);return{id:a==null?void 0:a.id,creation_time:(y=a==null?void 0:a.story_card_info)==null?void 0:y.local_creation_time,thumbnail:(n=(o=a==null?void 0:a.story_card_info)==null?void 0:o.story_thumbnail)==null?void 0:n.uri,seen_count:(c=(t=a==null?void 0:a.story_card_seen_state)==null?void 0:t.seen_count)==null?void 0:c.count,cursor:(r==null?void 0:r.cursor)||l.end_cursor}})}async function bt({afterTime:i="",beforeTime:u="",creationTime:s=""}={}){var f,y,o,n;if(s){const t=new Date(s),c=new Date(t.getTime()+24*60*60*1e3);i=yt(t),u=yt(c)}console.log(i,u);const _=await J({fb_api_req_friendly_name:"StoriesArchiveContentPaneRootQuery",variables:{lower_bound_time:i,upper_bound_time:u,scale:1,blur:null,shouldEnableLiveInStories:!0,feedbackSource:65,useDefaultActor:!1,feedLocation:"COMET_MEDIA_VIEWER",focusCommentID:null,isStoriesArchive:!0,__relay_internal__pv__StoriesIsShareToStoryEnabledrelayprovider:!1},doc_id:"8266171723403755"}),l=JSON.parse(_.split(`
`)[0]||"{}");console.log(l);const{edges:r=[],page_info:a={}}=((n=(o=(y=(f=l==null?void 0:l.data)==null?void 0:f.viewer)==null?void 0:y.stories_data)==null?void 0:o.story_archive)==null?void 0:n.cards)||{};return r.map(t=>{var O,V,I,k,C,T,P,W,Q,d,G,Y,B,F,H,U,z,K,X,Z,$,j;const c=((O=t==null?void 0:t.node)==null?void 0:O.viewerCount)||{},p=(I=(V=t==null?void 0:t.node)==null?void 0:V.media_attribution_elements)==null?void 0:I.find(e=>e.attribution_type==="MUSIC");function E(e){var w,v;return(v=(w=t==null?void 0:t.node)==null?void 0:w.attachments)==null?void 0:v.find(m=>{var h;return((h=m==null?void 0:m.media)==null?void 0:h.__typename)===e})}function S(e){return["image","previewImage","blurred_image"].reduce((w,v)=>{var m,h;return w||((h=(m=e==null?void 0:e.media)==null?void 0:m[v])==null?void 0:h.uri)},"")}let A="",L=E("GenericAttachmentMedia");return L?A=E("Photo"):L=E("Photo"),{id:(k=t==null?void 0:t.node)==null?void 0:k.id,created_at:(((C=t==null?void 0:t.node)==null?void 0:C.creation_time)||0)*1e3,last_seen_at:(((P=(T=t==null?void 0:t.node)==null?void 0:T.story_card_seen_state)==null?void 0:P.seen_receipts_last_seen_time)||0)*1e3,comment_count:(Q=(W=t==null?void 0:t.node)==null?void 0:W.feedback)==null?void 0:Q.story_comment_count,viewer_count:{friend:(d=c==null?void 0:c.friendViewerCount)==null?void 0:d.count,connection:(G=c==null?void 0:c.connectionViewerCount)==null?void 0:G.count,follower:(Y=c==null?void 0:c.followerViewerCount)==null?void 0:Y.count,new_friend:(B=c==null?void 0:c.newFriendViewerCount)==null?void 0:B.count,new_connection:(F=c==null?void 0:c.newConnectionViewerCount)==null?void 0:F.count},image:S(L),image_background:S(A),video:["browser_native_hd_url","browser_native_sd_url"].reduce((e,w)=>{var v,m,h,R;return e||((R=(h=(m=(v=t==null?void 0:t.node)==null?void 0:v.attachments)==null?void 0:m.find(M=>{var x;return(x=M==null?void 0:M.media)==null?void 0:x[w]}))==null?void 0:h.media)==null?void 0:R[w])},""),music:p?(p==null?void 0:p.song_title)+" - "+(p==null?void 0:p.artist_name):"",reactions:(K=(z=(U=(H=t==null?void 0:t.node)==null?void 0:H.story_card_info)==null?void 0:U.story_card_reactions)==null?void 0:z.edges)==null?void 0:K.map(e=>{var w,v,m,h,R,M,x;return{uid:(v=(w=e==null?void 0:e.node)==null?void 0:w.messaging_actor)==null?void 0:v.id,reactions:(R=(h=(m=e==null?void 0:e.node)==null?void 0:m.messaging_actions)==null?void 0:h.edges)==null?void 0:R.reduce((ot,N)=>{var g;return ot+((g=N==null?void 0:N.node)==null?void 0:g.reaction)},""),count:(x=(M=e==null?void 0:e.node)==null?void 0:M.messaging_actions)==null?void 0:x.count}}),viewers:(j=($=(Z=(X=t==null?void 0:t.node)==null?void 0:X.story_card_info)==null?void 0:Z.viewerList_viewers)==null?void 0:$.edges)==null?void 0:j.map(pt)}})}function pt(i){var u,s,_,l,r,a,f,y;return{uid:(u=i==null?void 0:i.node)==null?void 0:u.id,avatar:(_=(s=i==null?void 0:i.node)==null?void 0:s.profile_picture)==null?void 0:_.uri,name:(l=i==null?void 0:i.node)==null?void 0:l.name,reactions:(a=(r=i==null?void 0:i.feedback)==null?void 0:r.lightweight_reactions)==null?void 0:a.reduce((o,n)=>{var c,p;const t=((c=n==null?void 0:n.last5)==null?void 0:c.edges)||((p=n==null?void 0:n.messaging_actions)==null?void 0:p.edges);return o+(t==null?void 0:t.reduce((E,S)=>{var A;return E+((A=S==null?void 0:S.node)==null?void 0:A.reaction)},""))},""),count:(y=(f=i==null?void 0:i.feedback)==null?void 0:f.lightweight_reactions)==null?void 0:y.reduce((o,n)=>{var t;return o+((t=n==null?void 0:n.messaging_actions)==null?void 0:t.count)},0),seen_time:((i==null?void 0:i.seen_time)||0)*1e3,cursor:i==null?void 0:i.cursor}}async function St({storyId:i="",cursor:u=""}={}){const s=await J({fb_api_req_friendly_name:"StoriesViewerSheetViewerListContentQuery",variables:{cursor:u,id:i,viewerCount:8},doc_id:"3934951263269875"}),_=JSON.parse(s.split(`
`)[0]||"{}");console.log(_);const{edges:l=[],page_info:r={}}=it(_);return l.map(pt)}async function It(i=""){var l,r,a,f,y;const u=await J({variables:{scale:1,userID:i,useIncrementalDelivery:!0},doc_id:"4192155837522535"}),s=JSON.parse(u.split(`
`)[0]||"{}"),_=(f=(a=(r=(l=s==null?void 0:s.data)==null?void 0:l.user)==null?void 0:r.story_bucket)==null?void 0:a.nodes)==null?void 0:f[0];return console.log(s),{bucketId:_==null?void 0:_.id,firstStoryId:(y=_==null?void 0:_.first_story_to_show)==null?void 0:y.id}}async function Dt(i="",u=""){var l,r,a,f,y,o;const s=await J({fb_api_req_friendly_name:"useStoriesSendReplyMutation",variables:{input:{lightweight_reaction_actions:{offsets:[0],reaction:u},story_id:i,story_reply_type:"LIGHT_WEIGHT",actor_id:"me"}},doc_id:"3769885849805751"}),_=JSON.parse(s);return console.log(_),(o=(y=(f=(a=(r=(l=_==null?void 0:_.data)==null?void 0:l.direct_message_reply)==null?void 0:r.story)==null?void 0:a.story_card_info)==null?void 0:f.story_card_reactions)==null?void 0:y.edges)==null?void 0:o.length}async function Et(i=""){var _,l;const u=await J({fb_api_req_friendly_name:"StoriesArchiveDeleteCardOptionMenuItem_StoriesArchiveDeleteMutation",variables:{input:{archived_story_card_id:i,actor_id:await rt()}},doc_id:8763985503642972}),s=JSON.parse(u);return console.log(s),((l=(_=s==null?void 0:s.data)==null?void 0:_.archived_story_card_delete)==null?void 0:l.deleted_archived_story_card_id)===i}export{wt as a,ht as b,St as c,vt as d,bt as e,Et as f,It as g,Dt as r};
