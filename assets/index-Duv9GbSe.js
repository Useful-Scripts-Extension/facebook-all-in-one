const __vite__fileDeps=["./MyTable-DdELbW4J.js","./index-CyNdLPYt.js","./index-BM_p-30O.css","./MyApp-LN2FQ_E9.js","./styleChecker-ClC-8w6M.js","./addEventListener-DtSE-MRu.js","./index-CcIe22ii.js","./PurePanel-DvYbUIYc.js","./TextArea-CRb-WUFr.js","./index-TSQDwhQ3.js","./index-B1msfdgL.js","./Dropdown-Buv3ST2X.js","./useBreakpoint-jzWNizqp.js","./responsiveObserver-DL0M8aFq.js","./Pagination-QV11UCB1.js","./index-DkBDeuyS.js","./row-Cy3ILbxc.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{ao as J,r as E,aq as t,ar as p,au as U,aJ as z,aw as k}from"./index-CyNdLPYt.js";import{b as W,a as q,c as S,t as T,S as x,f as N,T as b,E as X,g as Y,o as Q,z as K,J as Z}from"./MyApp-LN2FQ_E9.js";import{u as ee}from"./useForceStop-CVAeI-8J.js";import{P as ne}from"./index-vuHwb1ab.js";import{E as te}from"./ExportButton-B-H_QrN8.js";import{g as ie,U as c,a as se,l as ae}from"./groups-BZKUEUA6.js";import{A as re}from"./index-B0YJqyN9.js";import{T as I}from"./index-BkPXb0rP.js";import{T as V}from"./index-U2K3ICwR.js";import{P as F}from"./index-C-3Vv1dr.js";import{R as oe}from"./row-Cy3ILbxc.js";import"./file-download-CfLZ8p2U.js";import"./index-B1msfdgL.js";import"./Dropdown-Buv3ST2X.js";import"./PurePanel-DvYbUIYc.js";import"./responsiveObserver-DL0M8aFq.js";import"./useBreakpoint-jzWNizqp.js";import"./index-DIJCFYA9.js";import"./styleChecker-ClC-8w6M.js";import"./TextArea-CRb-WUFr.js";const le=E.lazy(()=>U(()=>import("./MyTable-DdELbW4J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url));function Ce({}){const{message:o,notification:v}=W(),A=J(),{ti:i}=q(),B=ee(),[d,M]=S("Groups.data",[]),[H,D]=S("Groups.finished",!1),[G,C]=E.useState(!1);E.useEffect(()=>{H||L(!1)},[]);const L=async(e=!1)=>{var r;if(G&&!e)return;const n=B.start(),s=e?[]:[...d],l=new Set(s.map(u=>u.id)),a="Groups:onReload";T(a),C(!0),D(!1);try{for(const[u,h]of[[ie,c.ADMIN],[se,c.MEMBER]]){const m=s[s.length-1];let w=e?"":(m==null?void 0:m.userType)===h?m==null?void 0:m.cursor:"";for(;!n.value();){o.loading({key:a,content:i({en:"Loading groups...",vi:"Đang tải nhóm..."})+s.length,duration:0});const g=await u({cursor:w}),f=g==null?void 0:g.filter(j=>!l.has(j.id));if(g.forEach(j=>l.add(j.id)),!(f!=null&&f.length))break;s.push(...f),w=(r=s==null?void 0:s[(s==null?void 0:s.length)-1])==null?void 0:r.cursor,M([...s])}}o.success({key:a,content:(n.value()?i({en:"Load groups stopped ",vi:"Dừng tải nhóm "}):i({en:"Load groups completed ",vi:"Tải xong nhóm "}))+s.length}),D(!n.value())}catch(u){o.error({content:i({en:"Failed to load groups: ",vi:"Lỗi tải nhóm: "})+u.message})}finally{C(!1)}},$=async e=>{if(!(e!=null&&e.length))return;const n="Groups:onClickLeaveSelectedGroups",s="Groups:onClickLeaveSelectedGroups:waiting";T(n);let l=!1,a=[];for(let r=0;r<e.length&&(o.destroy(s),o.loading({key:n,content:t.jsxs(t.Fragment,{children:[i({en:"Leaving groups... ",vi:"Đang rời nhóm... "})+(r+1)+"/"+e.length,t.jsx("br",{}),t.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{o.loading({key:n,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),l=!0}}),await y(e[r])&&a.push(e[r]),!l);r++)if(r<e.length-1){const h=Z(2e3,5e3);o.loading({key:s,content:i({en:"Sleeping "+Math.round(h/1e3)+"s",vi:"Đang đợi "+Math.round(h/1e3)+"s"}),duration:0}),await K(h)}o.destroy(n),o.destroy(s),v.open({type:"success",duration:0,message:i({en:`Left ${a.length}/${e.length} groups`,vi:`Đã rời ${a.length}/${e.length} nhóm`}),description:t.jsx("div",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:t.jsx("ol",{children:a.map(r=>t.jsx("li",{children:t.jsx("a",{target:"_blank",href:Y(r.id),children:r.name})},r.id))})})})},y=async e=>{const n="Groups:onClickLeaveGroup";T(n),o.loading({key:n,content:i({en:"Leaving group... "+e.name,vi:"Đang rời nhóm..."+e.name}),duration:0});const s=await ae(e.id);return s?(v.destroy(n),o.success({key:n,content:i({en:"Left group "+e.name,vi:"Đã rời nhóm "+e.name})}),M(l=>z(l,a=>{const r=a.findIndex(u=>u.id==e.id);return a[r].userType=c.NOT_JOINED,a}))):(o.destroy(n),v.open({type:"error",key:n,message:i({en:"Failed to leave group",vi:"Lỗi rời nhóm"}),description:e.name,duration:0,btn:t.jsxs(x,{children:[t.jsx(p,{type:"default",onClick:()=>y(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(p,{type:"primary",onClick:()=>window.open(Y(e.id)),children:i({en:"View group",vi:"Xem nhóm"})})]})})),s},O=e=>{A("/bulk-downloader",{state:{targetId:e.id,platform:ne.Facebook}})},_=e=>{var l;const n=e!=null&&e.length?[...e]:[...d],s=((l=n==null?void 0:n.map(a=>d.find(r=>r.id===a.id)))==null?void 0:l.filter(a=>a&&(a.userType===c.MEMBER||a.userType===c.ADMIN)))||[];return t.jsxs(t.Fragment,{children:[t.jsx(p,{type:"primary",icon:G?t.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):t.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>L(!0),children:i({en:"Reload",vi:"Tải lại"})}),t.jsx(te,{data:n,options:[{key:"id",label:".txt (group id)",prepareData:a=>({fileName:"your_groups_id"+k().format("YYYY-MM-DD-HHmmss")+".txt",data:a==null?void 0:a.map(r=>r.id).join(`
`)})},{key:"json",label:".json",prepareData:a=>({fileName:"your_groups"+k().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(a==null?void 0:a.map(r=>({...r,last_visited:N(r.lastVisitedTime,i({en:"en-US",vi:"vi-VN"}))})),null,4)})},{key:"csv",label:".csv",prepareData:a=>({fileName:"your_groups"+k().format("YYYY-MM-DD-HHmmss")+".csv",data:Q(a)})}]}),t.jsx(b,{title:i({en:`Leave ${s.length} selected groups`,vi:`Rời ${s.length} nhóm được chọn`}),children:t.jsx(F,{title:i({en:`Leave ${s.length} groups`,vi:`Rời ${s.length} nhóm`}),description:i({en:`Are your sure want to Leave ${s.length} groups?`,vi:`Bản có chãc muốn rời ${s.length} nhóm?`}),onConfirm:()=>$(s),okText:i({en:"Leave groups",vi:"Rời nhóm"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(p,{danger:!0,type:"primary",disabled:s.length<=0,icon:t.jsx("i",{className:"fa-regular fa-trash-can"}),children:s.length})})}),t.jsx(p,{icon:t.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/groups/joins","_blank"),children:i({en:"View on Facebook",vi:"Xem trên Facebook"})})]})},R=e=>{switch(e){case c.MEMBER:return{color:"default",text:i({en:"Member",vi:"Thành viên"})};case c.ADMIN:return{color:"success",text:"Admin"};case c.NOT_JOINED:return{color:"error",text:i({en:"Left group",vi:"Đã rời nhóm"})};case c.PENDING:return{color:"warning",text:i({en:"Pending",vi:"Đang chờ"})};default:return{color:"default",text:"?"}}},P=[{title:i({en:"Group",vi:"Nhóm"}),key:"group",dataIndex:"group",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n,s)=>t.jsxs(x,{style:{maxWidth:400},align:"start",children:[t.jsx(re,{src:n.avatar,size:45}),t.jsxs(x,{direction:"vertical",size:0,children:[t.jsx(I.Link,{href:n.url,target:"_blank",children:t.jsx("b",{children:n.name})}),t.jsx("span",{style:{opacity:.7},children:n.id})]})]})},{title:i({en:"Last visit",vi:"Lần xem gần nhất"}),key:"lastVisitedTime",dataIndex:"lastVisitedTime",sorter:(e,n)=>e.lastVisitedTime-n.lastVisitedTime,render:(e,n,s)=>N(n.lastVisitedTime,i({en:"en-US",vi:"vi-VN"})),align:"right"},{title:i({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,n,s)=>{const{color:l,text:a}=R(n.userType);return t.jsx(V,{color:l,children:a})},filters:Object.values(c).map(e=>{const{text:n}=R(e);return{text:n+" ("+d.filter(s=>s.userType==e).length+")",value:e}}),onFilter:(e,n)=>n.userType==e,align:"right"},{title:i({en:"Action",vi:"Hành động"}),key:"action",render:(e,n,s)=>t.jsxs(x.Compact,{style:{minWidth:30},children:[t.jsx(b,{title:i({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:t.jsx(p,{type:"default",onClick:()=>O(n),icon:t.jsx("i",{className:"fa-solid fa-download"})})}),n.userType!==c.NOT_JOINED?t.jsx(b,{title:i({en:"Leave group",vi:"Rời nhóm"}),children:t.jsx(F,{title:i({en:"Leave group",vi:"Rời nhóm"}),description:i({en:"Are you sure want to leave this group?",vi:"Bạn có chắc muốn rời nhóm này?"}),onConfirm:()=>y(n),okText:i({en:"Yes",vi:"Có"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(p,{danger:!0,type:"primary",icon:t.jsx("i",{className:"fa-regular fa-trash-can"})})})}):null]}),align:"right"}];return t.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[t.jsxs(oe,{align:"middle",style:{margin:"16px"},children:[t.jsx(I.Title,{level:3,style:{margin:0},children:i({en:"Groups manager",vi:"Quản lý nhóm"})}),t.jsx(V,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:d.length})]}),t.jsx(le,{data:d,columns:P,renderTitle:_,size:"small",searchable:!0,selectable:!0,onSearchRow:(e,n)=>X(e,(n==null?void 0:n.name)+(n==null?void 0:n.id)+N(n==null?void 0:n.lastVisitedTime,i({en:"en-US",vi:"vi-VN"}))),keyExtractor:e=>e==null?void 0:e.id})]})}export{Ce as default};
