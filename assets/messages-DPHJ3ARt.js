import{z as u,e as w,J as y}from"./MyApp-FBvIgKZR.js";async function k(){return(await Promise.all([u("viewer(){message_threads{count,nodes{customization_info{emoji,outgoing_bubble_color,participant_customizations{participant_id,nickname}},all_participants{nodes{messaging_actor{name,id,profile_picture}}},thread_type,name,messages_count,image,id}}}").then(e=>JSON.parse(e||"{}")),u({queries:{o0:{doc_id:"1475048592613093",query_params:{limit:500,before:Date.now(),tags:["ARCHIVED"],includeDeliveryReceipts:!0,includeSeqID:!1}}}},"https://www.facebook.com/api/graphqlbatch/").then(e=>{var t,a,r;return(r=(a=JSON.parse(((t=e==null?void 0:e.split(`
`))==null?void 0:t[0])||"{}"))==null?void 0:a.o0)==null?void 0:r.data})])).map(e=>{var t,a;return(a=(t=e==null?void 0:e.viewer)==null?void 0:t.message_threads)==null?void 0:a.nodes}).filter(Boolean).flat().map((e,t)=>({...e,recent:t})).map(e=>{var r,o,c,d,l,p;let t=e.all_participants.nodes.map(m=>{var _,g,h;return{id:m.messaging_actor.id,name:m.messaging_actor.name,avatar:((_=m.messaging_actor.profile_picture)==null?void 0:_.uri)||((h=(g=m.messaging_actor.avatar)==null?void 0:g.big_image_src)==null?void 0:h.uri)||w(m.messaging_actor.id)}}),a={recent:e.recent,type:e.thread_type,id:((r=e.thread_key)==null?void 0:r.other_user_id)||((o=e.thread_key)==null?void 0:o.thread_fbid)||(e.id?(d=(c=atob(e.id))==null?void 0:c.split(":"))==null?void 0:d[1]:""),count:e.messages_count,name:e.name||((l=t[0])==null?void 0:l.name)||"-no data-",participants:t,image:(p=e.image)==null?void 0:p.uri};return{...a,url:`https://www.facebook.com/messages/t/${a.id}`,isGroup:a.type==="GROUP"||a.type==="COMMUNITY_GROUP"}})}async function f({friendUid:i,startTime:n,endTime:s,progress:e}){let t=1e3*Math.round((n+s)/2/1e3);e==null||e(t);let a=await b({friendUid:i,time:t,limit:1});return Math.abs(s-n)<=1e3?a:a!=null&&a.length?await f({friendUid:i,startTime:n,endTime:t-1,progress:e}):await f({friendUid:i,startTime:t+1,endTime:s,progress:e})}async function q({friendUid:i,msgId:n,direction:s="down",limit:e=50}){var o;const t=await u({other_user_fbid:i,message_id:n,direction:s,limit:e,__a:1},"https://www.facebook.com/ajax/mercury/search_context.php"),a=JSON.parse(t.substr(9)),r=(o=a==null?void 0:a.payload)==null?void 0:o.graphql_payload;return r||new Error("There is no results.")}async function b({friendUid:i,time:n=null,limit:s=50}){var t;const e=await u({queries:{o0:{doc_id:"1526314457427586",query_params:{id:i,message_limit:s,load_messages:1,load_read_receipts:!0,before:n}}}},"https://www.facebook.com/api/graphqlbatch/");try{const a=JSON.parse(e.split(`
`)[0]);if(a.o0.data.message_thread)return((t=a.o0.data.message_thread.messages)==null?void 0:t.nodes)||[]}catch(a){console.error(a.message)}return[]}async function A(i){var s,e,t,a,r,o;return(o=(r=(a=(t=(e=(s=(await y(i)).raw)==null?void 0:s.data)==null?void 0:e.node)==null?void 0:t.comet_hovercard_renderer)==null?void 0:a.user)==null?void 0:r.primaryActions)==null?void 0:o.find(c=>(c==null?void 0:c.profile_action_type)=="MESSAGE")}export{b as a,q as b,A as c,f,k as g};
