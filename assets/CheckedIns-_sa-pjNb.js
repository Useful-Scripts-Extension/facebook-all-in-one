import{al as E,am as A,r as d,aq as l,ar as p}from"./index-DK9VpK7Z.js";import{a as F,t as B,am as L,S as m,T as M,o as j}from"./MyApp-BHD6VW6n.js";import{P as R}from"./index-vuHwb1ab.js";import{u as g}from"./useForceStop-DyPdTTlM.js";import q from"./MyTable-BZIS_vNf.js";import{E as $}from"./ExportButton-Y9XVLGfG.js";import{u as z,g as I}from"./useCacheState-B8xTfoxV.js";import{I as H}from"./index-Cg-fKe13.js";import{T as J}from"./index-CLcfezOx.js";import{A as K}from"./index-B5cL9EV-.js";import"./styleChecker-DFOfC8TH.js";import"./addEventListener-DnrojY7_.js";import"./index-Ch48yAb_.js";import"./PurePanel-F8yUCVM9.js";import"./TextArea-Dam_UsLU.js";import"./index-B8Ssol98.js";import"./index-BjwtQS8J.js";import"./Dropdown-CDem9SrW.js";import"./useBreakpoint-D3UHp-M0.js";import"./Pagination-DofX7tu3.js";import"./row-TMJJSMo1.js";import"./file-download-DObqyEDW.js";function he({target:n}){const{ti:s}=F(),{message:w}=E.useApp(),C=A(),b=g(),[h,u]=d.useState(!1),[o,f]=z("CheckedIns.data."+(n==null?void 0:n.id),[]),t=d.useMemo(()=>{const a=new Map,e=new Map;return o.forEach(i=>{a.has(i.place)||a.set(i.place,i),e.has(i.pageId)||e.set(i.pageId,i)}),{allPlaces:Array.from(a.values()),allPages:Array.from(e.values())}},[o]);d.useEffect(()=>{var a;n!=null&&n.id&&x(!((a=I("CheckedIns.data."+(n==null?void 0:n.id)))!=null&&a.length))},[n==null?void 0:n.id]);const x=async(a=!1)=>{var y,v;if(!(n!=null&&n.id))return;const e=b.start();let r=[...a?[]:I("CheckedIns.data."+(n==null?void 0:n.id))||[]],k=((y=r[r.length-1])==null?void 0:y.cursor)||"";const P="CheckedIns:onReload:"+n.id;B(P),u(!0);try{for(;!e.value();){const c=await L({uid:n.id,cursor:k});if(!(c!=null&&c.length))break;k=(v=c[c.length-1])==null?void 0:v.cursor,r=[...r,...c].map((T,D)=>({...T,recent:D})),f(r)}}catch(c){w.error({content:s({en:"Error: ",vi:"Lỗi: "})+c.message})}finally{f(r),u(!1)}},N=a=>{C("/bulk-downloader",{state:{targetId:a,platform:R.Facebook}})},_=a=>l.jsxs(m,{children:[l.jsx(p,{disabled:h,type:"primary",icon:h?l.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):l.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>x(!0),children:s({en:"Reload",vi:"Tải lại"})}),l.jsx($,{data:a.length?a:o,options:[{key:"id",label:".txt (page id)",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in_id.txt",data:e.map(i=>i.pageId).join(`
`)})},{key:"id_name",label:".csv (page id+name)",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in_id_name.csv",data:j(e.map(i=>({page:i.pageId,name:i.pageName,place:i.place})))})},{key:"json",label:".json",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in.json",data:JSON.stringify(e,null,4)})},{key:"csv",label:".csv",prepareData:e=>({fileName:(n==null?void 0:n.name)+"_check_in.csv",data:j(e)})}]}),l.jsx(p,{onClick:()=>{var e;(e=n==null?void 0:n.url)!=null&&e.includes("?id=")?window.open((n==null?void 0:n.url)+"&sk=map","_blank"):window.open((n==null?void 0:n.url)+"/map","_blank")},icon:l.jsx("i",{className:"fa fa-external-link-alt"}),children:s({vi:"Xem trên Facebook",en:"View on Facebook"})},"view-fb")]}),S=[{title:"#",dataIndex:"recent",key:"recent",render:(a,e,i)=>(e.recent||0)+1,sorter:(a,e)=>a.recent-e.recent,width:60},{title:s({en:"Cover",vi:"Ảnh"}),key:"cover",dataIndex:"image",render:(a,e,i)=>l.jsx(H,{src:e.image,style:{width:120,height:120,objectFit:"contain"}}),width:120},{title:t.allPages.length+" "+s({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",sorter:(a,e)=>a.pageName.localeCompare(e.pageName),render:(a,e,i)=>l.jsxs(m,{direction:"vertical",style:{maxWidth:250},children:[l.jsx(J.Link,{href:e.url,target:"_blank",children:l.jsx("b",{children:e.pageName})}),l.jsx("span",{style:{opacity:.6},children:e.pageId})]}),filters:t.allPages.map(a=>{let e=o.filter(i=>i.pageId===a.pageId).length;return{count:e,value:a.pageId,text:a.pageName+" ("+e+")"}}).sort((a,e)=>e.count-a.count),onFilter:(a,e)=>e.pageId==a,filterSearch:!0},{title:t.allPlaces.length+" "+s({en:"Place",vi:"Địa điểm"}),key:"place",dataIndex:"place",sorter:(a,e)=>a.place.localeCompare(e.place),filters:t.allPlaces.map(a=>{let e=o.filter(i=>i.place===a.place).length;return{count:e,value:a.place,text:a.place+" ("+e+")"}}).sort((a,e)=>e.count-a.count),onFilter:(a,e)=>e.place==a,filterSearch:!0,width:200},{title:s({en:"Time",vi:"Thời gian"}),key:"timeString",dataIndex:"timeString",sorter:(a,e)=>a.timeString.localeCompare(e.timeString),width:250},{title:s({en:"Actions",vi:"Hành động"}),key:"actions",render:(a,e,i)=>l.jsx(m.Compact,{children:l.jsx(M,{title:s({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:l.jsx(p,{type:"default",onClick:()=>N(e.pageId),icon:l.jsx("i",{className:"fa-solid fa-download"})})})}),width:100,align:"end"}];return l.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[l.jsx(K,{type:"success",showIcon:!0,message:s({en:`Checked in ${o.length} times`,vi:`Đã check in ${o.length} lần`}),style:{alignSelf:"center",marginBottom:10}}),l.jsx(q,{columns:S,data:o,keyExtractor:a=>a==null?void 0:a.id,searchable:!0,pageSize:3,renderTitle:_})]})}export{he as default};
