import{r as H,av as s,aw as k,aN as A}from"./index-DKcwpaNn.js";import{C as D,D as O,E as K,u as ee,c as ne,e as S,t as Q,L as V,b,i as te,f as W,K as ie,T as I,j as se,h as re,Q as ce}from"./MyApp-CDv-rFzA.js";import ae from"./MyTable-Cfe24VBl.js";import{u as oe}from"./useForceStop-BTxDv_WH.js";import{A as le}from"./index-D2EOnXJc.js";import{I as de}from"./index-Dg7Z2Izz.js";import{T as ue}from"./index-B_vBY5DC.js";import{R as ge}from"./row-DQZWBVdA.js";import{T as he}from"./index-CWhtpity.js";import{R as z}from"./Table-BrmzQDbH.js";import{P as $}from"./index-DWpWDo57.js";import"./index-b6__-RGH.js";import"./index-DyBnpzdS.js";import"./EyeOutlined-DBKuVwCK.js";import"./SearchOutlined-CyhZwKQE.js";import"./responsiveObserver-C2jXDk8e.js";import"./useBreakpoint-SG1Oq1Ac.js";import"./index-CDyKukV1.js";import"./addEventListener-Bihk99B1.js";import"./index-BeW64aJ1.js";import"./PurePanel-Dm2KaroR.js";import"./index-R4jL5rp5.js";import"./index-DHgoLQnq.js";import"./Dropdown-C-7JdpRY.js";import"./Pagination-cNqsTGGh.js";var a=(e=>(e.INCOMING_REQUEST="INCOMING_REQUEST",e.OUTGOING_REQUEST="OUTGOING_REQUEST",e.DECLINED="DECLINED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e))(a||{});async function me(e=""){const o=await D({fb_api_req_friendly_name:"FriendingCometFriendRequestsGridPaginationQuery",variables:{count:20,cursor:e,scale:2},doc_id:"5073444706045886"}),l=O(o),{edges:h=[],page_info:d={}}=K(l);return h.map((t,C)=>{var p,E,_,N,q,R,v,y;return{id:(p=t==null?void 0:t.node)==null?void 0:p.id,name:(E=t==null?void 0:t.node)==null?void 0:E.name,avatar:(N=(_=t==null?void 0:t.node)==null?void 0:_.profile_picture)==null?void 0:N.uri,url:(q=t==null?void 0:t.node)==null?void 0:q.url,desc:(v=(R=t==null?void 0:t.node)==null?void 0:R.social_context)==null?void 0:v.text,seen:t==null?void 0:t.is_seen,time:((t==null?void 0:t.time)||0)*1e3,type:(y=t==null?void 0:t.node)==null?void 0:y.friendship_status,cursor:t==null?void 0:t.cursor}})}async function fe(e=""){const o=await D({fb_api_req_friendly_name:"FriendingCometOutgoingRequestsDialogPaginationQuery",variables:{count:10,cursor:e,scale:2},doc_id:"4420916318007844"}),l=O(o),{edges:h=[],page_info:d={}}=K(l);return h.map((t,C)=>{var p,E,_,N,q,R,v,y;return{id:(p=t==null?void 0:t.node)==null?void 0:p.id,name:(E=t==null?void 0:t.node)==null?void 0:E.name,avatar:(N=(_=t==null?void 0:t.node)==null?void 0:_.profile_picture)==null?void 0:N.uri,url:(q=t==null?void 0:t.node)==null?void 0:q.url,desc:(v=(R=t==null?void 0:t.node)==null?void 0:R.social_context)==null?void 0:v.text,seen:t==null?void 0:t.is_seen,time:((t==null?void 0:t.time)||0)*1e3,type:(y=t==null?void 0:t.node)==null?void 0:y.friendship_status,cursor:t==null?void 0:t.cursor}})}async function pe(e=""){var h,d,t;const o=await D({variables:{input:{friend_requester_id:e,source:"friends_tab",actor_id:"me"},scale:2,refresh_num:0},doc_id:"4189738374386264"}),l=O(o);return((t=(d=(h=l==null?void 0:l.data)==null?void 0:h.friend_request_delete)==null?void 0:d.friend_requester)==null?void 0:t.id)==e}async function xe(e=""){var h,d,t;const o=await D({variables:{input:{friend_requester_id:e,source:"friends_tab",actor_id:"me"},scale:2,refresh_num:0},doc_id:"3750307704981867"}),l=O(o);return((t=(d=(h=l==null?void 0:l.data)==null?void 0:h.friend_request_accept)==null?void 0:d.friend_requester)==null?void 0:t.id)==e}async function ye(e=""){var h,d,t;const o=await D({fb_api_req_friendly_name:"FriendingCometFriendRequestCancelMutation",variables:{input:{attribution_id_v2:"FriendingCometFriendRequestsRoot.react,comet.friending.friendrequests,unexpected,1724509964587,135627,2356318349,,;FriendingCometRoot.react,comet.friending,tap_bookmark,1724509961317,200700,2356318349,,",cancelled_friend_requestee_id:e,friending_channel:"MANAGE_OUTGOING_REQUESTS",actor_id:"me"},scale:2},doc_id:"5247084515315799"}),l=O(o);return((t=(d=(h=l==null?void 0:l.data)==null?void 0:h.friend_request_cancel)==null?void 0:d.cancelled_friend_requestee)==null?void 0:t.id)==e}const w={[a.INCOMING_REQUEST]:{vi:"Đã nhận",en:"Incoming",color:"default",icon:"fa-solid fa-arrow-turn-down"},[a.OUTGOING_REQUEST]:{vi:"Đã gửi",en:"Outgoing",color:"default",icon:"fa-solid fa-arrow-turn-up"},[a.DECLINED]:{vi:"Đã từ chối",en:"Declined",color:"error",icon:"fa-solid fa-xmark"},[a.ACCEPTED]:{vi:"Đã chấp nhận",en:"Accepted",color:"success",icon:"fa-solid fa-check"},[a.CANCELED]:{vi:"Đã huỷ",en:"Canceled",color:"error",icon:"fa-solid fa-xmark"}};function Be(){const{ti:e}=ee(),{message:o,notification:l}=ne(),h=oe(),[d,t]=S("FriendRequestType",a.INCOMING_REQUEST),[C,p]=S("FriendRequests.data",[]),[E,_]=S("FriendRequests.finished",!1),[N,q]=S("FriendRequests.loading",!1),R=H.useMemo(()=>C.filter(n=>n.type===d).map((n,i)=>({...n,recent:i})),[C,d]);H.useEffect(()=>{E||v(!1)},[d,E]);const v=async(n=!1)=>{const i=n?[]:C,r=h.start(),c="FriendRequests:onReload";Q(c);const u=[a.INCOMING_REQUEST,a.OUTGOING_REQUEST].map(async x=>{var f;const m=w[x],T=c+x;try{const F=i.filter(g=>g.type===x),j=F[F.length-1];let G=F.length,B=n?"":j==null?void 0:j.cursor;const J=x===a.INCOMING_REQUEST?me:fe;for(;!r.value();){o.loading({key:T,content:e({en:`Loading ${m.en} friend requests...`,vi:`Đang tải yêu cầu kết bạn ${m.vi}...`})+G,duration:0});const g=await J(B);if(!(g!=null&&g.length))break;G+=g==null?void 0:g.length,B=(f=g==null?void 0:g[(g==null?void 0:g.length)-1])==null?void 0:f.cursor,p(Z=>[...Z,...g]),await V(1e3)}o.success({key:T,content:e({en:"Loaded friend requests "+m.en+": ",vi:"Tải xong yêu cầu kết bạn "+m.vi+": "})+G})}catch(F){l.open({type:"error",message:e({en:"Failed to load friend requests "+m.en+": ",vi:"Lỗi tải yêu cầu kết bạn "+m.vi+": "}),description:F.message})}});q(!0),_(!1),await Promise.all(u),q(!1),_(!r.value())},y=async({data:n,key:i,actionFn:r,loadingText:c,successText:u})=>{if(!await se()||!(n!=null&&n.length))return;const x=i+":waiting";Q(i);let m=!1,T=[];for(let f=0;f<n.length&&(o.destroy(x),o.loading({key:i,content:s.jsxs(s.Fragment,{children:[c+(f+1)+"/"+n.length,s.jsx("br",{}),s.jsx("i",{children:e({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{o.loading({key:i,content:e({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),m=!0}}),await r(n[f])&&T.push(n[f]),!m);f++)if(f<n.length-1){const j=ce(2e3,5e3);o.loading({key:x,content:e({en:"Sleeping "+Math.round(j/1e3)+"s",vi:"Đang đợi "+Math.round(j/1e3)+"s"}),duration:0}),await V(j)}o.destroy(i),o.destroy(x),l.open({type:"success",duration:0,message:u+`${T.length}/${n.length}`,description:s.jsx("ol",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:T.map(f=>s.jsx("li",{children:s.jsx("a",{target:"_blank",href:re(f.id),children:f.name})},f.id))})})},U=async({key:n,record:i,loadingText:r,successText:c,failedText:u,action:x,onSuccess:m})=>{Q(n);try{if(o.loading({key:n,content:r+i.name,duration:0}),await x())return m==null||m(),o.success({key:n,content:c+i.name}),!0;throw new Error("Facebook response error")}catch(T){return o.destroy(n),l.open({type:"error",message:u+i.name,description:T.message}),!1}finally{}},L=n=>U({key:"FriendRequests:onClickDeclineFriendRequest",record:n,loadingText:e({en:"Declining friend request...",vi:"Đang từ chối yêu cầu kết bạn..."}),successText:e({en:"Declined friend request ",vi:"Từ chối yêu cầu thành công "}),failedText:e({en:"Failed to decline friend request: ",vi:"Lỗi từ chối yêu cầu kết bạn: "}),action:()=>pe(n.id),onSuccess:()=>{p(i=>A(i,r=>{const c=r.findIndex(u=>u.id===n.id);return c>=0&&(r[c].type=a.DECLINED),r}))}}),M=n=>U({key:"FriendRequests:onClickAcceptFriendRequest",record:n,loadingText:e({en:"Accepting friend request...",vi:"Đang đồng ý yêu cầu kết bạn..."}),successText:e({en:"Accepted friend request ",vi:"Đã đồng ý yêu cầu kết bạn "}),failedText:e({en:"Failed to accept friend request: ",vi:"Lỗi đồng ý yêu cầu kết bạn: "}),action:()=>xe(n.id),onSuccess:()=>{p(i=>A(i,r=>{const c=r.findIndex(u=>u.id===n.id);return c>=0&&(r[c].type=a.ACCEPTED),r}))}}),P=n=>U({key:"FriendRequests:onClickCancelOutgoingRequest",record:n,loadingText:e({en:"Canceling friend request...",vi:"Đang thu hồi yêu cầu kết bạn..."}),successText:e({en:"canceled friend request ",vi:"Đã thu hồi yêu cầu kết bạn "}),failedText:e({en:"Failed to cancel friend request: ",vi:"Lỗi thu hồi yêu cầu kết bạn: "}),action:()=>ye(n.id),onSuccess:()=>{p(i=>A(i,r=>{const c=r.findIndex(u=>u.id===n.id);return c>=0&&(r[c].type=a.CANCELED),r}))}}),X=n=>{const i=n!=null&&n.length?[...n]:[...C],r=i.filter(u=>u.type===a.INCOMING_REQUEST),c=i.filter(u=>u.type===a.OUTGOING_REQUEST);return s.jsxs(s.Fragment,{children:[s.jsx(k,{type:"primary",icon:N?s.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):s.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>v(!0),children:e({en:"Reload",vi:"Tải lại"})}),d===a.INCOMING_REQUEST?s.jsxs(b.Compact,{children:[s.jsx(I,{title:e({en:`Accept ${r.length} selected incoming requests`,vi:`Đồng ý ${r.length} lời mời đang chọn`}),children:s.jsx($,{title:e({en:`Accept ${r.length} selected incoming requests`,vi:`Đồng ý ${r.length} lời mời đang chọn`}),description:e({en:`Are your sure want to accept ${r.length} incoming requests?`,vi:`Bản có chãc muốn đồng ý ${r.length} lời mời?`}),onConfirm:()=>y({data:r,key:"FriendRequests:onClickAcceptSelectedIncomingFriendRequests",actionFn:M,loadingText:e({en:"Accepting incoming requests...",vi:"Đang đồng ý lời mời..."}),successText:e({en:"Accepted incoming requests done: ",vi:"Đồng ý lời mời xong: "})}),okText:e({en:"Accept",vi:"Đồng ý"}),cancelText:e({en:"No",vi:"Huỷ"}),children:s.jsx(k,{disabled:r.length<=0,icon:s.jsx("i",{className:"fa-solid fa-check"}),children:r.length})})}),s.jsx(I,{title:e({en:`Decline ${r.length} selected incoming requests`,vi:`Từ chối ${r.length} lời mời đang chọn`}),children:s.jsx($,{title:e({en:`Decline ${r.length} selected incoming requests`,vi:`Từ chối ${r.length} lời mời đang chọn`}),description:e({en:`Are your sure want to decline ${r.length} incoming requests?`,vi:`Bản có chãc muốn từ chối ${r.length} lời mời?`}),onConfirm:()=>y({data:r,key:"FriendRequests:onClickDeclineSelectedIncomingFriendRequests",actionFn:L,loadingText:e({en:"Declining incoming requests...",vi:"Đang từ chối lời mời..."}),successText:e({en:"Declined incoming requests done: ",vi:"Từ chối lời mời xong: "})}),okText:e({en:"Decline",vi:"Từ chối"}),cancelText:e({en:"No",vi:"Huỷ"}),children:s.jsx(k,{danger:!0,disabled:r.length<=0,icon:s.jsx("i",{className:"fa-regular fa-trash-can"}),children:r.length})})})]}):s.jsx(s.Fragment,{children:s.jsx(I,{title:e({en:`Cancel ${c.length} selected outgoing requests`,vi:`Thu hồi ${c.length} yêu cầu đang chọn`}),children:s.jsx($,{title:e({en:`Cancel ${c.length} selected outgoing requests`,vi:`Thu hồi ${c.length} yêu cầu đang chọn`}),description:e({en:`Are your sure want to cancel ${c.length} outgoing requests?`,vi:`Bản có chãc muốn thu hồi ${c.length} yêu cầu?`}),onConfirm:()=>y({data:c,key:"FriendRequests:onClickCancelSelectedOutgoingFriendRequests",actionFn:P,loadingText:e({en:"Canceling outgoing requests...",vi:"Đang thu hồi yêu cầu..."}),successText:e({en:"Declined requests done: ",vi:"Thu hồi yêu cầu xong: "})}),okText:e({en:"Cancel",vi:"Thu hồi"}),cancelText:e({en:"No",vi:"Huỷ"}),children:s.jsx(k,{danger:!0,disabled:c.length<=0,icon:s.jsx("i",{className:"fa-regular fa-trash-can"}),children:c.length})})})}),s.jsx(I,{title:e({en:"View on Facebook",vi:"Xem trên Facebook"}),children:s.jsx(k,{icon:s.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/friends/requests","_blank")})})]})},Y=[{title:"#",key:"recent",dataIndex:"recent",render:(n,i,r)=>i.recent+1,sorter:(n,i)=>n.recent-i.recent,width:50},{title:e({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(n,i)=>(n.name||"").localeCompare(i.name||""),render:(n,i,r)=>s.jsxs(b,{align:"center",style:{maxWidth:300},children:[s.jsx(le,{shape:"square",src:s.jsx(de,{src:te(i.id),fallback:i.avatar}),size:50}),s.jsxs(b,{direction:"vertical",style:{marginLeft:"10px"},size:0,children:[s.jsx("a",{href:i.url,target:"_blank",children:s.jsx("b",{children:i.name})}),s.jsx("span",{style:{opacity:.5},children:i.id})]})]})},{title:e({en:"Description",vi:"Mô tả"}),key:"desc",dataIndex:"desc",sorter:(n,i)=>(n.desc||"").localeCompare(i.desc||""),render:(n,i,r)=>s.jsx("p",{style:{maxWidth:150,minWidth:100},children:i.desc}),width:"auto"},{title:e({en:"Time",vi:"Thời gian"}),key:"time",dataIndex:"time",sorter:(n,i)=>n.time-i.time,render:(n,i,r)=>W(i.time,e({en:"en-US",vi:"vi-VN"}))||"-",onSearch:(n,i)=>ie(n,W(i,e({en:"en-US",vi:"vi-VN"}))),align:"right",width:180},{title:e({en:"Status",vi:"Trạng thái"}),key:"type",dataIndex:"type",filters:(d===a.INCOMING_REQUEST?[a.INCOMING_REQUEST,a.ACCEPTED,a.DECLINED]:[a.OUTGOING_REQUEST,a.CANCELED]).map(n=>{const i=w[n],r=C.filter(c=>c.type===n).length;return{text:e(i)+` (${r})`,value:n}}),onFilter:(n,i)=>i.type===n,render:(n,i,r)=>{const c=w[i.type];return s.jsx(ue,{color:c==null?void 0:c.color,children:e(c)})},align:"right"},{title:e({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(n,i,r)=>i.type===a.INCOMING_REQUEST?s.jsxs(b.Compact,{children:[s.jsx(I,{title:e({en:"Accept",vi:"Đồng ý"}),children:s.jsx(k,{onClick:()=>M(i),icon:s.jsx("i",{className:"fa-solid fa-check"})})}),s.jsx(I,{title:e({en:"Decline",vi:"Từ chối"}),children:s.jsx(k,{danger:!0,onClick:()=>L(i),icon:s.jsx("i",{className:"fa-solid fa-trash-can"})})})]}):i.type===a.OUTGOING_REQUEST?s.jsx(b.Compact,{children:s.jsx(I,{title:e({en:"Cancel",vi:"Thu hồi"}),children:s.jsx(k,{danger:!0,onClick:()=>P(i),icon:s.jsx("i",{className:"fa-solid fa-trash-can"})})})}):null,align:"right",width:100}];return s.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[s.jsx(ge,{align:"middle",style:{margin:"16px"},children:s.jsx(he.Title,{level:3,style:{margin:0},children:e({en:"Friend Requests",vi:"Lời mời kết bạn"})})}),s.jsx(z.Group,{defaultValue:d,buttonStyle:"solid",style:{marginBottom:10},children:[a.INCOMING_REQUEST,a.OUTGOING_REQUEST].map(n=>s.jsxs(z.Button,{value:n,onClick:()=>{t(n)},children:[s.jsx("i",{className:w[n].icon})," ",`${e(w[n])} ${C.filter(i=>i.type===n).length}`]},n))}),s.jsx(ae,{data:R,columns:Y,renderTitle:X,size:"small",searchable:!0,selectable:!0,keyExtractor:n=>n.id})]})}export{Be as default};
