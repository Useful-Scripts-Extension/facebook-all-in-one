import{r as Q,ao as s,ap as v,aJ as w}from"./index-CPo4srtR.js";import{x as F,y as B,a as H,b as W,c as b,t as D,S as I,e as V,f as L,C as z,T as N,q as K,z as X,g as Y,D as Z}from"./MyApp-DM0tH3OB.js";import ee from"./MyTable-P0q38AYL.js";import{u as ne}from"./useForceStop-BzRxTZZZ.js";import{A as te}from"./index-DT_RlUCm.js";import{I as ie}from"./index-D3X1BVvP.js";import{T as se}from"./index-ETPn7PVq.js";import{R as re}from"./row-CxtJL-XF.js";import{T as ce}from"./index-sXJOn1Wi.js";import{R as M}from"./index-BfSXdXld.js";import{P as A}from"./index-DRlYMj-t.js";import"./styleChecker-BbGBrMYz.js";import"./addEventListener-CyUJwPli.js";import"./index-CjkvbNRA.js";import"./PurePanel-Ux3vADbr.js";import"./TextArea-CmgGZwb8.js";import"./index-CGKz0B1Y.js";import"./index-D_rcyr9I.js";import"./index-DDLVWXn_.js";import"./Dropdown-D02Vb68h.js";import"./useBreakpoint-C0CG1VVa.js";import"./responsiveObserver-DFa44coF.js";import"./Pagination-DU7WbbIE.js";import"./index-B36Wm4Om.js";import"./index-tm_mFWMz.js";var d=(e=>(e.INCOMING_REQUEST="INCOMING_REQUEST",e.OUTGOING_REQUEST="OUTGOING_REQUEST",e.DECLINED="DECLINED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e))(d||{});async function ae(e=""){const a=await F({fb_api_req_friendly_name:"FriendingCometFriendRequestsSectionPanelPaginationQuery",variables:{count:20,cursor:e,scale:2},doc_id:"4843321999100134"}),l=JSON.parse(a),{edges:h=[],page_info:o={}}=B(l)||{};return h.map((i,E)=>{var f,y,q,k,C,R,T,p;return{id:(f=i==null?void 0:i.node)==null?void 0:f.id,name:(y=i==null?void 0:i.node)==null?void 0:y.name,avatar:(k=(q=i==null?void 0:i.node)==null?void 0:q.profile_picture)==null?void 0:k.uri,url:(C=i==null?void 0:i.node)==null?void 0:C.url,desc:(T=(R=i==null?void 0:i.node)==null?void 0:R.social_context)==null?void 0:T.text,seen:i==null?void 0:i.is_seen,time:((i==null?void 0:i.time)||0)*1e3,type:(p=i==null?void 0:i.node)==null?void 0:p.friendship_status,cursor:i==null?void 0:i.cursor}})}async function oe(e=""){const a=await F({fb_api_req_friendly_name:"FriendingCometOutgoingRequestsDialogPaginationQuery",variables:{count:10,cursor:e,scale:2},doc_id:"4420916318007844"}),l=JSON.parse(a),{edges:h=[],page_info:o={}}=B(l)||{};return h.map((i,E)=>{var f,y,q,k,C,R,T,p;return{id:(f=i==null?void 0:i.node)==null?void 0:f.id,name:(y=i==null?void 0:i.node)==null?void 0:y.name,avatar:(k=(q=i==null?void 0:i.node)==null?void 0:q.profile_picture)==null?void 0:k.uri,url:(C=i==null?void 0:i.node)==null?void 0:C.url,desc:(T=(R=i==null?void 0:i.node)==null?void 0:R.social_context)==null?void 0:T.text,seen:i==null?void 0:i.is_seen,time:((i==null?void 0:i.time)||0)*1e3,type:(p=i==null?void 0:i.node)==null?void 0:p.friendship_status,cursor:i==null?void 0:i.cursor}})}async function le(e=""){var h,o,i;const a=await F({variables:{input:{friend_requester_id:e,source:"friends_tab",actor_id:"me"},scale:2,refresh_num:0},doc_id:"4189738374386264"}),l=JSON.parse(a);return((i=(o=(h=l==null?void 0:l.data)==null?void 0:h.friend_request_delete)==null?void 0:o.friend_requester)==null?void 0:i.id)==e}async function de(e=""){var h,o,i;const a=await F({variables:{input:{friend_requester_id:e,source:"friends_tab",actor_id:"me"},scale:2,refresh_num:0},doc_id:"3750307704981867"}),l=JSON.parse(a);return((i=(o=(h=l==null?void 0:l.data)==null?void 0:h.friend_request_accept)==null?void 0:o.friend_requester)==null?void 0:i.id)==e}async function ue(e=""){var h,o,i;const a=await F({fb_api_req_friendly_name:"FriendingCometFriendRequestCancelMutation",variables:{input:{attribution_id_v2:"FriendingCometFriendRequestsRoot.react,comet.friending.friendrequests,unexpected,1724509964587,135627,2356318349,,;FriendingCometRoot.react,comet.friending,tap_bookmark,1724509961317,200700,2356318349,,",cancelled_friend_requestee_id:e,friending_channel:"MANAGE_OUTGOING_REQUESTS",actor_id:"me"},scale:2},doc_id:"5247084515315799"}),l=JSON.parse(a);return((i=(o=(h=l==null?void 0:l.data)==null?void 0:h.friend_request_cancel)==null?void 0:o.cancelled_friend_requestee)==null?void 0:i.id)==e}const j={[d.INCOMING_REQUEST]:{vi:"Đã nhận",en:"Incoming",color:"default",icon:"fa-solid fa-arrow-turn-down"},[d.OUTGOING_REQUEST]:{vi:"Đã gửi",en:"Outgoing",color:"default",icon:"fa-solid fa-arrow-turn-up"},[d.DECLINED]:{vi:"Đã từ chối",en:"Declined",color:"error",icon:"fa-solid fa-xmark"},[d.ACCEPTED]:{vi:"Đã chấp nhận",en:"Accepted",color:"success",icon:"fa-solid fa-check"},[d.CANCELED]:{vi:"Đã huỷ",en:"Canceled",color:"error",icon:"fa-solid fa-xmark"}};function Ge(){const{ti:e}=H(),{message:a,notification:l}=W(),h=ne(),[o,i]=b("FriendRequestType",d.INCOMING_REQUEST),[E,f]=b("FriendRequests."+o+".data",[]),[y,q]=b("FriendRequests."+o+".finished",!1),[k,C]=b("FriendRequests."+o+".loading",!1),R=Q.useMemo(()=>E.map((t,n)=>({...t,recent:n})),[E]);Q.useEffect(()=>{y||T(!1)},[o,y]);const T=async(t=!1)=>{var u;const n=t?[]:E,r=h.start(),c=`FriendRequests:${o}:onReload`;D(c),C(!0),q(!1);try{const m=n[n.length-1];let x=t?"":m==null?void 0:m.cursor;const _=o===d.INCOMING_REQUEST?ae:oe;for(;!r.value();){a.loading({key:c,content:e({en:`Loading ${j[o].en} friend requests...`,vi:`Đang tải yêu cầu kết bạn ${j[o].vi}...`})+n.length,duration:0});const g=await _(x);if(!(g!=null&&g.length))break;n.push(...g),x=(u=n==null?void 0:n[(n==null?void 0:n.length)-1])==null?void 0:u.cursor,f([...n])}console.log(n),q(!r.value()),a.success({key:c,content:e({en:"Loaded friend requests ",vi:"Tải xong yêu cầu kết bạn "})+n.length})}catch(m){a.error({content:e({en:"Failed to load friend requests: ",vi:"Lỗi tải yêu cầu kết bạn: "})+m.message})}finally{C(!1)}},p=async({data:t,key:n,actionFn:r,loadingText:c,successText:u})=>{if(!(t!=null&&t.length))return;const m=n+":waiting";D(n);let x=!1,_=[];for(let g=0;g<t.length&&(a.destroy(m),a.loading({key:n,content:s.jsxs(s.Fragment,{children:[c+(g+1)+"/"+t.length,s.jsx("br",{}),s.jsx("i",{children:e({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{a.loading({key:n,content:e({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),x=!0}}),await r(t[g])&&_.push(t[g]),!x);g++)if(g<t.length-1){const O=Z(2e3,5e3);a.loading({key:m,content:e({en:"Sleeping "+Math.round(O/1e3)+"s",vi:"Đang đợi "+Math.round(O/1e3)+"s"}),duration:0}),await X(O)}a.destroy(n),a.destroy(m),l.open({type:"success",duration:0,message:u+`${_.length}/${t.length}`,description:s.jsx("ol",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:_.map(g=>s.jsx("li",{children:s.jsx("a",{target:"_blank",href:Y(g.id),children:g.name})},g.id))})})},S=async({key:t,record:n,loadingText:r,successText:c,failedText:u,action:m,onSuccess:x})=>{D(t);try{if(a.loading({key:t,content:r+n.name,duration:0}),await m())return x==null||x(),a.success({key:t,content:c+n.name}),!0;throw new Error("Facebook response error")}catch(_){return a.destroy(t),l.open({type:"error",message:u+n.name,description:_.message}),!1}finally{}},U=t=>S({key:"FriendRequests:onClickDeclineFriendRequest",record:t,loadingText:e({en:"Declining friend request...",vi:"Đang từ chối yêu cầu kết bạn..."}),successText:e({en:"Declined friend request ",vi:"Từ chối yêu cầu thành công "}),failedText:e({en:"Failed to decline friend request: ",vi:"Lỗi từ chối yêu cầu kết bạn: "}),action:()=>le(t.id),onSuccess:()=>{f(n=>w(n,r=>{const c=r.findIndex(u=>u.id===t.id);return c>=0&&(r[c].type=d.DECLINED),r}))}}),G=t=>S({key:"FriendRequests:onClickAcceptFriendRequest",record:t,loadingText:e({en:"Accepting friend request...",vi:"Đang đồng ý yêu cầu kết bạn..."}),successText:e({en:"Accepted friend request ",vi:"Đã đồng ý yêu cầu kết bạn "}),failedText:e({en:"Failed to accept friend request: ",vi:"Lỗi đồng ý yêu cầu kết bạn: "}),action:()=>de(t.id),onSuccess:()=>{f(n=>w(n,r=>{const c=r.findIndex(u=>u.id===t.id);return c>=0&&(r[c].type=d.ACCEPTED),r}))}}),$=t=>S({key:"FriendRequests:onClickCancelOutgoingRequest",record:t,loadingText:e({en:"Canceling friend request...",vi:"Đang thu hồi yêu cầu kết bạn..."}),successText:e({en:"canceled friend request ",vi:"Đã thu hồi yêu cầu kết bạn "}),failedText:e({en:"Failed to cancel friend request: ",vi:"Lỗi thu hồi yêu cầu kết bạn: "}),action:()=>ue(t.id),onSuccess:()=>{f(n=>w(n,r=>{const c=r.findIndex(u=>u.id===t.id);return c>=0&&(r[c].type=d.CANCELED),r}))}}),P=t=>{const n=t!=null&&t.length?[...t]:[...E],r=n.filter(u=>u.type===d.INCOMING_REQUEST),c=n.filter(u=>u.type===d.OUTGOING_REQUEST);return s.jsxs(s.Fragment,{children:[s.jsx(v,{type:"primary",icon:k?s.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):s.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>T(!0),children:e({en:"Reload",vi:"Tải lại"})}),o===d.INCOMING_REQUEST?s.jsxs(I.Compact,{children:[s.jsx(N,{title:e({en:`Accept ${r.length} selected incoming requests`,vi:`Đồng ý ${r.length} lời mời đang chọn`}),children:s.jsx(A,{title:e({en:`Accept ${r.length} selected incoming requests`,vi:`Đồng ý ${r.length} lời mời đang chọn`}),description:e({en:`Are your sure want to accept ${r.length} incoming requests?`,vi:`Bản có chãc muốn đồng ý ${r.length} lời mời?`}),onConfirm:()=>p({data:r,key:"FriendRequests:onClickAcceptSelectedIncomingFriendRequests",actionFn:G,loadingText:e({en:"Accepting incoming requests...",vi:"Đang đồng ý lời mời..."}),successText:e({en:"Accepted incoming requests done: ",vi:"Đồng ý lời mời xong: "})}),okText:e({en:"Accept",vi:"Đồng ý"}),cancelText:e({en:"No",vi:"Huỷ"}),children:s.jsx(v,{disabled:r.length<=0,icon:s.jsx("i",{className:"fa-solid fa-check"}),children:r.length})})}),s.jsx(N,{title:e({en:`Decline ${r.length} selected incoming requests`,vi:`Từ chối ${r.length} lời mời đang chọn`}),children:s.jsx(A,{title:e({en:`Decline ${r.length} selected incoming requests`,vi:`Từ chối ${r.length} lời mời đang chọn`}),description:e({en:`Are your sure want to decline ${r.length} incoming requests?`,vi:`Bản có chãc muốn từ chối ${r.length} lời mời?`}),onConfirm:()=>p({data:r,key:"FriendRequests:onClickDeclineSelectedIncomingFriendRequests",actionFn:U,loadingText:e({en:"Declining incoming requests...",vi:"Đang từ chối lời mời..."}),successText:e({en:"Declined incoming requests done: ",vi:"Từ chối lời mời xong: "})}),okText:e({en:"Decline",vi:"Từ chối"}),cancelText:e({en:"No",vi:"Huỷ"}),children:s.jsx(v,{danger:!0,disabled:r.length<=0,icon:s.jsx("i",{className:"fa-regular fa-trash-can"}),children:r.length})})})]}):s.jsx(s.Fragment,{children:s.jsx(N,{title:e({en:`Cancel ${c.length} selected outgoing requests`,vi:`Thu hồi ${c.length} yêu cầu đang chọn`}),children:s.jsx(A,{title:e({en:`Cancel ${c.length} selected outgoing requests`,vi:`Thu hồi ${c.length} yêu cầu đang chọn`}),description:e({en:`Are your sure want to cancel ${c.length} outgoing requests?`,vi:`Bản có chãc muốn thu hồi ${c.length} yêu cầu?`}),onConfirm:()=>p({data:c,key:"FriendRequests:onClickCancelSelectedOutgoingFriendRequests",actionFn:$,loadingText:e({en:"Canceling outgoing requests...",vi:"Đang thu hồi yêu cầu..."}),successText:e({en:"Declined requests done: ",vi:"Thu hồi yêu cầu xong: "})}),okText:e({en:"Cancel",vi:"Thu hồi"}),cancelText:e({en:"No",vi:"Huỷ"}),children:s.jsx(v,{danger:!0,disabled:c.length<=0,icon:s.jsx("i",{className:"fa-regular fa-trash-can"}),children:c.length})})})}),s.jsx(N,{title:e({en:"View on Facebook",vi:"Xem trên Facebook"}),children:s.jsx(v,{icon:s.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/friends/requests","_blank")})})]})},J=[{title:"#",key:"recent",dataIndex:"recent",render:(t,n,r)=>n.recent+1,sorter:(t,n)=>t.recent-n.recent,width:50},{title:e({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(t,n)=>(t.name||"").localeCompare(n.name||""),render:(t,n,r)=>s.jsxs(I,{align:"center",style:{maxWidth:300},children:[s.jsx(te,{shape:"square",src:s.jsx(ie,{src:V(n.id),fallback:n.avatar}),size:50}),s.jsx("a",{href:n.url,target:"_blank",style:{marginLeft:"10px"},children:s.jsx("b",{children:n.name})})]})},{title:e({en:"Description",vi:"Mô tả"}),key:"desc",dataIndex:"desc",sorter:(t,n)=>(t.desc||"").localeCompare(n.desc||""),render:(t,n,r)=>s.jsx("p",{style:{maxWidth:150,minWidth:100},children:n.desc}),width:"auto"},{title:e({en:"Time",vi:"Thời gian"}),key:"time",dataIndex:"time",sorter:(t,n)=>t.time-n.time,render:(t,n,r)=>L(n.time,e({en:"en-US",vi:"vi-VN"}))||"-",onSearch:(t,n)=>z(t,L(n,e({en:"en-US",vi:"vi-VN"}))),align:"right",width:180},{title:e({en:"Status",vi:"Trạng thái"}),key:"type",dataIndex:"type",filters:Object.entries(j).map(([t,n])=>{const r=E.filter(c=>c.type===t).length;return{text:e(n)+` (${r})`,value:t}}),onFilter:(t,n)=>n.type===t,render:(t,n,r)=>{const c=j[n.type];return s.jsx(se,{color:c.color,children:e(c)})},align:"right"},{title:e({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(t,n,r)=>n.type===d.INCOMING_REQUEST?s.jsxs(I.Compact,{children:[s.jsx(N,{title:e({en:"Accept",vi:"Đồng ý"}),children:s.jsx(v,{onClick:()=>G(n),icon:s.jsx("i",{className:"fa-solid fa-check"})})}),s.jsx(N,{title:e({en:"Decline",vi:"Từ chối"}),children:s.jsx(v,{danger:!0,onClick:()=>U(n),icon:s.jsx("i",{className:"fa-solid fa-trash-can"})})})]}):n.type===d.OUTGOING_REQUEST?s.jsx(I.Compact,{children:s.jsx(N,{title:e({en:"Cancel",vi:"Thu hồi"}),children:s.jsx(v,{danger:!0,onClick:()=>$(n),icon:s.jsx("i",{className:"fa-solid fa-trash-can"})})})}):null,align:"right",width:100}];return s.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[s.jsx(re,{align:"middle",style:{margin:"16px"},children:s.jsx(ce.Title,{level:3,style:{margin:0},children:e({en:"Friend Requests",vi:"Lời mời kết bạn"})})}),s.jsx(M.Group,{defaultValue:o,buttonStyle:"solid",style:{marginBottom:10},children:[d.INCOMING_REQUEST,d.OUTGOING_REQUEST].map(t=>{var n,r;return s.jsxs(M.Button,{value:t,onClick:()=>{i(t)},children:[s.jsx("i",{className:j[t].icon})," ",`${e(j[t])} ${(r=(n=K("FriendRequests."+t+".data",[]))==null?void 0:n.filter(c=>c.type===t))==null?void 0:r.length}`]},t)})}),s.jsx(ee,{data:R,columns:J,renderTitle:P,size:"small",searchable:!0,selectable:!0,keyExtractor:t=>t.id})]})}export{Ge as default};
