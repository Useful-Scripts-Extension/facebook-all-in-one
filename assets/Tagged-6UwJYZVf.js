import{r as b,av as s,aw as k}from"./index-CyhnFUY8.js";import{$ as I,a0 as S,D as _,u as D,c as F,d as g,t as w,b as u,h as L,g as C,a1 as B,f as M,T as R,o as $}from"./MyApp-caDNmZDO.js";import O from"./MyTable-DrwpJOvL.js";import{E as K}from"./ExportButton-WAmGbwIc.js";import{I as U}from"./index-gMG0CZXT.js";import{A as z}from"./index-C3KW9ANy.js";import{T as H}from"./index-COc9MIHG.js";import"./index-Wi0r6QgI.js";import"./Table-DdPfeT54.js";import"./index-DRnClY8M.js";import"./addEventListener-D7MdEALa.js";import"./index-D7A1xStb.js";import"./PurePanel-BLn9rQhP.js";import"./index-DI922-R1.js";import"./index-C1JDqsq5.js";import"./index-BL54bhgy.js";import"./Dropdown-gDQspln8.js";import"./index-BwIvHtDJ.js";import"./useBreakpoint-DLdKl7bl.js";import"./Pagination-DeI1ooiV.js";import"./index-B25XG7Qc.js";import"./row-BWTh7o9C.js";import"./file-download-D8LHReLO.js";async function N(n,a=""){var p;const j=await I(S.EAAB),o=await _(`https://graph.facebook.com/v12.0/${n}/tagged?fields=from,id,message,created_time&access_token=${j}`+(a?`&after=${a}`:"")),d=JSON.parse(o);return console.log(d),((p=d==null?void 0:d.data)==null?void 0:p.map(f=>{var h,r,x,v;return{id:f.id,message:f.message,created_time:f.created_time,from:{id:(h=f.from)==null?void 0:h.id,name:(r=f.from)==null?void 0:r.name},cursor:(v=(x=d==null?void 0:d.paging)==null?void 0:x.cursors)==null?void 0:v.after}}))||[]}function he({target:n}){const{ti:a}=D(),{message:j}=F(),[o,d]=g("Tagged."+(n==null?void 0:n.id),[]),[p,f]=g("Tagged.loading."+(n==null?void 0:n.id),!1),[h,r]=b.useState(!0);b.useEffect(()=>{x()},[n==null?void 0:n.id]);const x=()=>{!(n!=null&&n.id)||p||(w("Tagged:onClickReload"),f(!0),N(n.id).then(i=>{console.log(i),d(i)}).finally(()=>f(!1)))},v=()=>{var i;!(n!=null&&n.id)||p||(w("Tagged:onClickLoadMore"),f(!0),N(n.id,(i=o[o.length-1])==null?void 0:i.cursor).then(e=>{const m=new Set(o.map(t=>t.id)),l=e.filter(t=>!m.has(t.id));l.length?(d(t=>[...t,...l]),r(!0)):(j.info(a({en:"No more data",vi:"Không có dữ liệu"})),r(!1))}).finally(()=>f(!1)))},E=()=>s.jsxs(u,{children:[s.jsxs(u.Compact,{children:[s.jsx(k,{type:"primary",icon:s.jsx("i",{className:"fa-solid fa-rotate-right"}),loading:p,onClick:x,children:a({en:"Reload",vi:"Tải lại"})}),s.jsx(k,{icon:s.jsx("i",{className:"fa-solid fa-play"}),loading:p,onClick:v,disabled:!h,children:a(h?{en:"Load more",vi:"Tải thêm"}:{en:"No more data",vi:"Không còn dữ liệu"})})]}),s.jsx(K,{data:o,options:[{key:"json",label:".json",prepareData:i=>({fileName:(n==null?void 0:n.name)+"_tagged.json",data:JSON.stringify(i,null,4)})},{key:"csv",label:".csv",prepareData:i=>({fileName:(n==null?void 0:n.name)+"_tagged.csv",data:$(i)})}]}),s.jsx(H,{color:"red",children:(o==null?void 0:o.length)+" "+a({en:"Tagged",vi:"Lượt tag"})})]}),A=[{title:"#",key:"index",dataIndex:"index"},{title:a({en:"Owner",vi:"Người tag"}),key:"from",dataIndex:"from",render:(i,e,m)=>{var l,t,c,y,T;return(l=e==null?void 0:e.from)!=null&&l.id?s.jsxs(u,{children:[s.jsx(U,{src:L((t=e==null?void 0:e.from)==null?void 0:t.id),style:{width:45,height:45,borderRadius:5}}),s.jsxs(u,{direction:"vertical",size:0,children:[s.jsx("a",{href:C((c=e==null?void 0:e.from)==null?void 0:c.id),target:"_blank",rel:"noreferrer",children:s.jsx("b",{children:(y=e==null?void 0:e.from)==null?void 0:y.name})}),s.jsx("span",{style:{opacity:.5},children:(T=e==null?void 0:e.from)==null?void 0:T.id})]})]}):a({en:"Anonymous",vi:"Ẩn danh"})},filters:Array.from(new Set(o==null?void 0:o.map(i=>{var e;return(e=i.from)==null?void 0:e.id}))).map(i=>{var m,l;const e=o.filter(t=>{var c;return((c=t.from)==null?void 0:c.id)===i});return{value:i||"",text:(((l=(m=e==null?void 0:e[0])==null?void 0:m.from)==null?void 0:l.name)||a({en:"Anonymous",vi:"Ẩn danh"}))+` (${e==null?void 0:e.length})`,count:e==null?void 0:e.length}}).sort((i,e)=>e.count-i.count),onFilter:(i,e)=>{var m;return((m=e.from)==null?void 0:m.id)==i},width:300},{title:a({en:"Content",vi:"Nội dung"}),key:"message",dataIndex:"message",render:(i,e,m)=>{var l,t,c;return s.jsx("div",{style:{wordBreak:"break-word",maxWidth:600},children:((c=((l=e==null?void 0:e.message)==null?void 0:l.length)>200?((t=e==null?void 0:e.message)==null?void 0:t.substring(0,200))+"...":e==null?void 0:e.message)==null?void 0:c.replace(n==null?void 0:n.name,""))||(n==null?void 0:n.name)})}},{title:a({en:"Created at",vi:"Thời gian"}),key:"created_time",dataIndex:"created_time",render:(i,e,m)=>s.jsxs("span",{children:[B(new Date(i))," - ",M(new Date(i))]})},{title:a({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(i,e,m)=>s.jsx(R,{title:a({en:"View post",vi:"Xem bài viết"}),children:s.jsx(k,{target:"_blank",href:C(e==null?void 0:e.id),icon:s.jsx("i",{className:"fa-solid fa-external-link"})})}),width:100}];return s.jsxs("div",{children:[s.jsx(u,{style:{width:"100%",alignItems:"center",justifyContent:"center",marginBottom:10},children:s.jsx(z,{type:"success",message:(n==null?void 0:n.name)+" "+a({en:"has been tagged in a post/comment on Facebook",vi:"được tag trong bài viết/bình luận trên Facebook"})})}),s.jsx(O,{data:o.map((i,e)=>({...i,index:e+1})),columns:A,searchable:!0,keyExtractor:i=>i==null?void 0:i.id,size:"small",renderTitle:E})]})}export{he as default};
