import{ak as I,ah as V,ai as C,r as m,an as e,ao as j}from"./index-Bauu_rQz.js";import{u as F,b as v,S as n,f as L,g as E,d as U}from"./MyApp-Bys9Gcx7.js";import{S as $}from"./StoryViewers-DSPp_-KZ.js";import{e as z}from"./stories-Lvg8Jd2W.js";import{T as s}from"./index-DVA-9Vh9.js";import{I as p}from"./index-Djwy8iJ2.js";import{A as B}from"./index-B12rPJzZ.js";import{T as D}from"./index-B6GAYVd9.js";import"./Collection-Beg4ua-i.js";import"./index-CvWoZbjn.js";import"./file-download-Bzst5y78.js";import"./sweetalert2.all-CPfqglTu.js";import"./VIP-B0YGNZWp.js";import"./feeds-oFJ5YWBc.js";import"./index-CMHbGXsp.js";import"./Dropdown-B8BeH3Ui.js";import"./PurePanel-BYHlpyJU.js";import"./index-Cpsi3S0Y.js";import"./index-DAG6TrVo.js";import"./index-BPUn4fsJ.js";import"./TextArea-CgQp8A8y.js";import"./addEventListener-CNKtHe32.js";import"./index-Dn7OSutu.js";import"./index-BV1u9CSm.js";import"./Pagination-Camtoyiw.js";import"./useBreakpoint-Cxwl39Yp.js";import"./responsiveObserver-DfN5pXDv.js";import"./row-BG4wt4tl.js";import"./index-B1NO2A4X.js";import"./index-CC5YUJ9m.js";function ge({story:l}){const{ti:d}=F(),{message:y}=I.useApp(),u=V(C.darkMode),[o,b]=v("ArchivedStoryViewer.stories."+l.creation_time,[]),[c,x]=v("ArchivedStoryViewer.viewingIndex."+l.id,0),[f,g]=m.useState(!1),t=o[c]||o[0],w=t?Object.values(t.viewer_count).reduce((i,r)=>i+r,0):0,T=t?t.reactions.reduce((i,r)=>i+r.count,0):0,k=c<o.length-1,A=c>0,S=o.length===0&&!f,h=m.useRef(!1);m.useEffect(()=>{!(o!=null&&o.length)&&l.creation_time&&!h.current&&(g(!0),h.current=!0,z({creationTime:l.creation_time}).then(i=>{if(i){const r=i.findIndex(_=>_.id===l.id);b(i),x(r)}}).catch(i=>y.error(d({en:"Error: ",vi:"Lỗi: "}))+i.message).finally(()=>{g(!1),h.current=!1}))},[]);const a={height:"70vh",width:"calc(70vh * 9 / 16)"},N=m.useRef(null),R=t?[{key:"story",label:e.jsxs(s.Text,{children:[e.jsx("i",{className:"fa fa-play"})," Play"]}),children:e.jsxs(n,{direction:"vertical",style:{position:"relative"},children:[t.video?e.jsx("video",{controls:!0,autoPlay:!0,loop:!0,src:t.video,style:{...a,borderRadius:10,objectFit:"contain"}}):t.image_background?e.jsxs(n,{direction:"vertical",style:{position:"relative"},children:[e.jsx(p,{src:t.image_background,preview:!1,style:{...a,borderRadius:10,objectFit:"contain"}}),e.jsx(p,{src:t.image,style:{...a,borderRadius:10,objectFit:"contain",position:"absolute",bottom:0,left:0,transform:"translate(-50%, 0)",opacity:.5}})]}):e.jsx(p,{src:t.image,style:{...a,borderRadius:10,objectFit:"contain"}}),e.jsx(n,{direction:"vertical",align:"start",style:{background:"linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%)",position:"absolute",top:0,left:0,padding:10,width:"100%",paddingBottom:"50px",borderRadius:10},children:[t.comment_count?{icon:e.jsx("i",{className:"fa-solid fa-message"}),text:t.comment_count}:null,t.music?{icon:e.jsx("i",{className:"fa-solid fa-music"}),text:t.music}:null].filter(Boolean).map((i,r)=>i&&e.jsxs(s.Text,{style:{color:"#eee",textAlign:"left"},children:[i.icon," ",i.text]},"story-statistic-"+r))})]})},{key:"viewer",label:e.jsxs(s.Text,{children:[e.jsx("i",{className:"fa fa-eye"})," ",w," "]}),children:e.jsxs(n,{direction:"vertical",style:{...a,width:450,overflowY:"auto",overflowX:"hidden",textAlign:"left",position:"relative"},children:[e.jsxs(s.Text,{children:[d({en:"Views",vi:"Lượt xem"}),":"]}),e.jsx("ul",{children:Object.entries(t.viewer_count).map(([i,r])=>e.jsx("li",{children:e.jsxs(s.Text,{style:{color:"#eee"},children:[i,": ",r]})},"story-viewer-"+i))}),e.jsx(n,{direction:"horizontal",style:{display:"flex",padding:10,alignItems:"center"},children:e.jsxs(s.Text,{style:{textDecoration:"underline"},children:[d({en:"Created date",vi:"Ngày đăng"}),e.jsx(s.Text,{style:{position:"absolute",right:10},children:L(new Date(t.created_at),d({en:"en-US",vi:"vi-VN"}))})]})}),e.jsx($,{storyId:t.id,initialViewers:t.viewers})]})},{key:"reactions",label:e.jsxs(s.Text,{children:[e.jsx("i",{className:"fa fa-heart"})," ",T," "]}),children:e.jsxs(n,{direction:"vertical",style:{overflowY:"auto",...a},align:"start",children:[e.jsxs(s.Text,{children:[d({en:"Reactions",vi:"Lượt thích"}),":"]}),t.reactions.map((i,r)=>e.jsxs(s.Link,{href:E(i.uid),style:{padding:"0 5px 5px",display:"block"},target:"_blank",children:[e.jsx(B,{src:U(i.uid,50),size:35}),e.jsx(s.Text,{style:{color:"#eee",textAlign:"left"},children:` ${i.count} ${i.reactions}`},"story-reaction-"+r)]},"story-reaction-"+r))]})}]:[];return e.jsxs(n,{direction:"vertical",style:{maxHeight:"100vh",overflowY:"auto",overflowX:"hidden",minWidth:a.width,minHeight:a.height,background:u?"#222":"#eee",color:u?"white":"#111",padding:10,borderRadius:10},ref:N,children:[e.jsxs(s.Text,{children:["Archived Story Viewer"," ",f?e.jsx("i",{className:"fa fa-spinner fa-spin"}):`(${c+1}/${o.length})`]}),S&&e.jsx("div",{children:"No data"}),t&&e.jsxs(n,{children:[e.jsx(j,{disabled:!A,onClick:()=>{x(c-1)},children:e.jsx("i",{className:"fa fa-chevron-left"})}),e.jsx(D,{defaultActiveKey:"story",items:R}),e.jsx(j,{disabled:!k,onClick:()=>{x(c+1)},children:e.jsx("i",{className:"fa fa-chevron-right"})})]})]})}export{ge as default};
