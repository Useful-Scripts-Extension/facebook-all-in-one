const __vite__fileDeps=["./MyTable-D-dXzM8k.js","./index-C0Tuo7Vh.js","./index-BM_p-30O.css","./MyApp-Dl644HTJ.js","./styleChecker-D9_ZzGCE.js","./addEventListener-KPFk0H-o.js","./index-CLq-agga.js","./PurePanel-CXpZVn6W.js","./TextArea-VrntzyAe.js","./index-BiYVQeu3.js","./index-fna94_c_.js","./index-Bc2TOSs9.js","./Dropdown-CfC0zFLy.js","./index-CvGJFtth.js","./useBreakpoint-qnzCDWO-.js","./responsiveObserver-BG2XAw38.js","./Pagination-CAvsMqnw.js","./index-BJGgnfrs.js","./row-DU3SUC4b.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{am as Z,r as b,ao as t,ap as u,as as _,aJ as L,au as E}from"./index-C0Tuo7Vh.js";import{b as ee,a as ne,c as H,t as j,S as v,g as T,T as x,E as ie,o as te,B as ae,z as se,J as le}from"./MyApp-Dl644HTJ.js";import{u as oe}from"./useForceStop-DTR3Edpi.js";import{P as re}from"./index-vuHwb1ab.js";import{E as ce}from"./ExportButton-CleJ6vnj.js";import{g as de,U as d,a as ge,u as he,b as ue,d as me}from"./pages-B_aoZcv3.js";import{I as V}from"./index-D--cvhvb.js";import{T as B}from"./index-BxR4uxUX.js";import{T as F}from"./index-COvWFQI4.js";import{P as y}from"./index-C8LDgO3H.js";import{R as pe}from"./row-DU3SUC4b.js";import"./file-download-DDM1kl3y.js";import"./index-Bc2TOSs9.js";import"./Dropdown-CfC0zFLy.js";import"./PurePanel-CXpZVn6W.js";import"./addEventListener-KPFk0H-o.js";import"./styleChecker-D9_ZzGCE.js";import"./TextArea-VrntzyAe.js";import"./index-Ktf3kSUs.js";import"./responsiveObserver-BG2XAw38.js";const xe=b.lazy(()=>_(()=>import("./MyTable-D-dXzM8k.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url));function Re(){const{message:c,notification:f}=ee(),O=Z(),{ti:i}=ne(),W=oe(),[p,k]=H("Pages.data",[]),[K,S]=H("Pages.finished",!1),[$,R]=b.useState(!1);b.useEffect(()=>{K||M(!1)},[]);const M=async(e=!1)=>{var h;if($&&!e)return;const n=W.start(),a=e?[]:[...p],o=new Set(a.map(g=>g.id)),l="Pages:onReload";j(l),R(!0),S(!1);try{c.loading({key:l,content:i({en:"Loading invited pages...",vi:"Đang tải trang được mời..."}),duration:0});const s=(await de()).filter(m=>!o.has(m.id));s!=null&&s.length&&(a.push(...s),k([...a]));const r=a.filter(m=>m.userType!==d.INVITED).pop();let U=e?"":r==null?void 0:r.cursor;for(;!n.value();){c.loading({key:l,content:i({en:"Loading pages...",vi:"Đang tải trang..."})+a.length,duration:0});const m=await ge(U),w=m==null?void 0:m.filter(P=>!o.has(P.id));if(m.forEach(P=>o.add(P.id)),!(w!=null&&w.length))break;a.push(...w),U=(h=a==null?void 0:a[(a==null?void 0:a.length)-1])==null?void 0:h.cursor,k([...a])}c.success({key:l,content:(n.value()?i({en:"Load pages stopped ",vi:"Dừng tải trang "}):i({en:"Load pages completed ",vi:"Tải xong trang "}))+a.length}),S(!n.value())}catch(g){c.error({content:i({en:"Failed to load pages: ",vi:"Lỗi tải trang: "})+g.message})}finally{R(!1)}},D=async({pages:e,key:n,actionFn:a,loadingText:o,successText:l})=>{if(!(e!=null&&e.length))return;const h=n+":waiting";j(n);let g=!1,s=[];for(let r=0;r<e.length&&(c.destroy(h),c.loading({key:n,content:t.jsxs(t.Fragment,{children:[o+(r+1)+"/"+e.length,t.jsx("br",{}),t.jsx("i",{children:i({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{c.loading({key:n,content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0}),g=!0}}),await a(e[r])&&s.push(e[r]),!g);r++)if(r<e.length-1){const m=le(2e3,5e3);c.loading({key:h,content:i({en:"Sleeping "+Math.round(m/1e3)+"s",vi:"Đang đợi "+Math.round(m/1e3)+"s"}),duration:0}),await se(m)}c.destroy(n),c.destroy(h),f.open({type:"success",duration:0,message:l+`${s.length}/${e.length}`,description:t.jsx("ol",{style:{maxHeight:200,overflowY:"auto",whiteSpace:"pre-wrap"},children:s.map(r=>t.jsx("li",{children:t.jsx("a",{target:"_blank",href:T(r.id),children:r.name})},r.id))})})},z=async e=>{D({key:"Pages:onClickUnlikeSelectedPages",pages:e,actionFn:I,loadingText:i({en:"Unliking pages... ",vi:"Đang bỏ thích trang... "}),successText:i({en:"Unliked pages done: ",vi:"Bỏ thích trang xong: "})})},I=async e=>{const n="Pages:onClickUnlikePage";j(n),c.loading({key:n,content:i({en:"Unliking page... "+e.name,vi:"Đang bỏ thích trang..."+e.name}),duration:0});const a=await he(e.id);return a?(f.destroy(n),c.success({key:n,content:i({en:"Unliked page "+e.name,vi:"Đã bỏ thích trang "+e.name})}),k(o=>L(o,l=>{const h=l.findIndex(g=>g.id==e.id);return l[h].userType=d.UNLIKED,l}))):(c.destroy(n),f.open({type:"error",key:n,message:i({en:"Failed to unlike page",vi:"Lỗi bỏ thích trang"}),description:e.name,duration:0,btn:t.jsxs(v,{children:[t.jsx(u,{type:"default",onClick:()=>I(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(u,{type:"primary",onClick:()=>window.open(T(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),a},J=async e=>{D({key:"Pages:onClickUnfollowSelectedPages",pages:e,actionFn:N,loadingText:i({en:"Unfollowing pages... ",vi:"Đang bỏ theo dõi trang... "}),successText:i({en:"Unfollowed pages done: ",vi:"Bỏ theo dõi trang xong: "})})},N=async e=>{const n="Pages:onClickUnfollowPage";j(n),c.loading({key:n,content:i({en:"Unfollowing page... "+e.name,vi:"Đang bỏ theo dõi trang..."+e.name}),duration:0});const a=await ue(e.id);return a?(f.destroy(n),c.success({key:n,content:i({en:"Unfollowed page "+e.name,vi:"Đã bỏ theo dõi trang "+e.name})}),k(o=>L(o,l=>{const h=l.findIndex(g=>g.id==e.id);return l[h].userType=d.UNFOLLOWED,l}))):(c.destroy(n),f.open({type:"error",key:n,message:i({en:"Failed to unfollow page",vi:"Lỗi bỏ theo dõi trang"}),description:e.name,duration:0,btn:t.jsxs(v,{children:[t.jsx(u,{type:"default",onClick:()=>N(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(u,{type:"primary",onClick:()=>window.open(T(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),a},X=async e=>{D({key:"Pages:onClickDeclineSelectedInvites",pages:e,actionFn:C,loadingText:i({en:"Removing invite... ",vi:"Đang từ chối lời mời... "}),successText:i({en:"Declined invites done: ",vi:"Từ chối lời mời xong: "})})},C=async e=>{const n="Pages:onClickDeclineInvite";j(n),c.loading({key:n,content:i({en:"Declining invite... "+e.name,vi:"Đang từ chối lời mời..."+e.name}),duration:0});const a=await me(e.inviteId);return a?(f.destroy(n),c.success({key:n,content:i({en:"Removed invite "+e.name,vi:"Đã từ chối lời mời "+e.name})}),k(o=>L(o,l=>{const h=l.findIndex(g=>g.id==e.id);return l[h].userType=d.DECLINED,l}))):(c.destroy(n),f.open({type:"error",key:n,message:i({en:"Failed to remove invite",vi:"Lỗi từ chối lời mời"}),description:e.name,duration:0,btn:t.jsxs(v,{children:[t.jsx(u,{type:"default",onClick:()=>C(e),children:i({en:"Retry",vi:"Thử lại"})}),t.jsx(u,{type:"primary",onClick:()=>window.open(T(e.id)),children:i({en:"View page",vi:"Xem trang"})})]})})),a},q=e=>{O("/bulk-downloader",{state:{targetId:e.id,platform:re.Facebook}})},Q=e=>{var h,g;const n=e!=null&&e.length?[...e]:[...p],a=((h=n==null?void 0:n.map(s=>p.find(r=>r.id===s.id)))==null?void 0:h.filter(s=>(s==null?void 0:s.userType)===d.LIKED||(s==null?void 0:s.userType)===d.ADMIN))||[],o=(a==null?void 0:a.filter(s=>s==null?void 0:s.canLike))||[],l=((g=n==null?void 0:n.map(s=>p.find(r=>r.id===s.id)))==null?void 0:g.filter(s=>(s==null?void 0:s.userType)===d.INVITED))||[];return t.jsxs(t.Fragment,{children:[t.jsx(x,{color:"red",title:i({en:"WARNING: Reload many times may cause temporarily blocked by facebook",vi:"LƯU Ý: Tải lại nhiều lần có thể bị facebook chặn tạm thời"}),children:t.jsx(u,{type:"primary",icon:$?t.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):t.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>M(!0),children:i({en:"Reload",vi:"Tải lại"})})}),t.jsx(ce,{data:n,options:[{key:"id",label:".txt (page id)",prepareData:s=>({fileName:"your_pages_id"+E().format("YYYY-MM-DD-HHmmss")+".txt",data:s==null?void 0:s.map(r=>r.id).join(`
`)})},{key:"json",label:".json",prepareData:s=>({fileName:"your_pages"+E().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(s,null,4)})},{key:"csv",label:".csv",prepareData:s=>({fileName:"your_pages"+E().format("YYYY-MM-DD-HHmmss")+".csv",data:te(s)})}]}),t.jsx(x,{title:i({en:`Unlike ${o.length} selected pages`,vi:`Bỏ thích ${o.length} trang được chọn`}),children:t.jsx(y,{title:i({en:`Unlike ${o.length} pages`,vi:`Bỏ thích ${o.length} trang`}),description:i({en:`Are your sure want to unlike ${o.length} pages?`,vi:`Bản có chãc muốn bỏ thích ${o.length} trang?`}),onConfirm:()=>z(o),okText:i({en:"Unlike pages",vi:"Bỏ thích trang"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{danger:!0,type:"primary",disabled:o.length<=0,icon:t.jsx("i",{className:"fa-solid fa-thumbs-down"}),children:o.length})})}),t.jsx(x,{title:i({en:`Unfollow ${a.length} selected pages`,vi:`Bỏ theo dõi ${a.length} trang được chọn`}),children:t.jsx(y,{title:i({en:`Unfollow ${a.length} pages`,vi:`Bỏ theo dõi ${a.length} trang`}),description:i({en:`Are your sure want to unfollow ${a.length} pages?`,vi:`Bản có chãc muốn bỏ theo dõi ${a.length} trang?`}),onConfirm:()=>J(a),okText:i({en:"Yes",vi:"Có"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{danger:!0,type:"primary",disabled:a.length<=0,icon:t.jsx("i",{className:"fa-solid fa-eye-slash"}),children:a.length})})}),l.length>0&&t.jsx(x,{title:i({en:`Decline ${l.length} selected invites`,vi:`Từ chối ${l.length} lời mời được chọn`}),children:t.jsx(y,{title:i({en:`Decline ${l.length} invites`,vi:`Từ chối ${l.length} lời mời`}),description:i({en:`Are your sure want to decline ${l.length} invites?`,vi:`Bản có chãc muốn từ chối ${l.length} lời mời?`}),onConfirm:()=>X(l),okText:i({en:"Yes",vi:"Có"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{danger:!0,type:"primary",disabled:l.length<=0,icon:t.jsx("i",{className:"fa-solid fa-xmark"}),children:l.length})})}),t.jsx(x,{title:i({en:"Manage on Facebook",vi:"Quản lý trên Facebook"}),children:t.jsx(ae,{count:i({en:"New",vi:"Mới"}),color:"purple",style:{color:"white"},children:t.jsx(u,{href:"https://www.facebook.com/me/allactivity?category_key=LIKEDINTERESTS",target:"_blank",icon:t.jsx("i",{className:"fa-solid fa-up-right-from-square"})})})})]})},A=e=>{switch(e){case d.ADMIN:return{color:"success",text:i({en:"Admin",vi:"Admin"})};case d.LIKED:return{color:"default",text:i({en:"Liked",vi:"Đã thích"})};case d.INVITED:return{color:"warning",text:i({en:"Invited",vi:"Lời mời"})};case d.DECLINED:return{color:"error",text:i({en:"Declined",vi:"Từ chối"})};case d.UNLIKED:return{color:"error",text:i({en:"Unliked",vi:"Bỏ thích"})};case d.UNFOLLOWED:return{color:"error",text:i({en:"Unfollowed",vi:"Bỏ theo dõi"})};default:return{color:"default",text:"?"}}},Y=b.useMemo(()=>Array.from(p.map(e=>e.category).reduce((e,n)=>{let a=e.get(n)||0;return e.set(n,++a)},new Map).entries()).sort((e,n)=>n[1]-e[1]).map(([e,n])=>({text:e+" ("+n+")",value:e})),[p]),G=[{title:i({en:"Image",vi:"Ảnh"}),key:"image",dataIndex:"image",render:(e,n,a)=>t.jsx(V,{src:n.image,width:50,height:50,style:{objectFit:"contain",borderRadius:5}})},{title:i({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",render:(e,n,a)=>t.jsxs(v,{direction:"vertical",size:0,style:{maxWidth:300},children:[t.jsx(B.Link,{href:n.url,target:"_blank",children:t.jsx("b",{children:n.name||"???"})}),t.jsx("span",{style:{opacity:.7},children:n.id})]})},{title:i({en:"Category",vi:"Danh mục"})+" ("+Y.length+")",key:"category",dataIndex:"category",filters:Y,onFilter:(e,n)=>n.category==e,filterSearch:!0},{title:i({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,n,a)=>{const{color:o,text:l}=A(n.userType);return n.inviterId?t.jsxs(v,{children:[t.jsx(F,{color:o,children:l}),t.jsx(V,{src:n.inviterAvatar,width:40,height:40,style:{borderRadius:5}}),t.jsx(B.Link,{href:T(n.inviterId),target:"_blank",children:n.inviterName})]}):t.jsx(F,{color:o,children:l})},filters:Object.values(d).map(e=>{const{text:n}=A(e);return{text:n+" ("+p.filter(a=>a.userType==e).length+")",value:e}}),onFilter:(e,n)=>n.userType==e,align:"left"},{title:i({en:"Action",vi:"Hành động"}),key:"action",render:(e,n,a)=>t.jsxs(v.Compact,{style:{minWidth:30},children:[n.userType===d.LIKED||n.userType===d.ADMIN?t.jsxs(t.Fragment,{children:[n.canLike?t.jsx(x,{title:i({en:"Unlike page",vi:"Bỏ thích"}),children:t.jsx(y,{title:i({en:"Unlike page",vi:"Bỏ thích"}),description:i({en:"Are you sure want to unlike this page?",vi:"Bạn có chắc muốn bỏ thích trang này?"}),onConfirm:()=>I(n),okText:i({en:"Unlike",vi:"Bỏ thích"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{icon:t.jsx("i",{className:"fa-solid fa-thumbs-down"})})})}):null,t.jsx(x,{title:i({en:"Unfollow page",vi:"Bỏ theo dõi"}),children:t.jsx(y,{title:i({en:"Unfollow page",vi:"Bỏ theo dõi"}),description:i({en:"Are you sure want to unfollow this page?",vi:"Bạn có chắc muốn bỏ theo dõi trang này?"}),onConfirm:()=>N(n),okText:i({en:"Unfollow",vi:"Bỏ theo dõi"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{icon:t.jsx("i",{className:"fa-solid fa-eye-slash"})})})})]}):null,n.userType===d.INVITED?t.jsx(x,{title:i({en:"Decline invite",vi:"Từ chối"}),children:t.jsx(y,{title:i({en:"Decline invite",vi:"Từ chối"}),description:i({en:"Decline this invite?",vi:"Từ chối lời mời này?"}),onConfirm:()=>C(n),okText:i({en:"Yes",vi:"Từ chối"}),cancelText:i({en:"No",vi:"Huỷ"}),children:t.jsx(u,{danger:!0,type:"primary",icon:t.jsx("i",{className:"fa-solid fa-xmark"})})})}):null,t.jsx(x,{title:i({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:t.jsx(u,{type:"default",onClick:()=>q(n),icon:t.jsx("i",{className:"fa-solid fa-download"})})})]}),width:100,align:"right"}];return t.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[t.jsxs(pe,{align:"middle",style:{margin:"16px"},children:[t.jsx(B.Title,{level:3,style:{margin:0},children:i({en:"Pages manager",vi:"Quản lý trang"})}),t.jsx(F,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:p.length})]}),t.jsx(xe,{data:p,columns:G,renderTitle:Q,size:"small",searchable:!0,selectable:!0,onSearchRow:(e,n)=>ie(e,(n==null?void 0:n.name)+(n==null?void 0:n.id)),keyExtractor:e=>e.id+e.userType})]})}export{Re as default};
